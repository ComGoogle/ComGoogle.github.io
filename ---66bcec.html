<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F10daba46-51b9-474a-9c22-1222e6e158b2%2FPMI74K6FO73MCR770JT.png?table=collection&amp;id=51a399fe-3ada-47de-a312-8e2ad5e56579">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>操作系统课程笔记　　&nbsp;|&nbsp;这儿是什么地方</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="操作系统课程笔记　　">
  
  
    <meta property="og:image" content="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🎃&lt;/text&gt;&lt;/svg&gt;">
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F10daba46-51b9-474a-9c22-1222e6e158b2%2FPMI74K6FO73MCR770JT.png?table=collection&amp;id=51a399fe-3ada-47de-a312-8e2ad5e56579"></span>&nbsp;
      
      <span>SixGoogle</span>
    </div>
  </a>
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about-me-1b4752.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;😀&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>About me?</span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
</nav>

  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
      <div class="Header__Icon">
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🎃&lt;/text&gt;&lt;/svg&gt;"></span>
      </div>
    
    <h1 class="Header__Title">操作系统课程笔记　　</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Sat, Apr 20, 2024</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--pink">
            <a href="tag/怎么这么绕.html">怎么这么绕</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/66bcece4921d4d66b4c5332235cf568b" class="PageRoot PageRoot--FullWidth"><ul id="https://www.notion.so/8f8086ccdd09408589077ab22c52c564" class="ColorfulBlock ColorfulBlock--ColorGray TableOfContents"><li class="TableOfContents__Item"><a href="#https://www.notion.so/4f8dd324a7bf4a369a282f153f2e39f5"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">虚拟化 virtualization</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/ba2c120fe17f4bb18fff34704500f351"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">进程管理（虚拟化CPU）</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/29f8b54853394135b6ec705d7c6ccb3c"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">抽象：进程</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/90e45b7546da4376a068004ec0d95352"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">进程API</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/f612fd0c4dd14f858fa20108b3be7c41"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">进程API续（一些常见应用）</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/d848bd6e29bb4af5bdcae37ba697c4e5"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">机制：受限直接执行</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/8d01e9cdc5c34074ad6a9f07a1eee7e0"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">进程调度（3+1）</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/d943c6f477954221ba404388e0c0d49f"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">内存管理（虚拟化内存）</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/ec8b5dab049a4692a6f7316d1c183bbe"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">地址空间</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/064a659e53764da59d5d18d58c1a1749"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">内存操作API</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/087ffd4b688a4284adf176428b18a4e1"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">空闲空间管理</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/b37523cb699841f382f9cd8848fc52db"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">地址转换机制</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/86cd0e25cedc4fb8b38e855b0532ce96"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">分段</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/44668db8b6384321847a144567e69b07"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">分页</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/424c97d4f4c7434ab4493fb76e1ec5a4"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">分页系统： 快速地址转换TLB</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/452d9fdc4e634a56843ac330ce26fe7c"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">更小的页表</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/9126fd84214f47cfa4600cc91c637e40"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">超越物理内存</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/71d8656ff5ea40019301ca79e0888f2e"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">页交换策略</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/f008e73a3e3a4fbfa411193f14e4a2f2"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">并发</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/8519c55c2d9d45edb6d44e2196311a7d"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">基本概念</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/40a5c35164d54f59b4d23bbf8fdae3ee"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">相关API</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/b2bd23fee9b74397a007426291e66a3a"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">锁</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/f7197b2cb4fa46c5b4b85dbb65a2ed83"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">POSIX库</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/3d4b6dcb6bc44e468b65d251945b2c6e"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">基本概念</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/5815e4a19d964d8f90ae6c97bc95b5b5"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">软件锁</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/4c5a9343f2924c70af17ffa1696f1030"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">硬件锁 </span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/d7f8515eaf6d47539a71d552a18a4963"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">避免（过度）自旋</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/f6e50fc27ee94841847bcf194fa0b5ce"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">条件变量</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/63c67044f1c943ca82d0779cc7ee1892"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">生产者/消费者（有界缓冲区）问题</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/ff20d272ef244d51b2aa87b5079ed797"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">覆盖条件</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/285d0445013447839bc6f68b1b34b648"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">信号量</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/4af9a36e90da4329ad704bfa8d80b95b"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">基本概念</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/22ea2c3244534c299638069231f18d19"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">信号量实现锁（二值信号量），初值为1</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/571d3af5cf2a496a8ba284c9a0b57ff9"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">信号量作为条件变量</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/53c1f33d6135458698f9c4e207c3cb25"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">生产者/消费者（有界缓冲区）问题</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/72d90e682a1b4d80b73b6394286af73a"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">读者-写者问题</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/9a905afb0aa54135acfcd10f26e1cf5b"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">哲学家用餐问题</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/3673e54bfd08446babd4fb09f07a523d"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">用锁和条件变量实现信号量</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/8e0799d9ddd049d6812d4e325c72d341"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">常见并发问题</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/0aa237f7bedd4c3181580be0e836f47c"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">非死锁缺陷：</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/0431517bab0f4645ad6bd09e2b5f76a6"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">死锁缺陷：</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/42c821c8feb94e3099490f7eaaf7aa03"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">安全态与银行家算法：</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/908d7f67b7ce41bbaf1aff44b1caf32d"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">银行家算法：</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/314f9e329ec94662bf17d5efd6415e04"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">缺点：</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/9d46ae1f92a543f28d6741e9e19af03b"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">持久性</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/303a7fe9c7154d048962668279fb913f"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">I/O设备</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/c3e3970736fd40488a9f4268b2ff37b9"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">硬盘设备</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/b5aa8f92b22c4353ac02a84bbb5bdacf"><div style="margin-left:96px"><span class="SemanticStringArray"><span class="SemanticString">两种工作负载</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/5a4d4c91444846d48e09cd17e5dd4c07"><div style="margin-left:96px"><span class="SemanticStringArray"><span class="SemanticString">加速磁盘访问</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/d9d68e9a8abf48a9acf1ab772efeac8b"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">磁盘调度</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/cdc448590ade4cae86a083cf3a139646"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">大容量存储结构RAID（廉价磁盘冗余阵列）</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/7bc2fe5e2f8549bb9abffd0ba2b95bc6"><div style="margin-left:96px"><span class="SemanticStringArray"><span class="SemanticString">RAID 0 级（条带化）</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/e2eb8abc1c7342b9b06fd71a1918dc58"><div style="margin-left:96px"><span class="SemanticStringArray"><span class="SemanticString">RAID 1 级（镜像）</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/4346ee2a1fcf422c963ae3acaa8733ec"><div style="margin-left:96px"><span class="SemanticStringArray"><span class="SemanticString"> RAID 4级（基于奇偶校验的冗余）</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/b9847bf1aa78427fabe3ff01d0a87e25"><div style="margin-left:96px"><span class="SemanticStringArray"><span class="SemanticString">RAID 5级（基于旋转奇偶校验的冗余）</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/47f1bdb0f1f0472aa730d33e5ffff9e7"><div style="margin-left:96px"><span class="SemanticStringArray"><span class="SemanticString">总结</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/5f5438f30e2e435580b7735dfdbac5d0"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">文件系统</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/d4337d1710794a5bb72d9e963706656d"><div style="margin-left:96px"><span class="SemanticStringArray"><span class="SemanticString">文件系统接口</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/68425079eb9b40d5ba531171ba71fc4e"><div style="margin-left:96px"><span class="SemanticStringArray"><span class="SemanticString">硬链接</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/6b9f4fdcf61c41caa61ab9e5044a4c97"><div style="margin-left:96px"><span class="SemanticStringArray"><span class="SemanticString">符号（软）链接</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/03e428a9f844462897472eb1f9aad6c2"><div style="margin-left:96px"><span class="SemanticStringArray"><span class="SemanticString">创建和挂载文件系统</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/9f661d2c97374a0dbf66adc61cbca543"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString">实现文件系统（</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">纯软件）</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/9abd6e82f1c7496097fbcfd3f810dcae"><div style="margin-left:96px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">文件物理结构</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/da282eafa1c143ccb334ea9f375035eb"><div style="margin-left:96px"><span class="SemanticStringArray"><span class="SemanticString">其他组织部分</span></span></div></a></li></ul><h1 id="https://www.notion.so/4f8dd324a7bf4a369a282f153f2e39f5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/4f8dd324a7bf4a369a282f153f2e39f5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">虚拟化 virtualization</span></span></h1><div id="https://www.notion.so/e7828ddf108546c784b6abef003c8b35" class="Divider"></div><h2 id="https://www.notion.so/ba2c120fe17f4bb18fff34704500f351" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/ba2c120fe17f4bb18fff34704500f351"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">进程管理（虚拟化CPU）</span></span></h2><h3 id="https://www.notion.so/29f8b54853394135b6ec705d7c6ccb3c" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/29f8b54853394135b6ec705d7c6ccb3c"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">抽象：进程</span></span></h3><div id="https://www.notion.so/f8a35bd7055f410f813446d9ec558d9c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">进程可简单理解为运行中的程序，程序是指令的有序集合，没有任何执行的含义，而进程则强调的是执行过程，它动态被创建、执行和消亡。不同的进程可以来自于同一程序，只要该程序所对应的数据集不同。</span></span></p></div><div id="https://www.notion.so/6e3e92d647cc4933b3de94fe23967b6c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">进程是</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">运行程序的主要操作系统抽象</mark></span><span class="SemanticString">。在任何时间点，进程都可以用它的状态来描述:地址空间中内存的内容，CPU寄存器的内容(包括程序计数器和堆栈指针等)，以及关于I/O的信息(如可读或可写的打开文件)。</span></span></p></div><div id="https://www.notion.so/b11e2f9d769a425aa1bed0e0f53e436f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">虚拟化cpu的实现，通过让一个进程只运行一个时间片，然后切换到其他进程，提供存在多个虚拟cpu的假象（时分共享CPU技术，对应的磁盘空间是空分共享资源）</span></span></p></div><div id="https://www.notion.so/d383149beaac449cbf54d8540d18dd52" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fc6672b7b-8bd7-4987-b463-70eb46f9778f%2FUntitled.png?width=689&amp;table=block&amp;id=d383149b-eaac-449c-bf54-d8540d18dd52"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fc6672b7b-8bd7-4987-b463-70eb46f9778f%2FUntitled.png?width=689&amp;table=block&amp;id=d383149b-eaac-449c-bf54-d8540d18dd52" style="width:689px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/2ef18b6c4fc9441a92b5a7949401eb54" class="Divider"></div><h3 id="https://www.notion.so/90e45b7546da4376a068004ec0d95352" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/90e45b7546da4376a068004ec0d95352"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">进程API</span></span></h3><ol class="NumberedListWrapper"><li id="https://www.notion.so/b0d21a841b8e4df0b801bb460ce07549" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">创建create</span></span><div id="https://www.notion.so/f0b44f5dcccd41a5bf4263e29b61e328" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff247edf6-c501-47c1-b346-6abb2f5e3a88%2FUntitled.png?width=392&amp;table=block&amp;id=f0b44f5d-cccd-41a5-bf42-63e29b61e328"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff247edf6-c501-47c1-b346-6abb2f5e3a88%2FUntitled.png?width=392&amp;table=block&amp;id=f0b44f5d-cccd-41a5-bf42-63e29b61e328" style="width:392px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/ee0120ceba3347c8bec2f8ab127e4fe4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">运行程序的第一步：将代码，动态数据从磁盘加载到内存，加载到进程的地址空间
一旦代码和静态数据加载到内存中。
必须为程序的运行时堆栈(或仅仅是堆栈)分配一些内存。c程序使用堆栈存储局部变量、函数参数和返回地址;
操作系统分配这些内存并将其分配给进程。
操作系统也可能会用参数初始化堆栈;
具体来说，它将填充main()函数的参数，即argc和argv数组。</span></span></p></div><div id="https://www.notion.so/15a15a5dbfe846509e6a76c0fbb690a2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">此外还有：销毁destroy，   等待wait，   其他控制miscellaneous  暂停，恢复等，   状态statu</span></span></p></div></li><li id="https://www.notion.so/bdb68bd4ba4f4b798251deac851a366b" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">进程状态</span></span></li></ol><div id="https://www.notion.so/132a60239df44373b2166344b72fdd14" class="ColumnList"><div id="https://www.notion.so/07cdd4e279a4430c8d4fd24fcb329f5e" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/f0d03ea1e7b5406fa2b79c8a61980ab7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">进程从执行到阻塞为主动的</span></span></p></div><div id="https://www.notion.so/82ca95d9631048858b99f4b2c858bcae" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">进程从阻塞到就绪是被动的</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/1219e7c28dba4098bc982928f66451c5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">运行running</span></span></li><li id="https://www.notion.so/64b2d69923c743ee83aff49b7ced1ef1" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">就绪ready</span></span></li><li id="https://www.notion.so/cc0d28bcd20241cb9af8f8f39ea1d10d" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">阻塞blocked</span></span><div id="https://www.notion.so/93970ae5cb9d4a34a5cdf2fde02b5e6c" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F5a230160-bfe6-452c-85b5-aa4444800f00%2FUntitled.png?width=240&amp;table=block&amp;id=93970ae5-cb9d-4a34-a5cd-f2fde02b5e6c"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F5a230160-bfe6-452c-85b5-aa4444800f00%2FUntitled.png?width=240&amp;table=block&amp;id=93970ae5-cb9d-4a34-a5cd-f2fde02b5e6c" style="width:240px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></li></ul></div><div id="https://www.notion.so/593475afe5be45358f058302ba43492d" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/685e6e5c9a164133981d12d41174b75a" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F50463ad4-c316-46cc-8f29-db5cecd3d6d0%2FUntitled.png?width=1051&amp;table=block&amp;id=685e6e5c-9a16-4133-981d-12d41174b75a"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F50463ad4-c316-46cc-8f29-db5cecd3d6d0%2FUntitled.png?width=1051&amp;table=block&amp;id=685e6e5c-9a16-4133-981d-12d41174b75a" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/bbe1333b7ab94a95adc7af4205939ff1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div></div><div id="https://www.notion.so/40a68a4cfe764099ac953175e672e0e3" class="ColumnList"><div id="https://www.notion.so/54c4f6602c904a9f8e99051c41716681" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 1)"><ol class="NumberedListWrapper"><li id="https://www.notion.so/e43484f4c4124a2cb7cd55e4b2ec7433" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">OS中有许多数据结构，如进程列表：包含系统中所有进程的信息，进程控制块process control block PCB：储存关于进程的信息的个体结构</span></span></li></ol><div id="https://www.notion.so/aca635466cd44e5487cde64e71888aa3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div><div id="https://www.notion.so/3a3633f7bb074dbd8ef8f5ba3f1ecd6e" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 1)"><div id="https://www.notion.so/f9ed612bfac84b97ac9ddb757c48c8c6" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F0d92b4de-80bb-4361-b83e-5594b1c85e78%2FUntitled.png?width=468&amp;table=block&amp;id=f9ed612b-fac8-4b97-ac9d-db757c48c8c6"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F0d92b4de-80bb-4361-b83e-5594b1c85e78%2FUntitled.png?width=468&amp;table=block&amp;id=f9ed612b-fac8-4b97-ac9d-db757c48c8c6" style="width:468px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/57c45566fa1a46de9c74d0c5644111ec" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/ceacaf382b8c4691baa840a2d7109060" class="Divider"></div><h3 id="https://www.notion.so/f612fd0c4dd14f858fa20108b3be7c41" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/f612fd0c4dd14f858fa20108b3be7c41"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">进程API续（一些常见应用）</span></span></h3><ol class="NumberedListWrapper"><li id="https://www.notion.so/85120c839db64ab990d72753e9b07f5f" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">fork()
创建新的进程
fork的实现分为以下两步
1. 复制进程资源（代码段继续共享父进程的物理空间（</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">两者的代码完全相同，子进程从fork()后继续执行</mark></span><span class="SemanticString">），内核会给子进程的数据段、堆栈段分配相应的物理空间）
2. 执行该进程（加入就绪队列）
</span></span></li><li id="https://www.notion.so/79c62ae9142a44ad80a90acdb065f988" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">wait()
延迟当前进程执行,调用其的进程将进入阻塞态
添加与父进程相关概念</span></span></li></ol><pre id="https://www.notion.so/62ce59cada3b43df950b27322a471c27" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token class-name">pid_t</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>wstatus<span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token comment">// 功能：等待任意一个子进程结束，如果任意一个子进程结束了，此函数会回收子进程   </span>
<span class="token comment">// 参数：int*  wstatus   进程退出时的状态信息，传入的是一个int类型的地址，是传出参数。</span>
<span class="token comment">//返回值：-成功：返回被回收的子进程的id    -失败：-1      </span></span></span></span></code></pre><ol class="NumberedListWrapper"><li id="https://www.notion.so/5e666acb30c24d47b892243bf2ce2fed" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">exec()</span></span></li></ol><div id="https://www.notion.so/2214680dcd7044c1873f215e5ba30a01" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">使用fork()创建子进程后常用exec系列的函数来将子进程替换为新的进程。
用指定的程序替换当前进程的映像。这意味着当前正在运行的程序被停止，而指定的新程序在相同的进程中启动执行，从而不会改变原有的进程ID。覆写当前进程。</span></span></p></div><div id="https://www.notion.so/221405622814474d8a093a91da107675" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">💡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">为何设计这些exec函数</span></span><div id="https://www.notion.so/f9beac93f8d34150b433ea7a3d4ae567" class="ColorfulBlock ColorfulBlock--BgGray Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这种分离 fork()及 exec()的做法在构建 UNIX shell 的时候非常有用，因为这给了 shell 在fork 之后 exec 之前运行代码的机会，这些代码可以在运行新程序前改变环境，从而让一系列有趣的功能很容易实现。</span></span></p></div></p></div><div id="https://www.notion.so/5b5a82f76a3844c686aed8391f1489ef" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">貌似要重点关注书上32,33,34页？也可能是31
关于shell的实现</strong></em></span></span></p></div><div id="https://www.notion.so/5dbc187aec8b4af59ced7434f420331e" class="ColumnList"><div id="https://www.notion.so/769202ecc8734a5aa9c4a7d75a132fe0" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5000000000000001)"><div id="https://www.notion.so/a76d9ea45c5c4cc3814859472a4a7040" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">操作系统领域中，</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">孤儿进程</strong></span><span class="SemanticString">指的是在其父进程执行完成或被终止后仍继续运行的一类进程。 这些孤儿进程将被init进程 所收养，并由init进程对它们完成状态收集工作</span></span></p></div></div><div id="https://www.notion.so/b95c96a5ee504f62899a4b3bfd102bd0" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/ad0d1aeb0a624fbcacc8f4a6431ddb8a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">僵尸进程</strong></span><span class="SemanticString">是当子进程比父进程先结束，而父进程又没有回收子进程，释放子进程占用的资源，此时子进程将成为一个僵尸进程。
</span></span></p></div></div></div><div id="https://www.notion.so/7f8fe314826c4dc8b57dff112ab0fbaf" class="Divider"></div><h3 id="https://www.notion.so/d848bd6e29bb4af5bdcae37ba697c4e5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/d848bd6e29bb4af5bdcae37ba697c4e5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">机制：受限直接执行</span></span></h3><div id="https://www.notion.so/515020007fe644e2988d44b316747795" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">虚拟化带来了一些问题：</span></span></p></div><div id="https://www.notion.so/be6b9e7bb5d548ec823c6c3d8697b34b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed">性能</mark></span><span class="SemanticString">问题:如何在不给系统增加过多开销的情况下实现虚拟化?
第二个是</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed">控制权</mark></span><span class="SemanticString">:我们如何在保持对CPU控制的同时高效地运行进程?</span></span></p></div><div id="https://www.notion.so/00a6f68d1c354427ac65abe3cfa4f40a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">→</span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">受限直接执行</em></span></span></p></div><div id="https://www.notion.so/a9dc5ffe970244fd98ebfd4abc1acdce" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">为什么不直接执行？</strong></em></span></span></p></div><div id="https://www.notion.so/efdb5c78a0f841538a0154260fdbf8dc" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fc58368c1-0e0a-4058-a622-e728939f7af1%2FUntitled.png?width=1536&amp;table=block&amp;id=efdb5c78-a0f8-4153-8a01-54260fdbf8dc"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fc58368c1-0e0a-4058-a622-e728939f7af1%2FUntitled.png?width=1536&amp;table=block&amp;id=efdb5c78-a0f8-4153-8a01-54260fdbf8dc" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/eb5244523df64b108a1c856f89b2969f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">答：通过fork（），OS一旦把控制权交给用户进程可能就失去了控制（CPU和其他硬件），且若进程希望进行受限操作（如进行I/O操作或内存申请），如何进行？</span></span></p></div><blockquote id="https://www.notion.so/08f2ffe40d90457ea75b56e57a9b356d" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">一个进程必须能够执行 I/O 和其他一些受限制的操作，但又不能让进程完全控制系统。</span></span></blockquote><div id="https://www.notion.so/623a057e94b540aa81aae5c6fd639c8b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">使用一种”受保护的控制权转移“</strong></em></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/7b4c4ff545bc42109f1c7f0b1c05836c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">在</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">用户模式（user mode）</strong></span><span class="SemanticString">下，应用程序不能完全访问硬件资源。</span></span></li><li id="https://www.notion.so/bee597ed5b3e4532a9b61775a09c71cd" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">在</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">内核模式（kernel mode）</strong></span><span class="SemanticString">下，操作系统可以访问机器的全部资源。还提供了陷入（trap）内核和从陷阱返回（return-from-trap）到用户模式程序的特别说明，以及一些指令，让操作系统告诉硬件陷阱表（trap table）在内存中的位置。</span></span></li></ul><div id="https://www.notion.so/be3169c3dccd4018a5c3a73bab890ea3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">用户程序只能通过OS的系统调用进入到内核态，使用特权操作：</strong></em></span></span></p></div><div id="https://www.notion.so/177a69ed0f5c41cd95d0973eff74191e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">用户要想访问内核空间，必须</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">借助操作系统提供的 API 函数，执行内核提供的代码</span></span><span class="SemanticString">，让内核自己来访问，这样才能</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">保证内核空间的数据不会被随意修改</span></span><span class="SemanticString">，才能保证操作系统本身和其他程序的稳定性。
</span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">用户态→核心态的三种方式：</strong></em></span></span></p></div><div id="https://www.notion.so/97209897c9e84cf0980feeb06f529a52" class="ColumnList"><div id="https://www.notion.so/9212970af70f437594b5065881496e28" class="Column" style="width:calc((100% - var(--column-spacing) * 2) * 0.3333333333333333)"><div id="https://www.notion.so/32e23de50cb34897acd06a9b19e16421" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">系统调用*</mark></span><span class="SemanticString"> 这是用户态进程</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">主动要求切换</span></span><span class="SemanticString">到内核态的一种方式，用户态进程通过系统调用申请使用操作系统提供的服务程序完成工作。而系统调用的机制其核心还是使用了操作系统为用户特别开放的一个中断来实现，例如Linux的int 80h中断（int 0x80）。</span></span></p></div></div><div id="https://www.notion.so/9ed8d5cfad7447a485589584886d6526" class="Column" style="width:calc((100% - var(--column-spacing) * 2) * 0.3333333333333333)"><div id="https://www.notion.so/55a81b65cc9240ef973ec796ebbb9ae9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">异常 </mark></span><span class="SemanticString">当CPU在执行运行在用户态下的程序时，发生了某些事先不可知的异常，这时会</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">触发由当前运行进程切换到处理此异常的内核相关程序中</span></span><span class="SemanticString">，也就转到了内核态，比如缺页异常。
</span></span></p></div></div><div id="https://www.notion.so/39d408c0ee244c3fac27d426576289da" class="Column" style="width:calc((100% - var(--column-spacing) * 2) * 0.3333333333333333)"><div id="https://www.notion.so/735d593573724988bdd3da7a5efb80cf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">外围设备的中断 </mark></span><span class="SemanticString">当外围设备完成用户请求的操作后，会向CPU发出相应的中断信号，这时CPU会暂停执行下一条即将要执行的指令转而去执行与中断信号对应的处理程序。比如硬盘读写操作完成，系统会切换到硬盘读写的中断处理程序中执行后续操作等。</span></span></p></div></div></div><div id="https://www.notion.so/ea02c9aea4c1421caaebbf963e77abfe" class="Divider"></div><div id="https://www.notion.so/1347f9e441de432c842f648adcb5f529" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">重点介绍系统调用：</strong></em></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">
陷阱(trap):</strong></span></span></p></div><div id="https://www.notion.so/6890786ba558431384977ac28076fb23" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">程序执行特殊的陷阱（trap）指令。该指令跳入内核并将特权级别提升到内核模式。进入内核，系统就可以执行任何需要的特权操作（如果允许），从而为调用进程执行所需的工作。</span></span></p></div><div id="https://www.notion.so/8ff394b9114a4e19be43add15bd4b18c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">完成后，操作系统调用一个特殊的从陷阱返回（return-from-trap）指令，该指令实现从内核态到用户态。</span></span></p></div><div id="https://www.notion.so/d171e089efba4bdeba3ef50095e4d121" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">陷阱如何知道在 OS 内运行哪些代码？→</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">陷阱表（trap table）：</strong></span></span></p></div><div id="https://www.notion.so/3d0114d8a9854787b5e6986a0d0a00b9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">内核通过在启动时设置陷阱表（trap table）</strong></em></span><span class="SemanticString">来实现。当机器启动时，它在特权（内核）模式下执行，操作系统做的第一件事，就是告诉硬件在发生某些异常事件时要运行哪些代码。操作系统通常通过某种特殊的指令，通知硬件这些陷阱处理程序的位置。一旦硬件被通知，它就会记住这些处理程序的位置，直到下一次重新启动机器。</span></span></p></div><div id="https://www.notion.so/b67982de379a411e8d068c3e193e5c17" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">设置陷阱表是一项特权操作。</mark></span></span></p></div><div id="https://www.notion.so/e317d71c4e144efcaf72c08ee20510b6" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fffc3cbd0-7fe9-44a7-9288-99477a1cb32a%2FUntitled.png?width=1536&amp;table=block&amp;id=e317d71c-4e14-4efc-af72-c08ee20510b6"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fffc3cbd0-7fe9-44a7-9288-99477a1cb32a%2FUntitled.png?width=1536&amp;table=block&amp;id=e317d71c-4e14-4efc-af72-c08ee20510b6" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/e2b8cf26672443cbada72e3e218af0ee" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">进程执行时，进程在CPU上运行，操作系统如何重获控制权?</span></span></p></div><div id="https://www.notion.so/7ad9e564b9bc46c7bcbc54702af7dd03" class="Divider"></div><div id="https://www.notion.so/d093804b84374fd4a12d4367fc039d58" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">实现在进程中的切换：</strong></em></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/eaa8fcd545584010bad7a05dfe19a4fd" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">协作方式：等待系统调用
远古时期：操作系统相信系统的进程会合理运行。运行时间过长的进程被假定会定期放弃 CPU，以便操作系统可以决定运行其他任务。
大多进程：通过进行系统调用（yield），将 CPU 的控制权转给操作系统
应用程序执行了某些非法操作：将控制转移给操作系统</span></span></li></ul><div id="https://www.notion.so/645b527015894de8bc630f5506ba39d6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">如果某个进程进入无限循环，并且从不进行系统调用，怎么办？</em></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/8e08146fe9f44a7cae67dca329ccbaa5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">非协作方式：操作系统进行控制
时间中断（定时器中断）：时钟设备可以编程为每隔几毫秒产生一次中断</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">。产生中断时，当前正在运行的进程停止，操作系统中预先配置的中断处理程序（interrupt handler）会运行</span></span><span class="SemanticString">。此时，操作系统重新获得 CPU 的控制权。（获取控制权如何进行下一步分配，将由</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed">CPU调度功能</mark></span><span class="SemanticString">决定）</span></span></li></ul><div id="https://www.notion.so/665a88edb9ef4cfc9b0ecab9a4ac0521" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当确定要切换进程时需要→</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">上下文切换（context switch）：</strong></span></span></p></div><div id="https://www.notion.so/3cad45550d7f4c7bb1cdff6f058a398e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">操作系统要做的就是</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">为当前正在执行的进程保存一些寄存器的值</span></span><span class="SemanticString">（例如，到它的内核栈），并</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">为即将执行的进程恢复一些寄存器的值</span></span><span class="SemanticString">（从它的内核栈）。这样一来，操作系统就可以</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">确保最后执行从陷阱返回指令后</span></span><span class="SemanticString">，不是返回到之前运行的进程，而是</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">继续执行另一个进程</span></span><span class="SemanticString">。</span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">（P43)</mark></em></span></span></p></div><div id="https://www.notion.so/e2b0e8fb431a4adbbccbdb19f33a74d1" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff69c792b-aa59-494e-81aa-cd354870b966%2FUntitled.png?width=713&amp;table=block&amp;id=e2b0e8fb-431a-4adb-bccb-db19f33a74d1"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff69c792b-aa59-494e-81aa-cd354870b966%2FUntitled.png?width=713&amp;table=block&amp;id=e2b0e8fb-431a-4adb-bccb-db19f33a74d1" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/3302046165504468a8049d3a844959f1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">如果在系统调用期间发生中断或处理中断时发生中断怎么办？→第二部分</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed">并发 
</mark></span><span class="SemanticString">用锁等来保证原子，临界区思想等？</span></span></p></div><h3 id="https://www.notion.so/8d01e9cdc5c34074ad6a9f07a1eee7e0" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/8d01e9cdc5c34074ad6a9f07a1eee7e0"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">进程调度（3+1）</span></span></h3><div id="https://www.notion.so/78c8d0acda214eb6827d8b8abcb2fd33" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">基本思想：</strong></em></span></span></p></div><div id="https://www.notion.so/97e6f49596844327aa3ea49569cd2b94" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">调度指标：</span></span></p></div><blockquote id="https://www.notion.so/c68e449e51eb44e2a35207e44f3cf863" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">周转时间=完成-到达</span></span></blockquote><div id="https://www.notion.so/746159b3732c46afb51965ddabb2e9f5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">先进先出FIFO</strong></span><span class="SemanticString">  先来的可能要执行很久</span></span></p></div><div id="https://www.notion.so/1161a9e812584865adb2091282d736e5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">👇</span></span></p></div><div id="https://www.notion.so/b00c4b50e26948a3a450fd942c19ab39" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">最短任务优先（Shortest Job First, SJF）</strong></span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"> </strong></span></span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">后到的短任务还是得等长任务</span></span></span></p></div><div id="https://www.notion.so/1977be7613024577b36c75520b96cdc0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">👇</span></span></p></div><div id="https://www.notion.so/7159842448a34f70b5d652c315b827ca" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">最短完成时间优先（Shortest Time-to-Completion Firsts, STCF/抢占最短作业优先PSJF）</strong></span><span class="SemanticString">  </span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">在响应时间指标上表现不理想</span></span></span></p></div><blockquote id="https://www.notion.so/ee5ef100ac654748bb2dcf0002edbd11" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">响应时间=首次运行-到达</span></span></blockquote><div id="https://www.notion.so/11cb3ad324a84f7b95665f713825be79" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">轮转（Round-Robin，RR）  </strong></span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">并未改善周转时间</span></span></span></p></div><div id="https://www.notion.so/b3a693d2662a442082e24c3a4e2acd95" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">RR 在一个时间片（time slice，有时称为调度量子，scheduling quantum）内运行一个工作，然后切换到运行队列中的下一个任务，而不是运行一个任务直到结束。它反复执行，直到所有任务完成。</span></span></p></div><div id="https://www.notion.so/705919b487b4475dba012a2ef6c6eb7f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当继续考虑I/O时</span></span></p></div><div id="https://www.notion.so/1abab213a211409dab8434a9bff7a63f" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8f8825c7-9393-499f-9e38-a44e5e85c660%2FUntitled.png?width=536&amp;table=block&amp;id=1abab213-a211-409d-ab84-34a9bff7a63f"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8f8825c7-9393-499f-9e38-a44e5e85c660%2FUntitled.png?width=536&amp;table=block&amp;id=1abab213-a211-409d-ab84-34a9bff7a63f" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/a818febfe18a492f8ce70d11967d34de" class="Divider"></div><div id="https://www.notion.so/9e4ba3a1765f4ee99f232092fd7c045d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">多级反馈队列（Multi-level Feedback Queue, MLFQ）
</strong></em></span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">在没有工作长度的先验知识的情况下，尝试同时减少响应时间和周转时间</em></span></span></span></p></div><div id="https://www.notion.so/f8239c2cc5ec414080020e175c0a1097" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">MLFQ拥有多级队列，优先级不同</em></span></span><span class="SemanticString">
</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">规则：</strong></span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/f224b33ce87e4a14929aedca62ce5da1" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">如果 A 的优先级 &gt; B 的优先级，运行 A（不运行 B）。 → 确保高优先级工作优先运行</span></span></li><li id="https://www.notion.so/5ccfc069bb8746139786a5ebd775b6fc" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString"> 如果 A 的优先级 = B 的优先级，轮转运行 A 和 B。  → 同优先级时减少响应时间 </span></span></li><li id="https://www.notion.so/914acd3398874f85b1cb8eba51b539d6" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">工作进入系统时，放在最高优先级（最上层队列） → 防止后来的进程饿死</span></span></li><li id="https://www.notion.so/654c74bcdcfd435e9f4787235b5d9f5d" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">一旦工作用完了其在某一层中的时间配额（无论中间主动放弃了多少次CPU），就降低其优先级（移入低一级队列）。 →防止进程垄断CPU，保证公平的CPU分配</span></span></li><li id="https://www.notion.so/7554a36ccd9d4eb1a93457b7881a496e" class="NumberedList" value="5"><span class="SemanticStringArray"><span class="SemanticString">经过</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">一段时间 </span></span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">S</em></span></span><span class="SemanticString">，就将系统中所有工作重新加入最高优先级队列。 → 确保进程不被饿死；确保调度的正确性（如果一个CPU密集型工作变成了交互型）</span></span></li></ol><div id="https://www.notion.so/b75300dca63f42cbb847624ee8b40724" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">存在一些配置问题：</span></span></p></div><div id="https://www.notion.so/4aa7d4579d9b4d8a8e355d0e053e84ac" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">💡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">配置多少队列？每一层队列的时间片配置多大？为了避免饥饿问题以及进程行为改变，应该多久提升一次进程的优先级（巫毒常量：一段时间S)？这些问题都没有显而易见的答案，因此只有利用对工作负载的经验，以及后续对调度程序的调优，才会导致令人满意的平衡。</span></span></p></div><div id="https://www.notion.so/84d1f7c12857437b95317307b1185197" class="Divider"></div><div id="https://www.notion.so/8575a809468240abac4d717f94dbf707" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">比例份额（彩票或步长）：</strong></em></span></span></p></div><div id="https://www.notion.so/46e277da80cf4b17badeffc9c9c6887f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">比例份额算法基于一个简单的想法：调度程序的最终目标，是确保每个工作获得一定比例的 CPU 时间，而不是优化周转时间和响应时间。</span></em></span></span></p></div><div id="https://www.notion.so/38cc2dac6e0f4c38baea3219de7c9999" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">彩票调度： 利用随机性</strong></span></span></p></div><div id="https://www.notion.so/2275a1febcd34224a0620e178f60455f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">利用彩票占用的百分比来表示一个进程占用的cpu的份额，当举行抽奖时，彩票中奖，该进程执行。</span></span></p></div><div id="https://www.notion.so/bab06a40620a4b2cb9359c55493814ab" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">彩票机制：彩票调度还提供了一些机制，以不同且有效的方式来调度彩票。</span></span></p></div><div id="https://www.notion.so/b492e8ddf4ca43b2b4744bb081479c51" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">💡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">彩票货币（ticket currency）：加入一个抽象层，可以让</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">任务组自由修改组内的份额</mark></span><span class="SemanticString">。
假设用户 A 和用户 B 每人拥有 100 张彩票。用户 A 有两个工作 A1 和 A2，他以自己的货币，给每个工作 500 张彩票（共 1000 张）。用户 B 只运行一个工作，给它 10 张彩 票（总共 10 张）。操作系统将进行兑换，将 A1 和 A2 拥有的 A 的货币 500 张，兑换成全局 货币 50 张。类似地，兑换给 B1 的 10 张彩票兑换成 100 张。然后会对全局彩票货币（共 200 张）举行抽奖，决定哪个工作运行。</span></span></p></div><div id="https://www.notion.so/d26de5834f6d4535aeacf5ebc038c85a" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">💡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">彩票转让（ticket transfer）：通过转让，一个</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">进程可以临时将自己的彩票交给另一个进程</mark></span><span class="SemanticString">。
这种机制在客户端/服务端交互的场景中尤其有用，在这种场景中，客户端进程向服务端发送消息，请求其按自己的需求执行工作，为了加速服务端的执行，客户端可以将自己的彩票转让给服务端，从而尽可能加速服务端执行自己请求的速度。服务端执行结束后会将这部分彩票归还给客户端。</span></span></p></div><div id="https://www.notion.so/7f048e0d8b384e899109c32994511622" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">💡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">彩票通胀（ticket inflation）：利用通胀，一个</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">进程可以临时提升或降低自己拥有的彩票数量</mark></span><span class="SemanticString">。
当然在竞争环境中，进程之间互相不信任，这种机制就没什么意义。一个贪婪的进程可能给自己非常多的彩票，从而接管机器。但是，通胀可以</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">用于进程之间相互信任的环境</mark></span><span class="SemanticString">。在这种情况下，如果一个进程知道它需要更多 CPU 时间，就可以增加自己的彩票，从而将自己的需求告知操作系统，这一切不需要与任何其他进程通信。</span></span></p></div><div id="https://www.notion.so/89b313bd86c8497dae847496af7a846c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">公平性：</span></span></p></div><div id="https://www.notion.so/8e66ad7eb7544944b171b11bc5875d10" class="ColumnList"><div id="https://www.notion.so/bc193270f3aa418c9fd9ffeb41d9391a" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/91d186b3553d4eb6b5d4a4c7a5275aa0" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F9696460e-0481-47d3-a66b-bda3b38fd29f%2FUntitled.png?width=301&amp;table=block&amp;id=91d186b3-553d-4eb6-b5d4-a4c7a5275aa0"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F9696460e-0481-47d3-a66b-bda3b38fd29f%2FUntitled.png?width=301&amp;table=block&amp;id=91d186b3-553d-4eb6-b5d4-a4c7a5275aa0" style="width:301px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div><div id="https://www.notion.so/b0e491d35ad4457998978a3110539174" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/540280d8b87f412680dc75188be8b3a2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">可以看出，当工作执行时间很短时，平均不公平度非常糟糕。只有当工作执行非常多的时间片时，彩票调度算法才能得到期望的结果。</span></span></p></div><div id="https://www.notion.so/5b84ae01a47448eeaf3f5493e840b15b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">如何分配彩票呢：</mark></span></span></p></div><div id="https://www.notion.so/b4f91f2e3de342fe863a178b1b4f7bc2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">棘手的问题，系统的运行严重依赖于彩票的分配。假设用户自己知道如何分配，因此可以给每个用户一定量的彩票，由用户按照需要自主分配。</span></span></p></div><div id="https://www.notion.so/425b89b8130847e3a0f9def4088c2735" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div></div><div id="https://www.notion.so/df29c281f53244f79d21d63a99c2e250" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">分配给自己的工作。然而这种方案似乎什么也没有解决——还是没有给出具体的分配策略。因此对于给定的一组工作，</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">彩票分配的问题依然没有最佳答案。</span></span></span></p></div><div id="https://www.notion.so/29f2cd728a394549a62159f9fef6888c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">================================================</span></span></p></div><div id="https://www.notion.so/fb42a3356c324ad0a2851699f1fcdc37" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">步长调度：确定性的公平分配算法</strong></span></span></p></div><div id="https://www.notion.so/edf90a344bbd497594b372b079ae0287" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">系统中的每个工作都有自己的步长，这个值与彩票数值成反比。</span></span></p></div><div id="https://www.notion.so/c0b86747015243bbb4e909a694221125" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">💡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">例子中，A、B、C 这 3 个工作的票数分别是 100、50 和 250，我们通过用一个大数分别除以他们的票数来获得每个进程的步长。比如用 10000 除以这些票数值，得到了 3 个进程的步长分别为 100、200 和 40。我们称这个值为每个进程的步长（stride）。每次进程运行后，我们会让它的计数器 [称为行程（pass）值] 增加它的步长，记录它的总体进展。</span></span></p></div><div id="https://www.notion.so/0ea75d652a37489abdb0b069a60573f5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">调度时，选择目前拥有最小行程值的进程，并且在运行之后将该进程的行程值增加一个步长。</span></span></p></div><div id="https://www.notion.so/fdecdac8d66c488488353fa76b023888" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">总结：</strong></span></span></p></div><div id="https://www.notion.so/d3eee42a0c0c493d8b558e8237d982a3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">彩票调度</mark></span><span class="SemanticString">有一个步长调度没有的优势——</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">不需要全局状态</mark></span></span></p></div><div id="https://www.notion.so/cf756a5bfb5b40eb98937b2e3ce6bc25" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">这两种比例份额调度没有作为 CPU 调度程序被广泛使用。一个原因是这两种方式都</em></span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">不能很好地适合 I/O  </mark></em></span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">，且比例份额不好确定</em></span></span></p></div><div id="https://www.notion.so/0b5c4d20f8aa49e6b87b2b73c1293032" class="Divider"></div><h2 id="https://www.notion.so/d943c6f477954221ba404388e0c0d49f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/d943c6f477954221ba404388e0c0d49f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">内存管理（虚拟化内存）</span></span></h2><div id="https://www.notion.so/f79a53bf3f6746c9bbe3eab1502d3bf6" class="Divider"></div><h3 id="https://www.notion.so/ec8b5dab049a4692a6f7316d1c183bbe" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/ec8b5dab049a4692a6f7316d1c183bbe"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">地址空间</span></span></h3><div id="https://www.notion.so/4ba87934dac94ef89f015dfbe563ebf8" class="ColumnList"><div id="https://www.notion.so/0351179f2b7143a1a36a826ef6b4080d" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/c45a3e7b0afd4f588dc76584347e1986" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F66dfd4db-a497-49d8-ad7e-b58d192e7630%2FUntitled.png?width=243.9375&amp;table=block&amp;id=c45a3e7b-0afd-4f58-8dc7-6584347e1986"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F66dfd4db-a497-49d8-ad7e-b58d192e7630%2FUntitled.png?width=243.9375&amp;table=block&amp;id=c45a3e7b-0afd-4f58-8dc7-6584347e1986" style="width:243.9375px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div><div id="https://www.notion.so/6b61fb4e9b6a4517ab167afc14be7700" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/1f62b02466e44423beb04381cac68244" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">地址空间（address space），是</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">运行的程序看到的系统中的内存。</mark></span></span></p></div><div id="https://www.notion.so/cc404e437e244445a6c9dfb1027029ec" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当我们描述地址空间时，所描述的是操作系统提供给运行程序的抽象（abstract）。程序不在物理地址 0～16KB 的内存中，而是加载在任意的物理地址。</span></span></p></div><div id="https://www.notion.so/88b363df9c7f4f8d930b995d251d3c0d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div></div><blockquote id="https://www.notion.so/d741c0dc0e2748c0a410cd7118d551f0" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">操作系统的一个重要子系统：虚拟内存。
虚拟内存系统负责为程序提供一个巨大的、稀疏的、私有的地址空间的假象，其中保存了程序的所有指令和数据。操作系统在专门硬件的帮助下，通过每一个虚拟内存的索引，将其转换为物理地址，物理内存根据获得的物理地址段获取所需的信息。
操作系统会同时对许多进程执行此操作，并且确保程序之间互相不会受到影响，也不会影响操作系统。整个方法需要大量的机制（很多底层机制）和一些关键的策略。</span></span></blockquote><div id="https://www.notion.so/1464daeaf45d4e5db6729f6daa279379" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">虚拟内存（VM）系统的一个主要目标:</strong></span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/563afa712a6f4c96bdb0f50e00a13b85" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">透明：操作系统实现虚拟内存的方式，应该让运行的程序看不见。</span></span></li><li id="https://www.notion.so/89c4c27ca9a841cb9d91e58153150b4a" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">效率：</span></span></li><li id="https://www.notion.so/777e5b9851cc403bbf15baadc4a440e4" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">保护：当一个进程执行加载、存储或指令提取时，它不应该以任何方式访问或影响任何其他进程或操作系统本身的内存内容（即在它的地址空间之外的任何内容）。</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">在进程间提供隔离，每个进程都应该在自己的独立环境中运行</mark></span></span></li></ol><h3 id="https://www.notion.so/064a659e53764da59d5d18d58c1a1749" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/064a659e53764da59d5d18d58c1a1749"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">内存操作API</span></span></h3><div id="https://www.notion.so/b01337e46a934b0eafd5aabfcc708544" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">malloc()调用</strong></span></span></p></div><div id="https://www.notion.so/35eb9d32984a4d79867256ae46b7178a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">传入要申请的堆空间的大小，它成功就返回一个指向新申请空间的指针，失败就返回 NULL</span></span></p></div><div id="https://www.notion.so/182f1bee899b47c3894bced7ff077074" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">free()调用</strong></span></span></p></div><div id="https://www.notion.so/76efd78f13c34df5911f56ff03bd410b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">要释放不再使用的堆内存，程序员只需调用 free()
两者使用时容易出错，注意判断</span></span></p></div><h3 id="https://www.notion.so/087ffd4b688a4284adf176428b18a4e1" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/087ffd4b688a4284adf176428b18a4e1"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">空闲空间管理</span></span></h3><div id="https://www.notion.so/d65b99719f2c454381ba29109c02c648" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorOrange">内部碎片/内零头</mark></strong></span><span class="SemanticString">（internal fragmentation）</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">已经分配的内存单元内部的未被利用的空间/分配给作业的存储空间（内存）中未被利用的部分</strong></span></span></p></div><div id="https://www.notion.so/5fb45dbf31f042b3a286a9d9b9bd3eda" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorOrange"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">外部碎片/外零头</strong></mark></span><span class="SemanticString">（external fragmentation）</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">系统中无法利用的小存储块</strong></span></span></p></div><div id="https://www.notion.so/f9506b313bd3462ebd069747d8882092" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">如何管理？</strong></span></span></p></div><div id="https://www.notion.so/529c6b2f4ee44bb69dd7fd106fc19c6d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">void free(void *ptr)函数接受一个指针，释放对应的内存块。在释放空间时，用户不需告知库这块空间的大小。因此，在只传入一个指针的情况下，库（库管理的空间称为堆）必须能够弄清楚这块内存的大小。
</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">空闲列表（free list）</strong></span></span></p></div><div id="https://www.notion.so/2f0c2e3060c245ab94773ed31e5cf0bf" class="ColumnList"><div id="https://www.notion.so/3621c7f3c80944f4a77102384f6279ee" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/cfe5dca54d3e43f08fc49ae943cc1ecf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在堆上管理空闲空间的数据结构通常称为空闲列表（free list）</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">空闲列表包含一组元素，记录了堆中的哪些空间还没有分配。</span></span></span></p></div></div><div id="https://www.notion.so/a1f537b1630a4df396c70b0418f6f3d6" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/22c71076a8bb4e3ea10dce20f951aab9" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ffa21d13c-8dc2-457b-9cd2-136e5f324f19%2FUntitled.png?width=291&amp;table=block&amp;id=22c71076-a8bb-4e3e-a10d-ce20f951aab9"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ffa21d13c-8dc2-457b-9cd2-136e5f324f19%2FUntitled.png?width=291&amp;table=block&amp;id=22c71076-a8bb-4e3e-a10d-ce20f951aab9" style="width:291px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/00fda9bb5d8140ff816a8c56c27b24d9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">其需要具备分割与合并的功能：</span></span></p></div><blockquote id="https://www.notion.so/2b0e45798f3c4838a53c58cae5c9e0b0" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">分割（splitting）：它找到一块可以满足请求的空闲空间，将其分割，第一块返回给用户，第二块留在空闲列表中。
合并（coalescing)：在归还一块空闲内存时，仔细查看要归还的内存块的地址以及邻近的空闲空间块。如果新归还的空间与一个原有空闲块相邻，就将它们合并为一个较大的空闲块。</span></span></blockquote><div id="https://www.notion.so/747f37ba359040ff9a301deb04fbffc5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">已分配空间追踪</strong></span></span></p></div><div id="https://www.notion.so/cf17e9bdcbf64257a68e3004155c7169" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">大多数分配程序考虑在分配的空闲块之前加一个信息头（header），用于保存分配空间的大小</span></span></p></div><div id="https://www.notion.so/bd909a86da68466b8b431d9b31c4078a" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8fd7d7c4-39aa-4eb3-be67-3cdea96e61e7%2FUntitled.png?width=654&amp;table=block&amp;id=bd909a86-da68-466b-8b43-1d9b31c4078a"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8fd7d7c4-39aa-4eb3-be67-3cdea96e61e7%2FUntitled.png?width=654&amp;table=block&amp;id=bd909a86-da68-466b-8b43-1d9b31c4078a" style="width:654px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/8aa0977c04994b52820852d0bca854c8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">magic提供完整性检查以及一些信息。</span></span></p></div><div id="https://www.notion.so/608b5df0d1934f9d9535aa0521d8a508" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">free时</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">实际释放的空间是头块大小加上分配的空间大小</span></span></span></p></div><div id="https://www.notion.so/8a952ac2e3d74252a58ed48f06e81c13" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">嵌入空闲列表</strong></span></span></p></div><div id="https://www.notion.so/64acc4e9142c41ac91f293c85404ad05" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在内存分配库中，需要</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">在空闲空间本身建立空闲空间列表</span></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">P123</span></em></strong></span></span></p></div><div id="https://www.notion.so/b7e1408f00d64dd687da248a7abbdc10" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">一些空闲空间管理的妙妙方式：</strong></span></span></p></div><div id="https://www.notion.so/d24882c387c44524a11c8eb75a142311" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">最优匹配：</em></strong></span></span></p></div><div id="https://www.notion.so/20e96ea596324cc4bf5b9e44859ac76f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">遍历，找和请求的大小相近的  </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">较高性能代价</code></span></span></p></div><div id="https://www.notion.so/e666a418b1ac4525be3326efd8564609" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">最差匹配：</strong></em></span></span></p></div><div id="https://www.notion.so/e40b60e4ab1d492985a1ba9b4a99d846" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">遍历，找最大的空闲块  </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">会导致过量的外部碎片，高开销</code></span></span></p></div><div id="https://www.notion.so/0333c33e0c61438a97dad582bb906e19" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">首次匹配：</strong></em></span></span></p></div><div id="https://www.notion.so/d1c15530d399431e8a07ab02f04af281" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">找第一个足够大的块  </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">速度快，但容易让空闲列表头部有很多小块 需要合理管理列表顺序</code></span></span></p></div><div id="https://www.notion.so/72bd8b3f5595433da7c766b56a5b5ea6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">下次匹配：</em></strong></span></span></p></div><div id="https://www.notion.so/4941490d0ec64643b4340aee50cb7d43" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">多维护一个指针，指向上一次查找的位置，将对空闲列表的查找扩散到整个列表  </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">优化的首次匹配</code></span></span></p></div><div id="https://www.notion.so/8f6118e9066446ee9c59a87e32da02ce" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">分离空闲列表：</strong></em></span></span></p></div><div id="https://www.notion.so/14c7714fd6d54c1082bd5eac30c83441" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">如果某个应用程序</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">经常申请一种（或几种）大小的内存空间，那就用一个独立的列表，只管理这样大小的对象</span></span><span class="SemanticString">。通过拿出一部分内存专门满足某种大小的请求，碎片就不再是问题了。而且，由于没有复杂的列表查找过程，这种特定大小的内存分配和释放都很快。</span></span></p></div><div id="https://www.notion.so/18c0202195104a83aa96bdc1a7dbc121" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">提高了复杂度</code></span></span></p></div><div id="https://www.notion.so/e5009cb601f24a04bb1815c36f3fa012" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">伙伴系统：</strong></em></span></span></p></div><div id="https://www.notion.so/f244c8d3c4ad4ed781e508006b422d65" class="ColumnList"><div id="https://www.notion.so/f1d9a8482440484cba335a58eab65ec2" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/60ce8b1b1ad0407981d2cd8acea9ac5b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">空闲空间首先从概念上被看成大小为 </span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Math" data-latex="2^N "><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>N</mi></msup></mrow><annotation encoding="application/x-tex">2^N </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="SemanticString">的大空间。当有一个内存分配请求时，空闲空间被递归地一分为二，直到刚好可以满足请求的大小（再一分为二就无法满足）。这时，请求的块被返回给用户。</span></span></p></div><div id="https://www.notion.so/5cc89bffc74f4ff4bc2521e413a87e83" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">只允许分配 2 的整数次幂大小的空闲块，因此会有内部碎片（internal fragment）的麻烦。</code></span></span></p></div><div id="https://www.notion.so/a67419d969e4456fb0798a582c147ad3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div><div id="https://www.notion.so/2b21b104c45b426f88ed61684bfb4d50" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/071f438bf3de497a8d7b47a24e4e67d4" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F141cfa35-8847-4825-8706-1685fb8382b5%2FUntitled.png?width=391&amp;table=block&amp;id=071f438b-f3de-497a-8d7b-47a24e4e67d4"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F141cfa35-8847-4825-8706-1685fb8382b5%2FUntitled.png?width=391&amp;table=block&amp;id=071f438b-f3de-497a-8d7b-47a24e4e67d4" style="width:391px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/4294fee8909b4ae6ab88cafe56c0c087" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">释放时：查找伙伴（邻居节点）是否空闲，空闲时合并并向上递归查询，</span></span></p></div><div id="https://www.notion.so/62423efd1a8a47aeae066765759ac50e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h3 id="https://www.notion.so/b37523cb699841f382f9cd8848fc52db" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/b37523cb699841f382f9cd8848fc52db"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">地址转换机制</span></span></h3><div id="https://www.notion.so/7a9d9d719d584b3a9773e82e1b4077c5" class="ColumnList"><div id="https://www.notion.so/cc30df2dcd514c9494fa3f5b081b7861" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/355c4d10c94f4d9f845ad8ea8363f624" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">虚拟转物理，每次内存引用都会地址转化</span></span></p></div><div id="https://www.notion.so/3bbe144243744c02b409dbaae82f191b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">动态重定位（基于硬件,在运行时进行）：
</strong></span><span class="SemanticString">引入两个寄存器，基址寄存器和界限寄存器，确保能将地址空间映射到物理内存，同时保证其只能访问自己的空间，</span></span></p></div><div id="https://www.notion.so/660c84206abf44a3ab06aca65d171161" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div><div id="https://www.notion.so/8af09c205be64d7093cd7c53b59bda6b" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/bc186024e8ee4450b4f90dbb403b656a" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fd2aadb44-7300-4a49-8254-389c830a2ef2%2FUntitled.png?width=240&amp;table=block&amp;id=bc186024-e8ee-4450-b4f9-0dbb403b656a"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fd2aadb44-7300-4a49-8254-389c830a2ef2%2FUntitled.png?width=240&amp;table=block&amp;id=bc186024-e8ee-4450-b4f9-0dbb403b656a" style="width:240px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><blockquote id="https://www.notion.so/7ec9612e772149c7941f39067dedab51" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">进程中使用的内存引用都是虚拟地址（virtual address），硬件接下来将虚拟地址加上基址寄存器中的内容，得到物理地址（physical address），再发给内存系统。</span></span><div id="https://www.notion.so/8f2ec9c0d9ad4f15a330953f13599f05" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F55616cda-9b4e-42b1-a650-5aa73821b2bc%2FUntitled.png?width=621&amp;table=block&amp;id=8f2ec9c0-d9ad-4f15-a330-953f13599f05"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F55616cda-9b4e-42b1-a650-5aa73821b2bc%2FUntitled.png?width=621&amp;table=block&amp;id=8f2ec9c0-d9ad-4f15-a330-953f13599f05" style="width:621px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></blockquote><div id="https://www.notion.so/5961463206544e74a33e1ba4b3a425bc" class="ColumnList"><div id="https://www.notion.so/22f5c0dcd0e2469f92605dc36576a915" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/2af882b849604c5988cabec7b592d147" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1a8383db-7597-4f85-816d-53456dcb0fe0%2FUntitled.png?width=677&amp;table=block&amp;id=2af882b8-4960-4c59-88ca-bec7b592d147"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1a8383db-7597-4f85-816d-53456dcb0fe0%2FUntitled.png?width=677&amp;table=block&amp;id=2af882b8-4960-4c59-88ca-bec7b592d147" style="width:677px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div><div id="https://www.notion.so/a435e808f5bc444ca36bcf5be1ce932a" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/dc53e9e5192843e08fd4f3c4d72d7150" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F59e04f59-1eec-4932-9ab4-486dcf372b3e%2FUntitled.png?width=672&amp;table=block&amp;id=dc53e9e5-1928-43e0-8fd4-f3c4d72d7150"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F59e04f59-1eec-4932-9ab4-486dcf372b3e%2FUntitled.png?width=672&amp;table=block&amp;id=dc53e9e5-1928-43e0-8fd4-f3c4d72d7150" style="width:672px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/ea71644dd25042d9bcd45d9dd2f54a6f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">重定位的进程使用了相同大小的物理内存，但由于该进程的栈区和堆区并不很大，导致这块内存区域中大量的空间被浪费。这种浪费通常称为</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorOrange">内部碎片/内零头</mark></strong></span><span class="SemanticString">（internal fragmentation）</span></span></p></div><h3 id="https://www.notion.so/86cd0e25cedc4fb8b38e855b0532ce96" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/86cd0e25cedc4fb8b38e855b0532ce96"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">分段</span></span></h3><div id="https://www.notion.so/02f7496092f64f94a67c7cf6dd564060" class="ColumnList"><div id="https://www.notion.so/66cc94d3e49244bdb54b6be78dbd3069" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 1)"><div id="https://www.notion.so/e48a37712f4c4f17a5cd860334f18ad7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">为解决内部碎片的问题，</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">分段：在MMU中引入不止一个基址和界限寄存器对，给地址空间内每个逻辑段一对，一个段只是地址空间里的一个连续定长的区域。</span></span><span class="SemanticString"> 代码段、栈、堆。不同段放在不同内存区域。</span></span></p></div><div id="https://www.notion.so/7d754c6ac5274ecfb6c5f52de87f5caf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">段错误：在支持分段的机器上发生的非法的内存访问。</span></span></p></div><div id="https://www.notion.so/7c7baa0c465844fab2920bda1af80bcc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div><div id="https://www.notion.so/097c75a985584b4d84e15412ee96a229" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 1)"><div id="https://www.notion.so/70860ae54b95487f877694a794ea96f9" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fdc318913-7215-4b06-8323-c42e8c4b3e95%2FUntitled.png?width=213&amp;table=block&amp;id=70860ae5-4b95-487f-8776-94a794ea96f9"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fdc318913-7215-4b06-8323-c42e8c4b3e95%2FUntitled.png?width=213&amp;table=block&amp;id=70860ae5-4b95-487f-8776-94a794ea96f9" style="width:213px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/c83e9c133fdd407ba4106d80ce635e43" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">如何确定段的引用：
</strong></span><span class="SemanticString">显式方式中：用虚拟地址的开头标识段，后面标识偏移量</span></span></p></div><div id="https://www.notion.so/6acbe7ed647b47b9b2baa8419a720919" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F7ece152c-b261-470e-ae36-78d691ae48aa%2FUntitled.png?width=238&amp;table=block&amp;id=6acbe7ed-647b-47b9-b2ba-a8419a720919"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F7ece152c-b261-470e-ae36-78d691ae48aa%2FUntitled.png?width=238&amp;table=block&amp;id=6acbe7ed-647b-47b9-b2ba-a8419a720919" style="width:238px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/051ed4ac9a3941979d10a2e70ae1bd10" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">隐式方式中：硬件通过地址产生的方式来确定段。例如，如果地址由程序计数器产生（即它是指令获取），那么地址在代码段。如果基于栈或基址指针，它一定在栈段。其他地址则在堆段。</span></span></p></div><div id="https://www.notion.so/a88851c50b884acab20bf469aa871065" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">由于栈是先低地址方向生长，对其的引用有所不同：</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">偏移量当成有符号数</span></span><span class="SemanticString"> 偏移量的最高位表示是否反向增长。</span></span></p></div><div id="https://www.notion.so/e83a920572a34fd882cf95b067d1f18a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">操作系统做什么：</strong></span></span></p></div><div id="https://www.notion.so/118bc2d3dec449fba0d3690ced66f319" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">💡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">操作系统在上下文切换时应该做什么？</strong></span><span class="SemanticString">
各个段寄存器中的内容必须保存和恢复。显然，每个进程都有自己独立的虚拟地址空间，操作系统必须在进程运行前，确保这些寄存器被正确地赋值。</span></span></p></div><div id="https://www.notion.so/ef794e0490b84e3297c6f710b3d1ba2e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">新问题，段模式会使得内存中出现很多未分配的小块，这些小块无法分配给新的段也影响了已有段的扩大，成为了</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorOrange"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">外部碎片/外零头</strong></mark></span><span class="SemanticString">（external fragmentation）</span></span></p></div><div id="https://www.notion.so/ff1e03013f3f4c0897dd9db7453ca655" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ppt有一些错误判断</span></span></p></div><h3 id="https://www.notion.so/44668db8b6384321847a144567e69b07" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/44668db8b6384321847a144567e69b07"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">分页</span></span></h3><div id="https://www.notion.so/b1f440ff8acc4771a53d2908391c6465" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">将一个进程的地址空间分割成</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">固定大小的单元</span></span><span class="SemanticString">（页）</span></span></p></div><div id="https://www.notion.so/9ab3fd3ff1fe470b9a06751eab330a23" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">把物理内存看成定长槽块的阵列，称为页帧 ，每个页帧包含一个虚拟内存页</span></span></p></div><div id="https://www.notion.so/5562920f5f984394999b028e1eacbcac" class="ColumnList"><div id="https://www.notion.so/0121be61615248a5b10f949e379f68b9" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/9166a6d4a9264059819811d3f3e78fb4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">非连续</span></span><span class="SemanticString">分配，</span></span></p></div><div id="https://www.notion.so/8f44a70a53c14f6db32c99466c2925a7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">内存一块可以装入程序一页</span></span></p></div><div id="https://www.notion.so/6abe943a6560494291347f15c8984d59" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">连续的多个页不一定装入连续的多个块中</span></span></p></div><div id="https://www.notion.so/5b20e18855d442fdb5670e495460c3c1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">没有外零头
仅有小于一个页面的内零头</strong></span></span></p></div><div id="https://www.notion.so/74800f74746a49968bb968eebb23d1d3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">为了</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">记录地址空间的每个虚拟页放在物理内存中的位置</span></span><span class="SemanticString">，操作系统通常为每个进程保存一个数据结构，称为</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">页表（page table）：</span></span></span></p></div><div id="https://www.notion.so/4a5466f7a99c43c49d40ed3837c1e14d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">为地址空间的每个虚拟页面保存地址转换（address translation），从而让我们知道每个页在物理内存中的位置。</span></span></p></div><div id="https://www.notion.so/9883e19ef0c5471a9f67097204315b0e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorOrange"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">每个进程都有一张自己的页表</strong></mark></span></span></p></div></div><div id="https://www.notion.so/718140858e164cba86d964ddecd913e0" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/2b385bbe7fb245a6947979a5aa1cc0a1" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F47ede853-9fab-43b7-81f5-7ebb712683a0%2FUntitled.png?width=304&amp;table=block&amp;id=2b385bbe-7fb2-45a6-9479-79a5aa1cc0a1"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F47ede853-9fab-43b7-81f5-7ebb712683a0%2FUntitled.png?width=304&amp;table=block&amp;id=2b385bbe-7fb2-45a6-9479-79a5aa1cc0a1" style="width:304px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/6059838dd4c1485b8b0dce3392a22e38" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">地址转化举例：</strong></em></span></span></p></div><div id="https://www.notion.so/dc75c619b55a42ecbf8f80efeb39e0d9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">虚拟地址的两大部分：虚拟页面号（virtual page number，VPN）和页内的偏移量（offset）</span></span></p></div><div id="https://www.notion.so/24c0bde38b4342ca8f66eb9c5079ba1e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">通过虚拟页号VPN，可以检索页表，找到虚拟页所在的物理页面。</span></span></p></div><div id="https://www.notion.so/e361aa33dc944e198cbe8b51c60f8d7d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">物理帧号（PFN）（有时也称为物理页号，physical page number 或 PPN）</span></span></p></div><div id="https://www.notion.so/6b9359fd5ac04a92aedefc6800b3db99" class="ColumnList"><div id="https://www.notion.so/46f07c2dc07d459b95521e122bb4d79b" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/318f5a67b54d429e9f21831ae83ece5e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">VPN的位数由页面总数决定（共5页就3位）</span></span></p></div><div id="https://www.notion.so/8551688e3eef440c86a4ead21397b078" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">偏移量的位数由一页的大小决定（要能表示所有的偏移量）</span></span></p></div><div id="https://www.notion.so/050cc03667e54630a1a8ca19674d50bc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">页表应该存在哪？</strong></em></span></span></p></div><blockquote id="https://www.notion.so/cd22f3f09f4d4809ab73c0988af9596c" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">由于页表如此之大，我们没有在 MMU 中利用任何特殊的片上硬件，来存储当前正在运行的进程的页表，而是</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">将每个进程的页表存储在内存中。</span></span></span><div id="https://www.notion.so/0bd089d272e441408e7b14f4912795d9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">现在让我们假设页表存在于操作系统管理的物理内存中，稍后我们会看到，很多操作系统内存本身都可以虚拟化，因此</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">页表可以存储在操作系统的虚拟内存中（甚至可以交换到磁盘上）</span></span></span></p></div></blockquote></div><div id="https://www.notion.so/4911df8ef4c944f690142d2db60b9e54" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/806b61d74c9c4b64ab448e54ccd9908f" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F43784bf9-78db-4f20-9c5f-6c3279dbb6f6%2FUntitled.png?width=277&amp;table=block&amp;id=806b61d7-4c9c-4b64-ab44-8e54ccd9908f"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F43784bf9-78db-4f20-9c5f-6c3279dbb6f6%2FUntitled.png?width=277&amp;table=block&amp;id=806b61d7-4c9c-4b64-ab44-8e54ccd9908f" style="width:277px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/e168ea4aa86746829e72c141c2db3b08" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1e686dd9-6c95-405b-8f1a-4c981dfdf538%2FUntitled.png?width=282&amp;table=block&amp;id=e168ea4a-a867-4682-9e72-c141c2db3b08"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1e686dd9-6c95-405b-8f1a-4c981dfdf538%2FUntitled.png?width=282&amp;table=block&amp;id=e168ea4a-a867-4682-9e72-c141c2db3b08" style="width:282px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/081fbfde0f144b2f9fb1ecaa6635b2d7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">页表中的页表项（page table entry)存什么？</strong></em></span></span></p></div><div id="https://www.notion.so/9b3fcddd1e4a41e7a0b2160b35e6c44e" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F586f94ca-1f97-4a50-8439-cd0af9d64fff%2FUntitled.png?width=604&amp;table=block&amp;id=9b3fcddd-1e4a-41e7-a0b2-160b35e6c44e"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F586f94ca-1f97-4a50-8439-cd0af9d64fff%2FUntitled.png?width=604&amp;table=block&amp;id=9b3fcddd-1e4a-41e7-a0b2-160b35e6c44e" style="width:604px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/575efb77ef0f4ca085928c42ab7f726b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">以线性页表为例，需要存储期望的物理帧号PFN。还有一些位：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/fb5fc7d976ff42fe9c35f409f8267457" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">有效位（valid bit）</span></span><span class="SemanticString">通常用于指示特定地址转换是否有效。
当一个程序开始运行时，它的代码和堆在其地址空间的一端，栈在另一端。所有未使用的中间空间都将被标记为无效（invalid），如果进程尝试访问这种内存，就会陷入操作系统，可能会导致该进程终止。</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">将地址空间中所有未使用的页面标记为无效</mark></span><span class="SemanticString">，我们不再需要为这些页面分配物理帧，从而节省大量内存。</span></span></li><li id="https://www.notion.so/eb9b686a3f5f41ebbe045f40956e49d4" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">保护位（protection bit）</span></span><span class="SemanticString">表明页是否可以读取、写入或执行。</span></span></li><li id="https://www.notion.so/168a95bf0f2642ba95ea85baac7c7694" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">存在位（present bit）表示该页是在物理存储器还是在磁盘上（即它已被换出，swapped out）。</span></span></li><li id="https://www.notion.so/8bc1191049544ff68b078dcc04d1ca28" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">脏位（dirty bit）也很常见，表明页面被带入内存后是否被修改过。</span></span></li><li id="https://www.notion.so/9f929f4a2e69404e8632a6c2094c85a6" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">参考位（reference bit，也被称为访问位，accessed bit）有时用于追踪页是否被访问，</span></span></li></ul><div id="https://www.notion.so/9b3b1cdc3e2c4facb5e8870a5ec8fd83" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">目前的分页模式太慢了，会导致机器变慢（有许多</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">额外的内存访问来访问页表</span></span><span class="SemanticString">）和内存浪费（</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">内存被页表塞满</span></span><span class="SemanticString">而不是有用的应用程序数据）。</span></span></p></div><h3 id="https://www.notion.so/424c97d4f4c7434ab4493fb76e1ec5a4" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/424c97d4f4c7434ab4493fb76e1ec5a4"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">分页系统： 快速地址转换TLB</span></span></h3><div id="https://www.notion.so/df96b307bbdf424aab69b6c8422ac3a2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">地址转换旁路缓冲存储器（translation-lookasidebuffer，TLB）：是频繁发生的虚拟到物理地址转换的硬件缓存（cache）。因此，更好的名称应该是地址转换缓存（address-translation cache）。</span></span></p></div><div id="https://www.notion.so/1e8cee73ac044e10ab8fa21539f9b3c2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">TLB是MMU的一部分，TLB 处理器核心附近，设计的访问速度很快。</span></span></p></div><div id="https://www.notion.so/0535f39efc8a47daaf67575e455ea1f8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">硬件缓存，无论是指令、数据还是地址转换（如 TLB），都利用了局部性（时间与空间），在小而快的芯片内存储器中保存一份内存副本。</span></span></p></div><div id="https://www.notion.so/6e27c4aeaae140dea7e2d494b200cd4e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">TLB 这样的缓存这么好，为什么不做更大的缓存，装下所有的数据？</strong></em></span></span></p></div><blockquote id="https://www.notion.so/a8ff3b2f510442e7b4b1e766e66aadbe" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">这里我们遇到了更基本的定律，就像物理定律那样。如果想要快速地缓存，它就必须小，因为光速和其他物 限制会起作用。大的缓存注定慢，因此无法实现目的。所以，我们只能用小而快的缓存。剩下的问题就是如何利用好缓存来提升性能。</span></span></blockquote><div id="https://www.notion.so/e49d7142ce7441da9cb3f50503078bc2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">如何处理TLB未命中？</strong></em></span><span class="SemanticString">
</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">硬件处理（复杂指令集计算机，CISC)</strong></span><span class="SemanticString">：</span></span></p></div><div id="https://www.notion.so/a4663c997c0e4d9091fd28b151c438d9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">硬件必须知道页表在内存中的确切位置（通过页表基址寄存器，page-table base register），以及页表的确切格式。发生未命中时，硬件会“遍历”页表，找到正确的页表项，取出想要的转换映射，用它更新 TLB，并重试该指令。</span></span></p></div><div id="https://www.notion.so/e5ad358ac9c74795977942f9d2091a2a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">软件处理（精简指令集计算机，RISC):</strong></span></span></p></div><div id="https://www.notion.so/6b172b12ca8b4c6f8093a6c44bb84c4e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">TLB 未命中时，硬件系统会抛出一个异常,暂停当前的指令流，将特权级提升至内核模式，跳转至陷阱处理程序（trap handler），这个陷阱处理程序是操作系统的一段代码，用于处理 TLB 未命中。</span></span></p></div><div id="https://www.notion.so/d273d5350d154314990a059118bd25c6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这段代码在运行时，会查找页表中的转换映射，然后用特别的“特权”指令更新 TLB，并从陷阱返回。此时，硬件会重试该指令（导致 TLB 命中）。</span></span></p></div><div id="https://www.notion.so/4014d71dd73a454d86d44b48790a5bd4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">TLB 的内容：</strong></em></span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">VPN ｜ PFN ｜ 其他位</em></span></span></span></p></div><div id="https://www.notion.so/daa14d71094d45bb9f10ece5848524dc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">TLB </strong></span><span class="SemanticString">的有效位!=页表的有效位 →一个页表项（PTE）被标记为无效，就意味着该页并没有被进程申请使用，正常运行的程序不应该访问该地址；</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">TLB 的有效位，只是指出 TLB 项是不是有效的地址映射。</span></span></span></p></div><div id="https://www.notion.so/6dff4a598ac745ffaa7a26a777c169d1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">地址空间标识符（Address Space Identifier，ASID）：可以把ASID 看作是进程标识符（Process Identifier，PID），但通常比 PID 位数少（PID 一般 32 位，ASID 一般是 8 位）。</span></span></p></div><div id="https://www.notion.so/2d39168496ad4530911c3627beb9b06f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">全局位G,一致性位C,脏位D,有效位V</span></span></p></div><div id="https://www.notion.so/e83c90f28103499281b4cac1259f55f2" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F4bd3d436-42b4-42fe-ae76-4472118e01a3%2FUntitled.png?width=503&amp;table=block&amp;id=e83c90f2-8103-4992-81b4-cac1259f55f2"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F4bd3d436-42b4-42fe-ae76-4472118e01a3%2FUntitled.png?width=503&amp;table=block&amp;id=e83c90f2-8103-4992-81b4-cac1259f55f2" style="width:503px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/8ae2951f0a75484fad3d40cea4b5058c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">只有19位VPN? →事实上，用户地址只占地址空间的一半（剩下的留给内核）</span></span></p></div><div id="https://www.notion.so/d52240fae57c43b7971fb17f84b661e1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">TLB满了需要替换时：采用最少使用替换（least-recently-used，LRU）或随机替换</span></span></p></div><h3 id="https://www.notion.so/452d9fdc4e634a56843ac330ce26fe7c" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/452d9fdc4e634a56843ac330ce26fe7c"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">更小的页表</span></span></h3><div id="https://www.notion.so/c37399e3bc624739acc3cc39f16c3e36" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">方案一：使用更大的页 →大内存页会导致每页内的浪费，内部碎片</span></span></p></div><div id="https://www.notion.so/205c32a588de47bfa2b30faefe2e58d8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">方案二：分页与分段混用</strong></em></span></span></p></div><div id="https://www.notion.so/924fbc2fc035487399c11340a54ebe5c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">为每个逻辑分段提供一个页表（段内页表）。</span></span></p></div><div id="https://www.notion.so/e0d924db231b4c19b6f1a245a1bbb90c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">基址寄存器保存该段的页表的物理地址，界限寄存器用于指示页表的结尾（即它有多少有效页）。</span></span></p></div><div id="https://www.notion.so/32356543f28347ff9c76b004bf937234" class="ColumnList"><div id="https://www.notion.so/e89d1fde1e25426397c8d38fd12aec04" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.4375)"><div id="https://www.notion.so/2142f3ce4f454bba9ff55ee933c9b8e6" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fd721ebe0-481d-4e52-be92-9f3df95298a6%2FUntitled.png?width=600&amp;table=block&amp;id=2142f3ce-4f45-4bba-9ff5-5ee933c9b8e6"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fd721ebe0-481d-4e52-be92-9f3df95298a6%2FUntitled.png?width=600&amp;table=block&amp;id=2142f3ce-4f45-4bba-9ff5-5ee933c9b8e6" style="width:600px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div><div id="https://www.notion.so/74eaf4e2de2f4434a6bf6d7bde8f2c41" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5625)"><div id="https://www.notion.so/022b1e3879f146b79238fc7140e4f072" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3a94a434-95db-43a1-aafe-5df89971b51b%2FUntitled.png?width=666&amp;table=block&amp;id=022b1e38-79f1-46b7-9238-fc7140e4f072"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3a94a434-95db-43a1-aafe-5df89971b51b%2FUntitled.png?width=666&amp;table=block&amp;id=022b1e38-79f1-46b7-9238-fc7140e4f072" style="width:666px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/09d57f3d3a9b46e3aa45d32af28c4d91" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">→它仍然要求使用分段(它假定地址空间有一定的使用模式),如果有一个大而稀疏的堆，仍然可能导致大量的页表浪费；</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">外部碎片再次出现</mark></span></span></p></div><div id="https://www.notion.so/9d235ce952204adb97d0c79efee6b827" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgYellow"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">方案三：多级页表 时空的折中</strong></em></mark></span></span></p></div><div id="https://www.notion.so/38d107b90e28498ca54bc0bd7cdc216c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">留出页目录，页目录中有多个页目录项（Page Directory Entries，PDE）组成。PDE（至少）拥有有效位（valid bit）和页帧号（page frame number，PFN），类似于页表项PTE。</span></span></p></div><div id="https://www.notion.so/2967cfa11c6c477ba21207f4e5f2b664" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">PDE的有效位如果为1，则意味着该项指向的页表（通过 PFN）中至少有一页是有效的，即在该 PDE 所指向的页中，至少一个 PTE，其有效位被设置为 1。（</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">如果整页的页表项（PTE）无效，就完全不分配该页的页表</span></span><span class="SemanticString">）
如果 PDE 项无效（即等于零），则 PDE的其余部分没有定义</span></span></p></div><div id="https://www.notion.so/6e8ce79f48554ef1a5d5f72f4a779e46" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F53bf9031-657a-4d60-b322-506e9b5f27f1%2FUntitled.png?width=803&amp;table=block&amp;id=6e8ce79f-4855-4ef1-a5d5-f72f4a779e46"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F53bf9031-657a-4d60-b322-506e9b5f27f1%2FUntitled.png?width=803&amp;table=block&amp;id=6e8ce79f-4855-4ef1-a5d5-f72f4a779e46" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/7a1bcdf911ef4d2dbc82abf6e1ea9ce6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">页目录应该占一个页的大小（</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">页表的每个部分都可以整齐地放入一页中</span></span><span class="SemanticString">），指向的低级页表也是；</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorOrange">页目录大小（log2（占用的VPN中的位数））=页的大小/PDE的大小</mark></span><span class="SemanticString"> </span></span></p></div><div id="https://www.notion.so/7b8d1e2ddc474342b3e29dbd3549fd95" class="ColumnList"><div id="https://www.notion.so/dd5a72ae260d4919b9e17eb5e11f571e" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/5b74a23632da45928c1df93fa9e6b2a4" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F33139b7a-a4d5-4c60-87eb-5546ed1dea55%2FUntitled.png?width=793&amp;table=block&amp;id=5b74a236-32da-4592-8c1d-f93fa9e6b2a4"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F33139b7a-a4d5-4c60-87eb-5546ed1dea55%2FUntitled.png?width=793&amp;table=block&amp;id=5b74a236-32da-4592-8c1d-f93fa9e6b2a4" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/4232bfa8a0754245a6a444a0b2793eb5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">将线性页表变成了类似树的东西。非常有效</span></span></p></div></div><div id="https://www.notion.so/fc4e2f8ae08e41d1931672abdf6aebaf" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/f33d0dc945b04faa888fea191b27053f" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F52792cfe-490d-46fc-a47c-bf4ab2c747a1%2FUntitled.png?width=810&amp;table=block&amp;id=f33d0dc9-45b0-4faa-888f-ea191b27053f"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F52792cfe-490d-46fc-a47c-bf4ab2c747a1%2FUntitled.png?width=810&amp;table=block&amp;id=f33d0dc9-45b0-4faa-888f-ea191b27053f" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/a69e37c3c63f42d7a6f2ac887987ad15" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">→多级页表是有成本的。在 TLB 未命中时，需要从内存加载多次，才能从页表中获取正确的地址转换信息；另一个明显的缺点是复杂性。</span></span></p></div><div id="https://www.notion.so/4f8af06d7305488cadaeef027f66d52b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">方案四：反向页表 极端的空间节省</strong></em></span></span></p></div><div id="https://www.notion.so/e3adbed97d6c4de1936c3cd8e1e16177" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">只保留一个页表，每一项代表一个物理页</span></span></p></div><div id="https://www.notion.so/e76d7ba563c94397ba71d8361872fbf2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">页表项内容为：PID+页号</span></span><span class="SemanticString">（哪个进程在使用该页与哪个虚拟页映射到此页）</span></span></p></div><div id="https://www.notion.so/1d994dc8932a4041a6cd4824e8f7782b" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fe23c89e1-b0af-436f-85b8-619f80dec245%2FUntitled.png?width=600&amp;table=block&amp;id=1d994dc8-932a-4041-a6cd-4824e8f7782b"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fe23c89e1-b0af-436f-85b8-619f80dec245%2FUntitled.png?width=600&amp;table=block&amp;id=1d994dc8-932a-4041-a6cd-4824e8f7782b" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/87e2a8c71b1143b490a510221e2ab23b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">方案五：将页表交换到磁盘</strong></em></span></span></p></div><h3 id="https://www.notion.so/9126fd84214f47cfa4600cc91c637e40" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/9126fd84214f47cfa4600cc91c637e40"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">超越物理内存</span></span></h3><div id="https://www.notion.so/739fbb7f375d4b428af2b157bf2b0c5b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我们需要支持更大的地址空间 → 硬盘</span></span></p></div><div id="https://www.notion.so/89705edc9c8b4e0a9b4764c1b21acc2b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在硬盘上开辟一部分空间（交换空间）用于物理页的移入与移出</span></span></p></div><div id="https://www.notion.so/107108b1ad414495a473aca75f74c713" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">虚拟存储器：</strong></span><span class="SemanticString">虚拟存储指仅把作业的一部分装入内存便可运行的存储管理系统，通过作业各部分的动态调入和置换，用户所感觉的存储空间比实际空间大，称之为虚空间。</span></span></p></div><div id="https://www.notion.so/644cba25a99243eaaae3121ebcddc5ff" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">页表PTE的</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">存在位</strong></span><span class="SemanticString">用来指示该页</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">是否在物理内存</strong></span><span class="SemanticString">中</span></span></p></div><div id="https://www.notion.so/c94a85ede0684c079d7590264e8ec519" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">页错误：访问不在物理内存中的页</strong></em></span></span></p></div><div id="https://www.notion.so/c8276675f13a49e8ab3d272019b55bea" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">页错误发生后，操作系统接过控制权，操作系统通过PTE得到硬盘地址，将页读取到内存中
PTE的PFN位用来存储硬盘地址（当该页不在物理内存而是在磁盘中时）</span></span></p></div><blockquote id="https://www.notion.so/0287ecdc3a03493c8b5d84dcf1b23d43" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">为什么硬件不能处理页错误？
页错误导致的硬盘操作很慢，相较于硬盘操作，操作系统的指令带来的额外开销小，硬件不能了解（或很难）交换空间的具体细节，总结：性能与简单性的原因</span></span></blockquote><div id="https://www.notion.so/e03b5b7580c94492badd8ec5f39b7746" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">到目前，TLB未命中的情况如下：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/cc481bc9b94743cca339948152a2aba3" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">该页存在（present）且有效（valid）：以简单地从 PTE 中获取 PFN，然后重试指令（这次 TLB 会命中）</span></span></li><li id="https://www.notion.so/e3924dbef67542d391f99ef395484b90" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">该页不存在（present）且有效（valid）：页错误处理，从交换空间获取页</span></span></li><li id="https://www.notion.so/aba40aae5f224761b8590a07d3727643" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">无效页：非法访问，进程可能会被kill</span></span></li></ol><div id="https://www.notion.so/ba6e3d663774424abb90dcf2cc3d1560" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">什么时候发生交换？</strong></em></span></span></p></div><div id="https://www.notion.so/302a4c2aad0b428bb5df7deb8ca70e24" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">操作系统倾向主动留一小部分空闲空间，高水位线（HW）与低水位线（LW），当少于LW个页可用时，后台专门的程序（交换守护进程）开始释放内存，直到有HW个可用物理页</span></span></p></div><h3 id="https://www.notion.so/71d8656ff5ea40019301ca79e0888f2e" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/71d8656ff5ea40019301ca79e0888f2e"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">页交换策略</span></span></h3><div id="https://www.notion.so/7c3db24a748647869be4c77aaf742f06" class="ColumnList"><div id="https://www.notion.so/45e21ea3081b4667aad93a0a5d1f5671" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/82729bc7a744423fb1d07260cdea9ec2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当内存要满了，需要决定将哪些页交换出去，衡量指标如下：</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">average memory access time (AMAT，</strong></span><span class="SemanticString">平均内存访问时间</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">)：</strong></span></span></p></div><div id="https://www.notion.so/5e08e76b9cf544e4baf5e2c80f79f0a4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">会有三种缓存未命中的情况：1.强制性的，发生在</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">第一次载入时</strong></span><span class="SemanticString">，2.缓存过但被踢出缓存了，</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">容量未命中</strong></span><span class="SemanticString">，3.</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">冲突未命中</strong></span><span class="SemanticString">，硬件对缓存中的项的存放有位置限制</span></span></p></div></div><div id="https://www.notion.so/0fe06ce771a949baa21e7d2c1a2d9c7e" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/31cf99065a9a4e83ad831295581e8093" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F5e6db969-9786-483f-ac42-a3e6ae565588%2FUntitled.png?width=439&amp;table=block&amp;id=31cf9906-5a9a-4e83-ad83-1295581e8093"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F5e6db969-9786-483f-ac42-a3e6ae565588%2FUntitled.png?width=439&amp;table=block&amp;id=31cf9906-5a9a-4e83-ad83-1295581e8093" style="width:439px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/caeac8ff907b49129931df90ecb21acc" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3c55d195-a03a-4c04-a2d4-903cfb1beb8a%2FUntitled.png?width=213.99620056152344&amp;table=block&amp;id=caeac8ff-907b-4912-9931-df90ecb21acc"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3c55d195-a03a-4c04-a2d4-903cfb1beb8a%2FUntitled.png?width=213.99620056152344&amp;table=block&amp;id=caeac8ff-907b-4912-9931-df90ecb21acc" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/e2ee9a2f17564fd39fc41e9bb9a3d2ef" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">方案一：最优替换策略</strong></em></span></span></p></div><div id="https://www.notion.so/5dcd8d08cfc04a78b61ad033b9833168" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">剔除在未来最远才将访问的页，这是面向未来的算法，无法实现，可作为对照</span></span></p></div><div id="https://www.notion.so/ba16d6e4a7034ab6becca0327a156267" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">方案二：FIFO</strong></em></span></span></p></div><div id="https://www.notion.so/5fcbfc843220447f9bb5dcf51840c275" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">先入先出，简单，但无法确定页的重要性</span></span></p></div><div id="https://www.notion.so/6f4c6f9044e2480e9f50cdf609e77507" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">方案三：随机</strong></em></span></span></p></div><div id="https://www.notion.so/2a8a26c3c73a439d890bde1add64d5b0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">基本同方案二，命中率看运气</span></span></p></div><div id="https://www.notion.so/b1c83552fd20413e900ffebccfde3d2a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">方案四：利用历史数据 “最不经常使用”（Least-Frequently-Used，LFU）—&gt;从频率上，替换使用次数最少的
“最少最近使用”（Least-Recently-Used，LRU）—&gt;从时间上，替换最久未被访问的</strong></em></span></span></p></div><div id="https://www.notion.so/3a58c54ee27d425db238443820a8c1f2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">优先保留最近加入的和最近使用的，利用局部性原理（频率（frequency）：如果一个页被访问了很多次，也许它不应该被替换，因为它显然更有价值；页更常用的属性是访问的近期性（recency），越近被访问过的页，也许再次访问的可能性也就越大。）</span></span></p></div><div id="https://www.notion.so/be0ebba20b474b1a8694ce0acfabd026" class="ColumnList"><div id="https://www.notion.so/21d98d62cd0044868ffaae5e02458e47" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/c45859df65c640deb7f735618fb5d60f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">近似实现LRU（时钟算法）</strong></span></span></p></div><div id="https://www.notion.so/2b3558479b214d02a9b436c764d32576" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在硬件中引入使用位（use bit/reference bit） 当页被引用时设置为1，将页放在循环列表中。
页交换时，时钟指针顺序检查页，若当前页使用位为1则清零找下一个，直到找到使用位为0的页（在最 坏的情况下，所有的页都已经被使用了，那么就将所有页的使用位都设置为 0）</span></span></p></div><div id="https://www.notion.so/b4db914e1c284952bc222005a31080ac" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">进一步的</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">考虑脏页（是否被修改过）</strong></span></span></p></div></div><div id="https://www.notion.so/4d55aa504e82441e9857c1372b33288a" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/5dea62fb735346a2ad8c99a9174b0d72" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fb8e80aa5-957a-4c71-8257-b09c75fb34ec%2FUntitled.png?width=585&amp;table=block&amp;id=5dea62fb-7353-46a2-ad8c-99a9174b0d72"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fb8e80aa5-957a-4c71-8257-b09c75fb34ec%2FUntitled.png?width=585&amp;table=block&amp;id=5dea62fb-7353-46a2-ad8c-99a9174b0d72" style="width:585px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/b079451d218341298cd890523a136e6f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">抖动（Thrashing）</strong></span><span class="SemanticString">是操作系统中的一种现象，发生在计算机的物理内存（RAM）被过度使用时，导致系统花费大部分时间在交换页面（从内存到硬盘和从硬盘到内存的过程）上，而非执行实际的应用程序或进程。</span></span></p></div><div id="https://www.notion.so/a66c22619fde4c919e76e80a2183192e" class="Divider"></div><div id="https://www.notion.so/7b301a9612914923ad8bde2b07f21b9d" class="Divider"></div><h1 id="https://www.notion.so/f008e73a3e3a4fbfa411193f14e4a2f2" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/f008e73a3e3a4fbfa411193f14e4a2f2"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">并发</span></span></h1><h2 id="https://www.notion.so/8519c55c2d9d45edb6d44e2196311a7d" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/8519c55c2d9d45edb6d44e2196311a7d"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">基本概念</span></span></h2><div id="https://www.notion.so/c4a9baf11a5446e8bdf96ef5f6245b5e" class="ColumnList"><div id="https://www.notion.so/0c2b9c8aac904e8f9c1e72d5b93b6b55" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/f75fa355a28d45ac8c3cab35fa9a0644" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">一个多线程程序有多个执行点(多pc，每pc都被获取和执行)</span></span></p></div><div id="https://www.notion.so/d26aa73004d445168b74e9819ed67c7d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">每个线程非常像一个单独的进程，除了一个区别:它们</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">共享相同的地址空间，因此可以访问相同的数据。</strong></span></span></p></div><div id="https://www.notion.so/1137b4bdff6049ae826fae6e4f873821" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在上下文中</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">切换线程与进程:地址空间保持不变</strong></span><span class="SemanticString">(即，不需要切换我们正在使用的页表)。</span></span></p></div><div id="https://www.notion.so/bb72154719384ce585305a722bb440c2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">属于同一个进程的线程共享代码段、数据段和其他操作系统资源，但它</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">有自己的线程ID、程序计数器、寄存器和栈。</strong></span></span></p></div><div id="https://www.notion.so/1ce0c34bd2834f4ebb491609e3af7e3b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div><div id="https://www.notion.so/68936c6ccd804a1181238ccf49361e05" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/55e05b904b964c0fb45e24635ae33a2e" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fd5f49b36-8e1c-49fe-9d86-0b37ab126fa6%2FUntitled.png?width=652&amp;table=block&amp;id=55e05b90-4b96-4c0f-b45e-24635ae33a2e"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fd5f49b36-8e1c-49fe-9d86-0b37ab126fa6%2FUntitled.png?width=652&amp;table=block&amp;id=55e05b90-4b96-4c0f-b45e-24635ae33a2e" style="width:652px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><h2 id="https://www.notion.so/40a5c35164d54f59b4d23bbf8fdae3ee" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/40a5c35164d54f59b4d23bbf8fdae3ee"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">相关API</span></span></h2><div id="https://www.notion.so/5476ed3f119241258b5da396f036aa20" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff6e96fd4-5c7b-4a94-9ce7-cd27f9ecf7a0%2FUntitled.png?width=1024&amp;table=block&amp;id=5476ed3f-1192-4125-8b5d-a396f036aa20"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff6e96fd4-5c7b-4a94-9ce7-cd27f9ecf7a0%2FUntitled.png?width=1024&amp;table=block&amp;id=5476ed3f-1192-4125-8b5d-a396f036aa20" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/eba80a6bb1b1458e84f29a95537be753" class="ColumnList"><div id="https://www.notion.so/93e1ec2705ba4271b882fbe350db5fbd" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/4b56930a44ea4cb1ace9f4f1aee00582" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F7100993c-608f-4019-b135-95afee4b75cc%2FUntitled.png?width=556&amp;table=block&amp;id=4b56930a-44ea-4cb1-ace9-f4f1aee00582"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F7100993c-608f-4019-b135-95afee4b75cc%2FUntitled.png?width=556&amp;table=block&amp;id=4b56930a-44ea-4cb1-ace9-f4f1aee00582" style="width:556px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div><div id="https://www.notion.so/8146c23afef4421aabc98ea7a8cd1109" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/e36cb6c7f1694497bf5a82fc93fb28ac" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F4344861a-08e2-4df6-856c-5a6393ba28db%2FUntitled.png?width=561&amp;table=block&amp;id=e36cb6c7-f169-4497-bf5a-82fc93fb28ac"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F4344861a-08e2-4df6-856c-5a6393ba28db%2FUntitled.png?width=561&amp;table=block&amp;id=e36cb6c7-f169-4497-bf5a-82fc93fb28ac" style="width:561px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/c00569d6ab364a0ea097e1175acebd9c" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F24be0660-3f04-4bed-9f9a-7a712c66b116%2FUntitled.png?width=726.3541259765625&amp;table=block&amp;id=c00569d6-ab36-4a0e-a097-e1175acebd9c"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F24be0660-3f04-4bed-9f9a-7a712c66b116%2FUntitled.png?width=726.3541259765625&amp;table=block&amp;id=c00569d6-ab36-4a0e-a097-e1175acebd9c" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/c0298243c05d41558ddbda9dbee92728" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff26bc470-fa2d-4993-973b-65e310b69981%2FUntitled.png?width=726.3541259765625&amp;table=block&amp;id=c0298243-c05d-4155-8ddb-da9dbee92728"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff26bc470-fa2d-4993-973b-65e310b69981%2FUntitled.png?width=726.3541259765625&amp;table=block&amp;id=c0298243-c05d-4155-8ddb-da9dbee92728" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/731a69024f22457fa1e3972cce03ed7f" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8e379991-5305-4acd-9420-c8f647329fa5%2FUntitled.png?width=726.3541259765625&amp;table=block&amp;id=731a6902-4f22-457f-a1e3-972cce03ed7f"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8e379991-5305-4acd-9420-c8f647329fa5%2FUntitled.png?width=726.3541259765625&amp;table=block&amp;id=731a6902-4f22-457f-a1e3-972cce03ed7f" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/b8abe8185ea54b5c8d50cb80b54c2e9c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">引入线程后存在线程间的竞争  —&gt;  原子操作（多个操作要么都执行或都不执行） 
要求硬件提供指令→ </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">synchronization primitives（同步原语）</strong></span></span></p></div><div id="https://www.notion.so/01f120f48d6f45b4a7b18e527ce23665" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Faa7b5826-affd-4472-88f1-b8fa1033d55e%2FUntitled.png?width=635.9943237304688&amp;table=block&amp;id=01f120f4-8d6f-45b4-a7b1-8e527ce23665"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Faa7b5826-affd-4472-88f1-b8fa1033d55e%2FUntitled.png?width=635.9943237304688&amp;table=block&amp;id=01f120f4-8d6f-45b4-a7b1-8e527ce23665" style="width:635.9943237304688px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/320752f4f85b41b88b334b705a6757c9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">进程同步指两个以上进程基于某个条件来协调它们的活动</span></span></p></div><h2 id="https://www.notion.so/b2bd23fee9b74397a007426291e66a3a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/b2bd23fee9b74397a007426291e66a3a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">锁</span></span></h2><div id="https://www.notion.so/06b0b1ef2d2648f595e3e5f78271a482" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">锁变量（简称锁）保存了锁在某一时刻的状态。它要么是可用的 （available， unlocked， free），表示没有线程持有锁，要么是被占用的（acquired， locked，  held），表示有一个线程持有锁，正处于临界区。</span></span></p></div><h3 id="https://www.notion.so/f7197b2cb4fa46c5b4b85dbb65a2ed83" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/f7197b2cb4fa46c5b4b85dbb65a2ed83"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">POSIX库</span></span></h3><div id="https://www.notion.so/a1eff4e4c85945d985f0d4422e55f39c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">POSIX 库将锁称为互斥量（mutex），因为它被用来提供线程之间的互斥。即当一个线程在临界区，它能够阻止其他线程进入直到本线程离开临界区。
使用时需要</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">初始化</strong></span><span class="SemanticString">；</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">获取与释放时检查错误代码</strong></span></span></p></div><pre id="https://www.notion.so/7b953f5a19224fb28c73c90165c7001d" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">//获取锁</span>
<span class="token keyword">int</span> <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token class-name">pthread_mutex_t</span> <span class="token operator">*</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//释放锁</span>
<span class="token keyword">int</span> <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token class-name">pthread_mutex_t</span> <span class="token operator">*</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><span><span class="token comment">//静态初始化</span>
<span class="token class-name">pthread_mutex_t</span> lock <span class="token operator">=</span> PTHREAD_MUTEX_INITIALIZER<span class="token punctuation">;</span>
<span class="token comment">//动态初始化</span>
<span class="token keyword">int</span> rc <span class="token operator">=</span> <span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lock<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assert</span><span class="token punctuation">(</span>rc <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// always check success!</span></span></strong></span><span class="SemanticString"><span>

<span class="token function">pthread_mutex_trylock</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> 在锁被占用时失败，是 <span class="token function">pthread_mutex_lock</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> 的非阻塞版本
<span class="token function">pthread_mutex_timelock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 会在超时或获取锁后返回，以先发生者为准</span></span></span></code></pre><h3 id="https://www.notion.so/3d4b6dcb6bc44e468b65d251945b2c6e" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/3d4b6dcb6bc44e468b65d251945b2c6e"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">基本概念</span></span></h3><div id="https://www.notion.so/c1e8de137a5942a9adc180bc5f46de81" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">通常大家会用不同的锁保护不同的数据和结构，从而允许更多的线程进入临界区（细粒度的方案）</span></span></p></div><div id="https://www.notion.so/69d6ff13a2884fe8ac56e9018ee0ce03" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">评价锁：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/d766e22c54d5427e930ba08494ed9bc3" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">提供互斥（mutual exclusion），最基本的，锁是否有效，能够阻止多个线程进入临界区？</span></span></li><li id="https://www.notion.so/5b06000b4c564d8e8108f073534ddcc6" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">公平性（fairness），当锁可用时，是否每一个竞争线程有公平的机会抢到锁？是否有竞争锁的线程会饿死（starve），一直无法获得锁？</span></span></li><li id="https://www.notion.so/9c12c86ce11a4617b8a1076df4986a03" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">性能（performance），使用锁之后增加的时间开销。</span></span></li></ol><h3 id="https://www.notion.so/5815e4a19d964d8f90ae6c97bc95b5b5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/5815e4a19d964d8f90ae6c97bc95b5b5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">软件锁</span></span></h3><div id="https://www.notion.so/b8a6689bd9cc4645977b3e0e972bad5b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">单标志算法</strong></span></span></p></div><div id="https://www.notion.so/5a70578b56cc4a2d916c3066bea40db1" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff47e2ad9-a3e8-4fcd-ae94-931a33c51e40%2FUntitled.png?width=649&amp;table=block&amp;id=5a70578b-56cc-4a2d-916c-3066bea40db1"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff47e2ad9-a3e8-4fcd-ae94-931a33c51e40%2FUntitled.png?width=649&amp;table=block&amp;id=5a70578b-56cc-4a2d-916c-3066bea40db1" style="width:649px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/8e5e4e347c234852ad56a62dc46b8a8c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">双标志、先检查算法</strong></span></span></p></div><div id="https://www.notion.so/603251f5dba04b508fead2e909b1b897" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fe2303bab-147f-4c62-9965-2261910609bf%2FUntitled.png?width=669&amp;table=block&amp;id=603251f5-dba0-4b50-8fea-d2e909b1b897"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fe2303bab-147f-4c62-9965-2261910609bf%2FUntitled.png?width=669&amp;table=block&amp;id=603251f5-dba0-4b50-8fea-d2e909b1b897" style="width:669px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/b7a566ffc0d9403da91c13d75ec80c19" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">双标志、后检查算法</strong></span></span></p></div><div id="https://www.notion.so/08ca83996db041119fc31c21f32f7ec5" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F293de8dd-0bcc-481f-9254-72395b99aed0%2FUntitled.png?width=674&amp;table=block&amp;id=08ca8399-6db0-4111-9fc3-1c21f32f7ec5"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F293de8dd-0bcc-481f-9254-72395b99aed0%2FUntitled.png?width=674&amp;table=block&amp;id=08ca8399-6db0-4111-9fc3-1c21f32f7ec5" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/7c8a18f7ec684f1b8b54f33282bf5844" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Peterson算法</strong></span></span></p></div><div id="https://www.notion.so/27ae7d2cddca49beb1dcca4da2289255" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">让turn表示谁应该等着，turn不可能同时为1，解决了相互谦让的饥饿</span></span></p></div><div id="https://www.notion.so/8e94c1751530402a9333c309dae3026f" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8a4eb481-a8da-4061-90bb-11aa9d80b42d%2FUntitled.png?width=684&amp;table=block&amp;id=8e94c175-1530-402a-9333-c309dae3026f"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8a4eb481-a8da-4061-90bb-11aa9d80b42d%2FUntitled.png?width=684&amp;table=block&amp;id=8e94c175-1530-402a-9333-c309dae3026f" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/c75eb1daa158420682fa77d294d771e3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">面包店算法（Bakery Algorithm）  （n个进程）</strong></span></span></p></div><div id="https://www.notion.so/1c07097dfcc045bbb14f0d3dfc0c1314" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F317dfc3c-eead-4ae2-8dba-927aef9ab4c9%2FUntitled.png?width=669.0056762695312&amp;table=block&amp;id=1c07097d-fcc0-45bb-b14f-0d3dfc0c1314"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F317dfc3c-eead-4ae2-8dba-927aef9ab4c9%2FUntitled.png?width=669.0056762695312&amp;table=block&amp;id=1c07097d-fcc0-45bb-b14f-0d3dfc0c1314" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/5662a72e599a4a08a30a75e29a562707" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">为什么两个不同的进程可能会取得相同的ticket?是否可以去掉choosing数组？</span></span></p></div><blockquote id="https://www.notion.so/e224286b20304cc788b828c0f5b51896" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">可以想像这样一个例子: 现在排号已经排到了n，这个时候来了</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">两个人i和j (i &lt; j)</span></span><span class="SemanticString">，他们都想领取n+1这个编号。
如果去掉choosing，可能出现这样一种情况：虽然这两个人同时看到了现在的最大编号为n，也</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">都想把自己的编号设置为n+1</span></span><span class="SemanticString">，</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">j在i把自己的编号写成n+1之前检查自己能否进入</span></span><span class="SemanticString">面包店。i反应太迟钝了，以至于</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">j检查到他的时候，i的编号纸还是空白</span></span><span class="SemanticString">的（number[i]=0)，于是j顺理成章进店买面包了。这个时候慢吞吞的</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">i终于在编号纸上写上了n+1，也开始检查</span></span><span class="SemanticString">别人。当它检查到j的时候，发现他们两个的编号一样(number[i]=number[j]=n+1)，而且</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">自己的优先级还比j高(i&lt;j)</span></span><span class="SemanticString">，于是</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">他也理直气壮地进店</span></span><span class="SemanticString">买面包了。</span></span></blockquote><div id="https://www.notion.so/7417a89e529048259481065f93b72add" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">中断问题</strong></span></span></p></div><div id="https://www.notion.so/ed5dceb76a524552915ffaa731d7f391" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">不</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">合时宜的中断</strong></span><span class="SemanticString">容易构造出两个线程都将标志设置为 1，都能进入临界区的场景。</span></span></p></div><div id="https://www.notion.so/73478a2fb80d4bc6b44c212b39cceeea" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">最早提供的互斥解决方案之一，就是在临界区关闭中断。这个解决方案是为单处理器系统开发的。没有中断，线程可以确信它的代码会继续执行下去，不会被其他线程干扰。（但是带来了恶意程序 不支持多处理器 中断丢失等问题）
某些情况下操作系统本身会采用屏蔽中断的方式，保证访问自己数据结构的原子性，或至少避免某 些复杂的中断处理情况。因为在操作系统内部不存在信任问题，它总是信任自己可以执行特权操作</span></span></p></div><h3 id="https://www.notion.so/4c5a9343f2924c70af17ffa1696f1030" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/4c5a9343f2924c70af17ffa1696f1030"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">硬件锁 </span></span></h3><div id="https://www.notion.so/7f554a3d8a064441810bddaf40d82852" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">以下四个都是</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">指令</mark></span></span></p></div><div id="https://www.notion.so/fe9295dc9e48431db447a9d4855dc439" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Test-And-Set（测试并设置，原子交换）</strong></span></span></p></div><div id="https://www.notion.so/09866f52fe204adfb745e2dd41c52bf3" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fb41e674b-a0b2-411e-8d2e-e5798bf130ba%2FUntitled.png?width=614&amp;table=block&amp;id=09866f52-fe20-4adf-b745-e2dd41c52bf3"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fb41e674b-a0b2-411e-8d2e-e5798bf130ba%2FUntitled.png?width=614&amp;table=block&amp;id=09866f52-fe20-4adf-b745-e2dd41c52bf3" style="width:614px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/f3568faf9dd340a689b467b2f637ac16" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fadb63d3e-a4d0-4161-935e-8525bc34571e%2FUntitled.png?width=487.99713134765625&amp;table=block&amp;id=f3568faf-9dd3-40a6-89b4-67b2f637ac16"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fadb63d3e-a4d0-4161-935e-8525bc34571e%2FUntitled.png?width=487.99713134765625&amp;table=block&amp;id=f3568faf-9dd3-40a6-89b4-67b2f637ac16" style="width:487.99713134765625px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/5e975aeda0414dc1af2fe3b7e3ae48b1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">自旋锁（spin lock）：这是最简单的一种锁，一直自旋，利用 CPU 周期，直到锁可用。</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">在单处理器上，需要抢占式的调度器</span></span><span class="SemanticString">（preemptivescheduler，即不断通过时钟中断一个线程，运行其他线程）。否则，自旋锁在单 CPU 上无法使用，因为</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">一个自旋的线程永远不会放弃 CPU</span></span><span class="SemanticString">。</span></span></p></div><div id="https://www.notion.so/2c891cad1871468a8426e3f7554ef9d9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">自旋锁一次只允许一个线程进入临界区。因此，这是正确的锁。
</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">自旋锁没有公平性，可能会导致饿死。
</mark></span><span class="SemanticString">在</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">单 CPU</mark></span><span class="SemanticString"> 的情况下，</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">性能开销相当大</mark></span><span class="SemanticString">；</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow"> 多CPU </mark></span><span class="SemanticString">上，</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">自旋锁性能不错（如果线程数大致等于 CPU 数）</mark></span></span></p></div><div id="https://www.notion.so/dae2783150b948fdb757ba210f5d68aa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Compare-And-Swap</strong></span></span></p></div><div id="https://www.notion.so/835eef6eca304184ab84aa0977cd784c" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F989d0612-fdf2-4018-8957-14d777a6cf02%2FUntitled.png?width=569&amp;table=block&amp;id=835eef6e-ca30-4184-ab84-aa0977cd784c"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F989d0612-fdf2-4018-8957-14d777a6cf02%2FUntitled.png?width=569&amp;table=block&amp;id=835eef6e-ca30-4184-ab84-aa0977cd784c" style="width:569px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/da1d1aec72b1490fb89ebae3c8b8818d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">是检测 ptr 指向的值是否和 expected 相等；如果是，更新 ptr 所指的值为新值。否则，什么也不做。不论哪种情况，都返回该内存地址的实际值</span></span></p></div><div id="https://www.notion.so/2904990dc21b42c0bdf30155b15b6390" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8c939d18-208e-4e0b-8d39-786b52697382%2FUntitled.png?width=608.991455078125&amp;table=block&amp;id=2904990d-c21b-42c0-bdf3-0155b15b6390"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8c939d18-208e-4e0b-8d39-786b52697382%2FUntitled.png?width=608.991455078125&amp;table=block&amp;id=2904990d-c21b-42c0-bdf3-0155b15b6390" style="width:608.991455078125px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/fe94ca0cad2045fcb897614f69c1cd36" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Load-Linked and Store-Conditional（LL/SC) 链接的加载和条件式存储指令</strong></span></span></p></div><div id="https://www.notion.so/9d93a876ccd74a04bd39193a6f3ad75a" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F452f015b-baa4-48a3-bdc3-694a7fa8b321%2FUntitled.png?width=485&amp;table=block&amp;id=9d93a876-ccd7-4a04-bd39-193a6f3ad75a"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F452f015b-baa4-48a3-bdc3-694a7fa8b321%2FUntitled.png?width=485&amp;table=block&amp;id=9d93a876-ccd7-4a04-bd39-193a6f3ad75a" style="width:485px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><blockquote id="https://www.notion.so/43e6ddc7091242c594f6c5684ff19664" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">LL/SC 指令不是</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">一个简单的内存读取/写入的函数</span></span><span class="SemanticString">，当使用 LL 指令从内存中读取一个字之后，比如 LL d, off(b)，处理器会记住 LL 指令的这次操作（会在 CPU 的寄存器中设置一个不可见的 bit 位），同时 LL 指令读取的地址 off(b) 也会保存在处理器的寄存器中。
</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"> SC 指令</span></span><span class="SemanticString">，比如 SC t, off(b)，</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">会检查上次 LL 指令执行后</span></span><span class="SemanticString">的 RMW（Read-Modify-Write）</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">操作是否是原子操作</span></span><span class="SemanticString">（即不存在其它对这个地址的操作），如果</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">是原子操作，则 t 的值将会被更新至内存中</span></span><span class="SemanticString">，</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">同时 t 的值也会变为1，表示操作成功</span></span><span class="SemanticString">；反之，如果 RMW的操作不是原子操作（即存在其它对这个地址的访问冲突），则 t 的值不会被更新至内存中，且 t 的值也会变为0，表示操作失败。</span></span><div id="https://www.notion.so/8cb19e7c3b6b4ba1a7f8b79309e6c89e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">条件式存储（store-conditional）指令，只有上一次加载的地址在期间都没有更新时，才会成功，（同时更新刚才链接的加载的地址的值）。成功时，条件存储返回 1，并将 ptr 指的值更新为 value。失败时，返回 0，并且不会更新值。</mark></span><span class="SemanticString">
SC 指令</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">执行失败的原因</strong></span><span class="SemanticString">有两种：
在</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"> LL/SC 操作过程中，发生了一个异常（或中断）</span></span><span class="SemanticString">，这些异常（或中断）可能会打乱 RMW 操作的原子性。
</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">在多核处理器中，一个核在进行 RMW 操作时，别的核试图对同样的地址也进行操作</span></span><span class="SemanticString">，这会导致 SC 指令执行的失败</span></span></p></div></blockquote><div id="https://www.notion.so/62d5201658154d128bc688af74016e52" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F18134efe-f5d4-430c-a31d-646d74cf83ee%2FUntitled.png?width=662&amp;table=block&amp;id=62d52016-5815-4d12-8bc6-88af74016e52"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F18134efe-f5d4-430c-a31d-646d74cf83ee%2FUntitled.png?width=662&amp;table=block&amp;id=62d52016-5815-4d12-8bc6-88af74016e52" style="width:662px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/072d0227ddc245719b08943f2b67a40f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Fetch-And-Add</strong></span></span></p></div><div id="https://www.notion.so/4b5355b6e4184955ba9084cc8601f016" class="ColumnList"><div id="https://www.notion.so/484fc20827134f95a7c8c06a175a0c07" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/04155abe86194f91905f47611252ccc5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">如果线程希望获取锁，首先对一个 ticket 值执行一个原子的获取并相加指令。这个值作为该线程的“turn”（顺位，即 myturn）。根据全局共享的 lock-&gt;turn 变量，当某一个线程的（myturn == turn）时，则轮到这个线程进入临界区。</span></span></p></div><div id="https://www.notion.so/c1f1619ef3fc498bbeb6783235f77c5d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">unlock 则是增加 turn，从而下一个等待线程可以进入临界区。</span></span></p></div><div id="https://www.notion.so/6f8ea11c07594029ba1ec8ad4abd0417" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/04fb9a2fd0944cb5bd1d351cacf4cf8b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">本方法能够</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">保证所有线程都能抢到锁</mark></span><span class="SemanticString">。只要一个线程获得了 ticket值，它最终会被调度。之前的方法则不会保证。比如基于测试并设置的方法，一个线程有可能一直自旋，即使其他线程在获取和释放锁。</span></span></p></div><div id="https://www.notion.so/6266711b2d9a40468252747f19b4aed9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div><div id="https://www.notion.so/21a9c26a5b974defa58a2d1a31a476de" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/1a5fd2e4fb704618a5ced7771ea0273d" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F0bf92e10-f2e3-4416-834d-f5196d028cd4%2FUntitled.png?width=410.9942932128906&amp;table=block&amp;id=1a5fd2e4-fb70-4618-a5ce-d7771ea0273d"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F0bf92e10-f2e3-4416-834d-f5196d028cd4%2FUntitled.png?width=410.9942932128906&amp;table=block&amp;id=1a5fd2e4-fb70-4618-a5ce-d7771ea0273d" style="width:410.9942932128906px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><h3 id="https://www.notion.so/d7f8515eaf6d47539a71d552a18a4963" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/d7f8515eaf6d47539a71d552a18a4963"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">避免（过度）自旋</span></span></h3><div id="https://www.notion.so/aa999049c7424a97900154f02aaed9a0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"> yield 的方法</strong></span></span></p></div><div id="https://www.notion.so/14a635f6d1d84f9e95214750881958b3" class="ColumnList"><div id="https://www.notion.so/aae6a959c73d4a3590dcea36e394a3b5" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.3125)"><div id="https://www.notion.so/612516f091f4454e968d116819c27af1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">定操作系统提供原语 yield()，线程可以调用它主动放弃 CPU，让其他线程运行。</span></span></p></div><div id="https://www.notion.so/af9b5d02d70f4ea9be9fd976e3c70ea0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">yield()系统调用能够让运行（running）态变为就绪（ready）态，从而允许其他线程运行。</span></span></p></div><div id="https://www.notion.so/74e5ada989404770b85233fa9adba349" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">本质上取消调度（deschedules）了它自己。</mark></span></span></p></div></div><div id="https://www.notion.so/daee6020e507405eb98f6782f74dd363" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.6875)"><div id="https://www.notion.so/a97430fd11634442a519c6427666cb7d" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3b816833-3497-4dd1-8b5b-6623540f8686%2FUntitled.png?width=442.99713134765625&amp;table=block&amp;id=a97430fd-1163-4442-a519-c6427666cb7d"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3b816833-3497-4dd1-8b5b-6623540f8686%2FUntitled.png?width=442.99713134765625&amp;table=block&amp;id=a97430fd-1163-4442-a519-c6427666cb7d" style="width:442.99713134765625px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/f97390a2799241e0ac363a5ce8912cb6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">考虑</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">许多线程</mark></span><span class="SemanticString">（例如 100 个）</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">反复竞争一把锁的情况</mark></span><span class="SemanticString">。在这种情况下，一个线程持有锁，在释放锁之前被抢占，其他 99 个线程分别调用 lock()，发现锁被抢占，然后让出 CPU。假定采用某种轮转调度程序，这 99 个线程会一直处于运行—让出这种模式，直到持有锁的线程再次运行。虽然比原来的浪费 99 个时间片的自旋方案要好，但这种方法仍然成本很高，</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">上下文切换的成本</mark></span><span class="SemanticString">是实实在在的，因此</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">浪费很大</mark></span><span class="SemanticString">。</span></span></p></div><div id="https://www.notion.so/e0ba1df693f046fcad9b3011f4154582" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">休眠队列</strong></span></span></p></div><div id="https://www.notion.so/0860d79d5bd4481da1e230e542f2a6de" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">显式地施加某种控制，决定锁释放时，谁能抢到锁。</span></span></p></div><div id="https://www.notion.so/72ac1f36bfaf4cca897e60579465f411" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3da30d92-ed90-4b4b-a57a-3752d3d6c415%2FUntitled.png?width=1048&amp;table=block&amp;id=72ac1f36-bfaf-4cca-897e-60579465f411"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3da30d92-ed90-4b4b-a57a-3752d3d6c415%2FUntitled.png?width=1048&amp;table=block&amp;id=72ac1f36-bfaf-4cca-897e-60579465f411" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/68825aac77d14ef78bf35c7625d70f6a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">park调用之前，线程被切换，另一个拥有锁的线程执行（随后释放了锁），这时被切换出去的线程随后park时，可能会永久睡眠（因为没有线程从临界区出来后执行unlock中的unpark）</span></span></p></div><div id="https://www.notion.so/11341ae7ab474eed9aa8220ef745196f" class="ColumnList"><div id="https://www.notion.so/47c1077eb42f4b38975e7dc0a58a866a" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.625)"><div id="https://www.notion.so/ef31805409bc4b63886821f2600e6a23" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">通过增加了第三个系统调用 separk()来解决这一问题。通过 setpark()，一个线程 表明自己马上要 park。如果刚好另一个线程被调度，并且调用了 unpark，那么后续的 park 调用就会直接返回，而不是一直睡眠。</span></span></p></div></div><div id="https://www.notion.so/9e7fef03bf504af48ac9e386c8f180f7" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.37500000000000006)"><div id="https://www.notion.so/890eca4324b7426f83e80b9fd740ac5e" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F76dfacc6-8f18-4d38-b36d-f7d30bc358cb%2FUntitled.png?width=253.99147033691406&amp;table=block&amp;id=890eca43-24b7-426f-83e8-0b9fd740ac5e"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F76dfacc6-8f18-4d38-b36d-f7d30bc358cb%2FUntitled.png?width=253.99147033691406&amp;table=block&amp;id=890eca43-24b7-426f-83e8-0b9fd740ac5e" style="width:253.99147033691406px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/9c7a487607784d0b8abcc9d594014e22" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">二阶段锁</strong></span></span></p></div><div id="https://www.notion.so/9a2150b3f8ce42bf8cb701b7c10534af" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">两阶段锁意识到自旋可能很有用，尤其是在很快就要释放锁的场景。
阶段锁的</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">第一阶段会先自旋一段时间</mark></span><span class="SemanticString">，希望它可以获取锁。 但是，如果</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">第一个自旋阶段没有获得锁第二阶段调用者会睡眠，直到锁可用</mark></span><span class="SemanticString">。</span></span></p></div><h2 id="https://www.notion.so/f6e50fc27ee94841847bcf194fa0b5ce" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/f6e50fc27ee94841847bcf194fa0b5ce"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">条件变量</span></span></h2><div id="https://www.notion.so/53a901c541a54b89b94cbe6a2a2ab6aa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在很多情况下，线程需要检查某一条件（condition）满足之后，才会继续运行。例如，父线程需要检查子线程是否执行完毕 [这常被称为 join()]。这种等待可以通过条件变量实现。</span></span></p></div><div id="https://www.notion.so/e5febcc86cb64e4f8e7fe1061899181b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">条件变量是一个显式队列</strong></span><span class="SemanticString">，当某些执行状态（即条件，condition）不满足时，线程可以把自己加入队列，等待（waiting）该条件。另外某个线程，当它改变了上述状态时，就可以唤醒一个或者多个等待线程（通过在该条件上发信号），让它们继续执行。</span></span></p></div><div id="https://www.notion.so/25179d3c8d0e4c6da904a0c1e51e65cd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">条件变量是用来等待而不是用来上锁的。条件变量用来自动阻塞一个线程，直到某特殊情况发生为止。</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">通常条件变量和互斥锁同时使用</mark></span><span class="SemanticString">。</span></span></p></div><div id="https://www.notion.so/923a1fcdbfbf4331bc140cc51cee9293" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"> </strong></strong></span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">pthread_cond_t c;</strong></code></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"> </strong></span><span class="SemanticString">创建一个条件变量
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">pthread_cond_wait:</code></span><span class="SemanticString">将释放锁并将调用线程置于睡眠状态。等待其他线程向它发出信号
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">pthread_cond_signal:</code></span><span class="SemanticString">解除阻塞条件变量上阻塞的至少一个线程。被唤醒的线程重新持有锁</span></span></p></div><div id="https://www.notion.so/383b01c514634b6db42621b57d42f12e" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fdf9ad530-0556-4e03-92d2-006a01ca288c%2FUntitled.png?width=768&amp;table=block&amp;id=383b01c5-1463-4b6d-b426-21b57d42f12e"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fdf9ad530-0556-4e03-92d2-006a01ca288c%2FUntitled.png?width=768&amp;table=block&amp;id=383b01c5-1463-4b6d-b426-21b57d42f12e" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/2a8a19a1dbf54b8da7d15521e4a4cbe6" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F4bbde426-6af4-4e91-b503-baf9ef901379%2FUntitled.png?width=726.3541259765625&amp;table=block&amp;id=2a8a19a1-dbf5-4b8d-a7d1-5521e4a4cbe6"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F4bbde426-6af4-4e91-b503-baf9ef901379%2FUntitled.png?width=726.3541259765625&amp;table=block&amp;id=2a8a19a1-dbf5-4b8d-a7d1-5521e4a4cbe6" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/dd22ba1cff6f4524a02f0a94eaf99938" class="ColumnList"><div id="https://www.notion.so/92bc934efee54c8dbc9735609a1961f1" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><blockquote id="https://www.notion.so/70c7b7119e74412f8b27e9e398e8bfb9" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">为什么用while而不是if进行判断</em></strong></span><span class="SemanticString">
在多核处理器下或者某些竞态条件下，</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">pthread_cond_signal可能会激活多于一个线程（</strong></span><span class="SemanticString">阻塞在条件变量上的线程）。结果就是，当一个线程调用pthread_cond_signal()后，多个调用pthread_cond_wait()
pthread_cond_timedwait()的线程返回。这种效应就称为“虚假唤醒”。因为等待在条件变量上的线程被唤醒有可能不是因为条件满足而是由于</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">虚假唤醒</mark></strong></span><span class="SemanticString">。所以，我们</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">需要对条件变量的状态进行不断检查直到其满足条件</strong></span></span></blockquote><div id="https://www.notion.so/967f29cbe4764802ba7eb95d4bd91f0e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">变量 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">done 的重要性：</strong></span><span class="SemanticString">它记录了线程有兴趣知道的值。睡眠、唤醒和锁都离不开它。</span></span></p></div><div id="https://www.notion.so/ea122e8a137d486f84e921f683388d4d" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1b7e9dae-dde9-40c9-80d8-e9dd0f2ed398%2FUntitled.png?width=548&amp;table=block&amp;id=ea122e8a-137d-486f-84e9-21f683388d4d"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1b7e9dae-dde9-40c9-80d8-e9dd0f2ed398%2FUntitled.png?width=548&amp;table=block&amp;id=ea122e8a-137d-486f-84e9-21f683388d4d" style="width:548px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div><div id="https://www.notion.so/d7e107ba133d4bd0a511843bfd4d8fc1" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/7c4272c8ea624973a350525ac6fb9a3a" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fba015bb6-aa10-4bd3-9f50-9fcece3a9152%2FUntitled.png?width=311.491455078125&amp;table=block&amp;id=7c4272c8-ea62-4973-a350-525ac6fb9a3a"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fba015bb6-aa10-4bd3-9f50-9fcece3a9152%2FUntitled.png?width=311.491455078125&amp;table=block&amp;id=7c4272c8-ea62-4973-a350-525ac6fb9a3a" style="width:311.491455078125px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><blockquote id="https://www.notion.so/5e108d088a784e949195784a90b3be40" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">为什么要加锁？
</strong></em></span><span class="SemanticString">如果父进程调用 thr_join()，然后检查完 done 的值为 0，然后试图睡眠。</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">但在调用 wait 进入睡眠之前，父进程被中断</strong></span><span class="SemanticString">。子线程修改变量 done 为 1，发出信号，同样没有等待线程。</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">父线程再次运行时，就会长眠不醒</strong></span><span class="SemanticString">。
</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">加锁保证了锁之间代码的原子性</strong></mark></span></span></blockquote></div></div><h3 id="https://www.notion.so/63c67044f1c943ca82d0779cc7ee1892" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/63c67044f1c943ca82d0779cc7ee1892"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">生产者/消费者（有界缓冲区）问题</span></span></h3><div id="https://www.notion.so/ca64a0fdc5874ce3a4dc73561450a700" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">快速总结：</span></span></p></div><div id="https://www.notion.so/51c4987f69534bef84cabbadfdd731c4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">用while而不是if 防止虚假唤醒
生产者与消费者用不同的条件变量：使用一个条件变量时→可能生产者（缓冲已满时）唤醒生产者，消费者（缓冲区以空时）唤醒消费者
外层的for循环是生产者线程生产loops次，消费者线程消费loops次。</span></span></p></div><div id="https://www.notion.so/0250de8823f64f56983c7935e96ed299" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F17bbff9d-ed81-4b88-8898-49557fb1ef1d%2FUntitled.png?width=811&amp;table=block&amp;id=0250de88-23f6-4f56-983c-7935e96ed299"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F17bbff9d-ed81-4b88-8898-49557fb1ef1d%2FUntitled.png?width=811&amp;table=block&amp;id=0250de88-23f6-4f56-983c-7935e96ed299" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h3 id="https://www.notion.so/ff20d272ef244d51b2aa87b5079ed797" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/ff20d272ef244d51b2aa87b5079ed797"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">覆盖条件</span></span></h3><div id="https://www.notion.so/a3a56e14701648ccbf5427df371f3f92" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">考虑多个消费者要消费不同的量，有些消费者可能被唤醒但是无法消费（内存分配，未达到需求）    →使用</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">pthread_cond_broadcast()</code></span><span class="SemanticString"> （广播）代替上述代码中的</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">pthread_cond_signal()</code></span><span class="SemanticString">，唤醒所有的等待线程。</span></span></p></div><div id="https://www.notion.so/ce8fe655eb754ca593dc6b6f0e77e3a3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">它能</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">覆盖所有需要唤醒线程的场景（保守策略）</span></span><span class="SemanticString">。成本是太多线程被唤醒， </span></span></p></div><h2 id="https://www.notion.so/285d0445013447839bc6f68b1b34b648" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/285d0445013447839bc6f68b1b34b648"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">信号量</span></span></h2><h3 id="https://www.notion.so/4af9a36e90da4329ad704bfa8d80b95b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/4af9a36e90da4329ad704bfa8d80b95b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">基本概念</span></span></h3><div id="https://www.notion.so/824c9d096ff0436eb61b6bd0245a342c" class="ColumnList"><div id="https://www.notion.so/ec78a928874c4d67b9c51ae7f134a55f" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/3804dd7790e74220b456d8998bbdfb18" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">信号量是有一个整数值的对象，可以用两个函数来操作它。在 POSIX 标准中，是(P操作)sem_wait()和(V操作) sem_post() 第二个参数为0表示共享，第三个参数是初值</span></span></p></div></div><div id="https://www.notion.so/ef244790237b4caea8a56c2880078b2d" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/2ab7341e42dd4dc9b49fb9f3b6b28413" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff0fc5c99-a9e7-4111-8cf2-c323571e7b04%2FUntitled.png?width=435&amp;table=block&amp;id=2ab7341e-42dd-4dc9-b49f-b9f3b6b28413"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff0fc5c99-a9e7-4111-8cf2-c323571e7b04%2FUntitled.png?width=435&amp;table=block&amp;id=2ab7341e-42dd-4dc9-b49f-b9f3b6b28413" style="width:435px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/f3284c56fde04d2e8569e23e4b150820" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1dd2b86c-e7d8-4ce9-a950-1cf9e48108f2%2FUntitled.png?width=685&amp;table=block&amp;id=f3284c56-fde0-4d2e-8569-e23e4b150820"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1dd2b86c-e7d8-4ce9-a950-1cf9e48108f2%2FUntitled.png?width=685&amp;table=block&amp;id=f3284c56-fde0-4d2e-8569-e23e4b150820" style="width:685px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/ce8b02608ed14eb8b6dcb77054b7d0b4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">信号量的数据结构：</strong></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/6964b98a3a3549e7b721a0c7947edccf" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">两个分量：一个是信号量的值，另一个是信号量队列的队列指针。</strong></span></span></li><li id="https://www.notion.so/9f445a02766d4857bf8f06261fadc914" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">信号量的值的含义：</strong></span></span></li><li id="https://www.notion.so/940198016ebd423da2c7314d7b860cb8" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">如果S.value</strong></span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">≥0,则表明系统有多少个临界资源</strong></mark></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">可以分配给请求的进程。</strong></span></span></li><li id="https://www.notion.so/af25c37db680404ba3c8ebfbf0b5e650" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">如果S.value</strong></span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">&lt;0,表示等待使用该临界资源的进程数</strong></mark></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">。</strong></span></span></li></ul><div id="https://www.notion.so/35ffe61d963143b0a9b32209874e0989" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">P和V操作原语定义：</strong></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/669d7c44b706427fb677d38ebacacb66" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">P(s)：将信号量s.value减1，若结果小于0，则调用P(s)的进程被置成等待信号量s的状态,并把该进程挂到信号量的等待队列上。（先减，小于0就等，排队）</strong></span></span></li><li id="https://www.notion.so/04571da262664b958deef0d76c85c648" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">V(s)：将信号量s.value加1，若结果不大于0（有线程等待），则释放一个等待信号量s的进程。</strong></span></span></li></ul><h3 id="https://www.notion.so/22ea2c3244534c299638069231f18d19" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/22ea2c3244534c299638069231f18d19"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">信号量实现锁（二值信号量），初值为1</span></span></h3><div id="https://www.notion.so/75011de0f3554d649d4556706c6981e3" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F4a039e49-5e95-4533-bb56-48680e1ef2f4%2FUntitled.png?width=581&amp;table=block&amp;id=75011de0-f355-4d64-9d45-56706c6981e3"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F4a039e49-5e95-4533-bb56-48680e1ef2f4%2FUntitled.png?width=581&amp;table=block&amp;id=75011de0-f355-4d64-9d45-56706c6981e3" style="width:581px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h3 id="https://www.notion.so/571d3af5cf2a496a8ba284c9a0b57ff9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/571d3af5cf2a496a8ba284c9a0b57ff9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">信号量作为条件变量</span></span></h3><div id="https://www.notion.so/fc4046900e374dde81738eb5b96a0743" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">父进程wait，子进程post，初值为0</span></span></p></div><div id="https://www.notion.so/0e6fb3326b434e4199bfd89dbb4443a2" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ffff55a08-64eb-40e7-a129-d54ec19f8308%2FUntitled.png?width=522&amp;table=block&amp;id=0e6fb332-6b43-4e41-99bf-d89dbb4443a2"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ffff55a08-64eb-40e7-a129-d54ec19f8308%2FUntitled.png?width=522&amp;table=block&amp;id=0e6fb332-6b43-4e41-99bf-d89dbb4443a2" style="width:522px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h3 id="https://www.notion.so/53c1f33d6135458698f9c4e207c3cb25" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/53c1f33d6135458698f9c4e207c3cb25"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">生产者/消费者（有界缓冲区）问题</span></span></h3><div id="https://www.notion.so/c224c1a2432e48c1b43dac15ce62fbf2" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fb08fc1ba-6f8a-4d54-8c1a-774828d3e3ea%2FUntitled.png?width=679&amp;table=block&amp;id=c224c1a2-432e-48c1-b43d-ac15ce62fbf2"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fb08fc1ba-6f8a-4d54-8c1a-774828d3e3ea%2FUntitled.png?width=679&amp;table=block&amp;id=c224c1a2-432e-48c1-b43d-ac15ce62fbf2" style="width:679px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/af30f54ff7c64fe88387917ae09db601" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">P.V操作</strong></span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">必须成对出现</strong></mark></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">，有一个P操作就一定有一个V操作</strong></span></span></p></div><div id="https://www.notion.so/9118a1f6725748e39b6b2904df822cec" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">当为互斥操作时，它们同处于同一进程
当为同步操作时，则不在同一进程中出现</strong></span></span></p></div><div id="https://www.notion.so/f9f039aac0a24730942030d3ca0c0757" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">如果P(S1)和P(S2)两个操作在一起，那么P操作的顺序至关重要,</strong></span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">一个同步P操作与一个互斥P操作在一起时，同步P操作在互斥P操作前，（避免死锁，循环等待）</strong></mark></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">两个V操作顺序无关紧要</strong></span></span></p></div><h3 id="https://www.notion.so/72d90e682a1b4d80b73b6394286af73a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/72d90e682a1b4d80b73b6394286af73a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">读者-写者问题</span></span></h3><div id="https://www.notion.so/a0f50358af884650a8b2ec440982de35" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">制约条件分析：</em></span></span></p></div><div id="https://www.notion.so/22a4e8788e604e84a9ad65d0999d224f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">1、允许多个进程同时读文件（读－读允许）；</strong></span></span></p></div><div id="https://www.notion.so/42a1bb89658243cab717059f2219f948" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">2、不允许在进程读文件时让另外一进程去写文件；有进程在写文件时不让另外一个进程去读该文件（“读-写”互斥）；</strong></span></span></p></div><div id="https://www.notion.so/3cf65f56a9ee4eaabf253506b97f97bc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">3、不允许多个写进程同时写同一文件（“写-写”互斥）。
读者优先：容易导致写者饥饿</strong></span></span></p></div><div id="https://www.notion.so/fc82d225627642b8bf8987c592ddc369" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fcd790409-0dd1-493d-b3d6-7c04270f601e%2FUntitled.png?width=670&amp;table=block&amp;id=fc82d225-6276-42b8-bf89-87c592ddc369"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fcd790409-0dd1-493d-b3d6-7c04270f601e%2FUntitled.png?width=670&amp;table=block&amp;id=fc82d225-6276-42b8-bf89-87c592ddc369" style="width:670px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/fdf1fa898d534cb0b08fa2d0a48bf3d0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">写者优先</span></span></p></div><pre id="https://www.notion.so/c91ef9336e904994a70f3366c8cbb387" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>// 共享数据
信号量 mutex, wrt, turnstile;
int readcount = 0;

// 初始值
mutex = 1, wrt = 1, turnstile = 1;

// 读者
wait(turnstile);  // 等待turnstile信号量
wait(mutex);      // 互斥访问readcount
readcount++;     // 读者数量增加
if (readcount == 1)
    wait(wrt);   // 第一个读者等待写者释放wrt信号量
signal(mutex);    // 释放mutex信号量
signal(turnstile); // 释放turnstile信号量
...
// 执行读取操作
...
wait(mutex);       // 互斥访问readcount
readcount--;      // 读者数量减少
if (readcount == 0)
    signal(wrt);   // 最后一个读者释放wrt信号量
signal(mutex);     // 释放mutex信号量

// 写者
wait(turnstile);  // 等待turnstile信号量
wait(wrt);        // 等待wrt信号量
signal(turnstile); // 释放turnstile信号量
...
// 执行写入操作
...
signal(wrt);      // 释放wrt信号量
</span></span></span></code></pre><div id="https://www.notion.so/27748879396d48399cc5152c64d34001" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">公平竞争</span></span></p></div><pre id="https://www.notion.so/276536eea6fe41e6a542a7b1edeb2297" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>// 共享数据
semaphore mutex, wrt;
int readCount = 0;

// 初始值
mutex = 1, wrt = 1;

// 读者
wait(mutex);          // 互斥访问readCount
if (readCount == 0) {
    wait(wrt);        // 第一个读者等待写者释放wrt信号量
}
readCount++;          // 读者数量增加
signal(mutex);        // 释放mutex信号量
...
// 执行读取操作
...
wait(mutex);          // 互斥访问readCount
readCount--;          // 读者数量减少
if (readCount == 0) {
    signal(wrt);      // 最后一个读者释放wrt信号量
}
signal(mutex);        // 释放mutex信号量

// 写者
wait(mutex);          // 互斥访问临界区
wait(wrt);            // 等待wrt信号量
signal(mutex);        // 释放mutex信号量
...
// 执行写入操作
...
signal(wrt);          // 释放wrt信号量</span></span></span></code></pre><h3 id="https://www.notion.so/9a905afb0aa54135acfcd10f26e1cf5b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/9a905afb0aa54135acfcd10f26e1cf5b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">哲学家用餐问题</span></span></h3><div id="https://www.notion.so/cf182cfb54fd4afdbda318313218f931" class="ColumnList"><div id="https://www.notion.so/33511d4831d04df38439619e2ce38319" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/9470c3fc66e34a999a283db303c29de7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">死锁解决方法：</span></span></p></div><div id="https://www.notion.so/c51206aaee874a2d8e3b201744e19c6b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">至多只允许四位哲学家同时去拿左边的筷子；</span></span></p></div><div id="https://www.notion.so/3df73a8b801a40a1a70f394e20fef9d6" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1938dd74-d79c-4081-90b8-f95af852e5df%2FUntitled.png?width=370&amp;table=block&amp;id=3df73a8b-801a-40a1-a70f-394e20fef9d6"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1938dd74-d79c-4081-90b8-f95af852e5df%2FUntitled.png?width=370&amp;table=block&amp;id=3df73a8b-801a-40a1-a70f-394e20fef9d6" style="width:370px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/01d8f41302ad47d286169f3126beeca7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">规定奇数号哲学家先拿起他左边的筷子，而偶数号哲学家先拿起他右边的筷子。</span></span></p></div><div id="https://www.notion.so/b3fe04897465482288a813c366f0e3b1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">仅当哲学家左右两边的筷子均可用时才允许他拿起筷子；</span></span></p></div></div><div id="https://www.notion.so/4d155bf79bd6412eb6323195b4d03782" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/1ffa190687414d88851fcb064a0d7a5a" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F45805d6e-6d50-4c31-9604-f3524149c51b%2FUntitled.png?width=351&amp;table=block&amp;id=1ffa1906-8741-4d88-851f-cb064a0d7a5a"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F45805d6e-6d50-4c31-9604-f3524149c51b%2FUntitled.png?width=351&amp;table=block&amp;id=1ffa1906-8741-4d88-851f-cb064a0d7a5a" style="width:351px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/029e09eff7c740178811159310d37f09" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div></div><h3 id="https://www.notion.so/3673e54bfd08446babd4fb09f07a523d" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/3673e54bfd08446babd4fb09f07a523d"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">用锁和条件变量实现信号量</span></span></h3><div id="https://www.notion.so/af697e73e792496ba2d490dffa7f7b73" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fa6b9e24d-851a-47c5-8765-7f404188ad8d%2FUntitled.png?width=616&amp;table=block&amp;id=af697e73-e792-496b-a2d4-90dffa7f7b73"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fa6b9e24d-851a-47c5-8765-7f404188ad8d%2FUntitled.png?width=616&amp;table=block&amp;id=af697e73-e792-496b-a2d4-90dffa7f7b73" style="width:616px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/07773cd92c4543deb2135924f5599f01" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这里的p操作先比较减减</span></span></p></div><h2 id="https://www.notion.so/8e0799d9ddd049d6812d4e325c72d341" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/8e0799d9ddd049d6812d4e325c72d341"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">常见并发问题</span></span></h2><h3 id="https://www.notion.so/0aa237f7bedd4c3181580be0e836f47c" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/0aa237f7bedd4c3181580be0e836f47c"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">非死锁缺陷：</span></span></h3><div id="https://www.notion.so/25a087b5dfbf4949b24b1086992e222f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">违反原子性</mark></strong></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">（atomicity violation）缺陷</strong></span></span></p></div><div id="https://www.notion.so/8dd549cd5477422c8ebe08f22e49ee07" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F072ae99e-1363-435c-9715-149b219127f4%2FUntitled.png?width=768&amp;table=block&amp;id=8dd549cd-5477-422c-8ebe-08f22e49ee07"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F072ae99e-1363-435c-9715-149b219127f4%2FUntitled.png?width=768&amp;table=block&amp;id=8dd549cd-5477-422c-8ebe-08f22e49ee07" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/fcd8fc45474745988588d3ab3d0ea6bd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">解决方法：加锁</span></span></p></div><div id="https://www.notion.so/1dc303d8a01749c3a4c26e587b19486e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">错误顺序</mark></strong></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">（order violation）缺陷</strong></span></span></p></div><div id="https://www.notion.so/ed8229a133a94cd4ac45e7f5691b3a6f" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8269ec25-35cc-4d07-9fe8-a2273780bc42%2FUntitled.png?width=768&amp;table=block&amp;id=ed8229a1-33a9-4cd4-ac45-e7f5691b3a6f"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8269ec25-35cc-4d07-9fe8-a2273780bc42%2FUntitled.png?width=768&amp;table=block&amp;id=ed8229a1-33a9-4cd4-ac45-e7f5691b3a6f" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/6c76df210d5a4d309a5824998625c45f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">解决方式：通过强制顺序来修复这种缺陷。正如之前详细讨论的，</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">条件变量</span></span><span class="SemanticString">（condition
variables）就是一种简单可靠的方式，</span></span></p></div><div id="https://www.notion.so/7419803858404b0b965d5a29aec0bc45" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Faddcca59-7be9-4642-a623-de7ccf0014c6%2FUntitled.png?width=768&amp;table=block&amp;id=74198038-5840-4b0b-965d-5a29aec0bc45"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Faddcca59-7be9-4642-a623-de7ccf0014c6%2FUntitled.png?width=768&amp;table=block&amp;id=74198038-5840-4b0b-965d-5a29aec0bc45" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h3 id="https://www.notion.so/0431517bab0f4645ad6bd09e2b5f76a6" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/0431517bab0f4645ad6bd09e2b5f76a6"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">死锁缺陷：</strong></span></span></h3><div id="https://www.notion.so/3656b0658df24eedb7da6b0b3e7e2720" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">发生条件：</em></strong></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/2191a8f0d1554ee4940d89bb1d5c59b6" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">互斥：</strong></span><span class="SemanticString">线程对于需要的资源进行互斥的访问（例如一个线程抢到锁）。</span></span></li><li id="https://www.notion.so/7d5858aa499341ffbf700ff53268f9dc" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">持有并等待：</strong></span><span class="SemanticString">线程持有了资源（例如已将持有的锁），同时又在等待其他资源（例如，需要获得的锁）。</span></span></li><li id="https://www.notion.so/975e0e485f3a4ac2826f69abcac16a3a" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">非抢占：</strong></span><span class="SemanticString">线程获得的资源（例如锁），不能被抢占。</span></span></li><li id="https://www.notion.so/6551315d13574722a88b15278a93c649" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">循环等待：</strong></span><span class="SemanticString">线程之间存在一个环路，环路上每个线程都额外持有一个资源，而这个资源又是下一个线程要申请的。
如果这</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow"> 4 个条件的任何一个没有满足，死锁就不会产生</mark></span><span class="SemanticString">。</span></span></li></ul><div id="https://www.notion.so/2c93975b543a4edbbdb5826d5b93e178" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">预防方式：</strong></em></span></span></p></div><div id="https://www.notion.so/f05428b0b2054249989733966ddd9705" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">循环等待：</strong></span></span></p></div><div id="https://www.notion.so/df2387477c1c499286e3628136bfe655" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">获取锁时提供一个全序（total ordering）。假如系统共有两个锁（L1 和 L2）， 那么我们每次都先申请 L1 然后申请 L2，就可以避免死锁。这样严格的顺序避免了循环等待</span></span></p></div><div id="https://www.notion.so/813d6b4308224a5dbc6a217b6226edfa" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F69fd53b9-e88d-4bfe-acfd-2c06784bac60%2FUntitled.png?width=768&amp;table=block&amp;id=813d6b43-0822-4a5d-bc6a-217b6226edfa"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F69fd53b9-e88d-4bfe-acfd-2c06784bac60%2FUntitled.png?width=768&amp;table=block&amp;id=813d6b43-0822-4a5d-bc6a-217b6226edfa" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/8ab445dd1af744dfafe87bd7b7d6e29b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">持有并等待：</strong></span></span></p></div><div id="https://www.notion.so/450d72118e52484ca8bd13af838c3e8f" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F81c67f40-93b1-4bc6-b6c6-8b9125e32e55%2FUntitled.png?width=768&amp;table=block&amp;id=450d7211-8e52-484c-a8bd-13af838c3e8f"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F81c67f40-93b1-4bc6-b6c6-8b9125e32e55%2FUntitled.png?width=768&amp;table=block&amp;id=450d7211-8e52-484c-a8bd-13af838c3e8f" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/87f63156d2184563ae3961b71bdcf3e5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">非抢占：</strong></span></span></p></div><div id="https://www.notion.so/3b15d000d34c480ca9ce721501ea0e57" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">trylock()函数会尝试获得锁，或者返回−1，表示锁已经被占有。你可以稍后重试 一下</span></span></p></div><div id="https://www.notion.so/ef5e6cdeff224dd798ae07a37c4e3f5e" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F698901e3-2f57-4832-8e41-a51d77b81c30%2FUntitled.png?width=768&amp;table=block&amp;id=ef5e6cde-ff22-4dd7-98ae-07a37c4e3f5e"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F698901e3-2f57-4832-8e41-a51d77b81c30%2FUntitled.png?width=768&amp;table=block&amp;id=ef5e6cde-ff22-4dd7-98ae-07a37c4e3f5e" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/7083db70a4774330b44bb911dfb78675" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">互斥：</strong></span></span></p></div><div id="https://www.notion.so/93ff74ee3d424dc1ba131813ffe45e6d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">通过强大的硬件指令，构造出不需要锁的数据结构.</span></span></p></div><div id="https://www.notion.so/d9e439d18f7b4e32b890b4f5e512491f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">通过调度来避免死锁：</strong></em></span></span></p></div><div id="https://www.notion.so/346e1a954971491cb12c197fbeab79aa" class="ColumnList"><div id="https://www.notion.so/33189cb108b8411098cb54b9dca313ff" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/990caa1311ef4999aea6be82c49d6588" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff5e76971-6459-4510-93f0-68a1971168d6%2FUntitled.png?width=618&amp;table=block&amp;id=990caa13-11ef-4999-aea6-be82c49d6588"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff5e76971-6459-4510-93f0-68a1971168d6%2FUntitled.png?width=618&amp;table=block&amp;id=990caa13-11ef-4999-aea6-be82c49d6588" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/9a932fef5a50450580f36b787ec5b2d9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">让有可能死锁的不同时运行</span></span></p></div></div><div id="https://www.notion.so/34a816f9511948b199d45eb293df8a84" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/732ee089f14d40e68f0b6208ba6d948b" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F0558fc77-4bd8-4409-b734-5837e80e548f%2FUntitled.png?width=286&amp;table=block&amp;id=732ee089-f14d-40e6-8f0b-6208ba6d948b"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F0558fc77-4bd8-4409-b734-5837e80e548f%2FUntitled.png?width=286&amp;table=block&amp;id=732ee089-f14d-40e6-8f0b-6208ba6d948b" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/305c1897d7d64022b24f5d807db00b80" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">检验并恢复：</strong></em></span></span></p></div><div id="https://www.notion.so/195c1e078b9b4f10829b26da57d58bb8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">允许死锁偶尔发生，检查到死锁时再采取行动。 → 重启</span></span></p></div><h3 id="https://www.notion.so/42c821c8feb94e3099490f7eaaf7aa03" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/42c821c8feb94e3099490f7eaaf7aa03"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">安全态与银行家算法：</strong></span></span></h3><div id="https://www.notion.so/33e23b8efa454bf6b39d33799718aa24" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当进程申请一个有效的资源的时候，系统必须确定分配后是安全的。
如果存在一个安全序列，系统处于安全态。
对于</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">进程序列&lt; P1, P2, …, Pn &gt;，如果每个Pi 对资源的请求都能够由当前有效地资源加上Pj（j &lt; i）释放的资源来满足，那么这个序列是安全的</mark></span><span class="SemanticString">。在这种情形下，如果Pi 的资源需求不能够立即得到满足，那么它可以等到Pj 结束。当它们结束时，Pi 可以获得所需的全部资源，完成指定的工作，返回获取的资源并结束运行。</span></span></p></div><div id="https://www.notion.so/22825cec059f4164aee56460df2a66f0" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fc3dcbbe5-1e2b-4a5c-85e7-f498bd287576%2FUntitled.png?width=663&amp;table=block&amp;id=22825cec-059f-4164-aee5-6460df2a66f0"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fc3dcbbe5-1e2b-4a5c-85e7-f498bd287576%2FUntitled.png?width=663&amp;table=block&amp;id=22825cec-059f-4164-aee5-6460df2a66f0" style="width:663px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h3 id="https://www.notion.so/908d7f67b7ce41bbaf1aff44b1caf32d" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/908d7f67b7ce41bbaf1aff44b1caf32d"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">银行家算法：</span></span></h3><div id="https://www.notion.so/2d159d20d15e4755979107a66adfbfb6" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F57b5fbdb-fceb-41f3-8884-60816abecd81%2FUntitled.png?width=644&amp;table=block&amp;id=2d159d20-d15e-4755-9791-07a66adfbfb6"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F57b5fbdb-fceb-41f3-8884-60816abecd81%2FUntitled.png?width=644&amp;table=block&amp;id=2d159d20-d15e-4755-9791-07a66adfbfb6" style="width:644px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/9a3ecc503c474d0fab20430fc2618af3" class="ColumnList"><div id="https://www.notion.so/13dfff3e9ab5413fb2e2d0c0a45e8b39" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/6cf19db2cb8147fcb08b601510606241" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F09743fba-9adc-4c88-abd9-9d65ca91a764%2FUntitled.png?width=651&amp;table=block&amp;id=6cf19db2-cb81-47fc-b08b-601510606241"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F09743fba-9adc-4c88-abd9-9d65ca91a764%2FUntitled.png?width=651&amp;table=block&amp;id=6cf19db2-cb81-47fc-b08b-601510606241" style="width:651px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div><div id="https://www.notion.so/02d0fb2edb0040d2a2387809ec753a23" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/c33a255a6861474e8d4cfffa8ac80ade" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1a9e6003-ebf9-467a-a140-ca43f8db030e%2FUntitled.png?width=619&amp;table=block&amp;id=c33a255a-6861-474e-8d4c-fffa8ac80ade"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1a9e6003-ebf9-467a-a140-ca43f8db030e%2FUntitled.png?width=619&amp;table=block&amp;id=c33a255a-6861-474e-8d4c-fffa8ac80ade" style="width:619px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/aac059f5f99644b889b4b3e87ea76942" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3e54f1e4-3736-4451-a3f8-0ce40526c1b5%2FUntitled.png?width=638&amp;table=block&amp;id=aac059f5-f996-44b8-89b4-b3e87ea76942"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3e54f1e4-3736-4451-a3f8-0ce40526c1b5%2FUntitled.png?width=638&amp;table=block&amp;id=aac059f5-f996-44b8-89b4-b3e87ea76942" style="width:638px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/b297cef8b6c74ec7b2f775f39cd16d87" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">（1)如果Request[i]≤Need[i]，跳到第2步，否则出错；
（2)如果Request[i]≤Available，跳到第3步,否则挂起进程等待；
（3)根据进程的资源请求,先把资源试探性分配给它。
（4)执行安全性检查算法，如果安全状态则承认试分配，否则抛弃试分配，进程Pi等待。
（5)假定系统当前满足申请条件：则按以下方式修改状态
</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Available= Available- Request[i];
Allocation[i]= Allocation[i]+Request[i];
Need[i]=Need[i]-Request[i];
</code></span></span></p></div><div id="https://www.notion.so/b416ae57b75b419fa4e55991ee482422" class="ColumnList"><div id="https://www.notion.so/ad848b2ab6d343139d18f5ba56cde545" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.4375)"><div id="https://www.notion.so/7b0b4028203248d98d995316bf244960" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff19186f8-c0de-4027-8183-1aa6fb38d168%2FUntitled.png?width=666&amp;table=block&amp;id=7b0b4028-2032-48d9-8d99-5316bf244960"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff19186f8-c0de-4027-8183-1aa6fb38d168%2FUntitled.png?width=666&amp;table=block&amp;id=7b0b4028-2032-48d9-8d99-5316bf244960" style="width:666px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div><div id="https://www.notion.so/4ccc88349c634b96beec59d3256e6d8c" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5625)"><div id="https://www.notion.so/7d38085a0791418c9f42a4d6d3e4e68c" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F7ad01e11-e425-4c51-ba0a-2c6f446f75e6%2FUntitled.png?width=687&amp;table=block&amp;id=7d38085a-0791-418c-9f42-a4d6d3e4e68c"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F7ad01e11-e425-4c51-ba0a-2c6f446f75e6%2FUntitled.png?width=687&amp;table=block&amp;id=7d38085a-0791-418c-9f42-a4d6d3e4e68c" style="width:687px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/68ffdd6b308540e0a69d9ec2cea37db9" class="ColumnList"><div id="https://www.notion.so/2778b13769d249928c2c75ee605cb5f8" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/ee38f48260514bb7a690f6e841cc5326" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1581f465-3489-47c7-a07b-a87947c647dc%2FUntitled.png?width=678&amp;table=block&amp;id=ee38f482-6051-4bb7-a690-f6e841cc5326"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1581f465-3489-47c7-a07b-a87947c647dc%2FUntitled.png?width=678&amp;table=block&amp;id=ee38f482-6051-4bb7-a690-f6e841cc5326" style="width:678px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div><div id="https://www.notion.so/725dff629c154ed091c4abf6f43f3686" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/ae6c756c4678441fb6cf57fcecdcf8f2" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F6045a1c4-94ce-47b7-b4e0-b6820ceadd8e%2FUntitled.png?width=656&amp;table=block&amp;id=ae6c756c-4678-441f-b6cf-57fcecdcf8f2"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F6045a1c4-94ce-47b7-b4e0-b6820ceadd8e%2FUntitled.png?width=656&amp;table=block&amp;id=ae6c756c-4678-441f-b6cf-57fcecdcf8f2" style="width:656px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/783e0d867a6d423fbeaef04aa81ebe36" class="ColumnList"><div id="https://www.notion.so/e8881e9695b9455aa4cc78ca16ddbaa1" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/385753bad4874bcd900c6bdc33b2a3b8" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fb1e04e14-bf67-4aa9-8a95-cd06019b3590%2FUntitled.png?width=666&amp;table=block&amp;id=385753ba-d487-4bcd-900c-6bdc33b2a3b8"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fb1e04e14-bf67-4aa9-8a95-cd06019b3590%2FUntitled.png?width=666&amp;table=block&amp;id=385753ba-d487-4bcd-900c-6bdc33b2a3b8" style="width:666px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div><div id="https://www.notion.so/bfb91f7770c24bd6a654014564cf9f12" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/42ff5cab746f481ca31255b7e00f7c5e" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3789176a-12d0-4d42-b586-b528bf3866f5%2FUntitled.png?width=653&amp;table=block&amp;id=42ff5cab-746f-481c-a312-55b7e00f7c5e"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3789176a-12d0-4d42-b586-b528bf3866f5%2FUntitled.png?width=653&amp;table=block&amp;id=42ff5cab-746f-481c-a312-55b7e00f7c5e" style="width:653px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/eeef3891d06443c4a820c24b2ab49a5a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">大概就是分配一下,检查一下，检查不安全就不这样分配，等着</span></span></p></div><h3 id="https://www.notion.so/314f9e329ec94662bf17d5efd6415e04" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/314f9e329ec94662bf17d5efd6415e04"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">缺点：</span></span></h3><div id="https://www.notion.so/f291367f30ac46d187c55e88073a13b6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">进程</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">很难在运行前知道其所需资源的最大值</mark></span><span class="SemanticString">。
系统中各</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">进程之间必须是无关的</mark></span><span class="SemanticString">，即没有同步要求，无法处理有同步关系的进程。
</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">进程的数量和资源的数目是固定不变</mark></span><span class="SemanticString">的，无法处理进程数量和资源数目动态变化的情况。</span></span></p></div><div id="https://www.notion.so/e1f725881cd04ba19a8387a8148f53ef" class="Divider"></div><div id="https://www.notion.so/c1d1e1df98184072918a207038ec634e" class="Divider"></div><h1 id="https://www.notion.so/9d46ae1f92a543f28d6741e9e19af03b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/9d46ae1f92a543f28d6741e9e19af03b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">持久性</span></span></h1><h2 id="https://www.notion.so/303a7fe9c7154d048962668279fb913f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/303a7fe9c7154d048962668279fb913f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">I/O设备</span></span></h2><div id="https://www.notion.so/3b3305d1f9b3419a80367eb54443e4de" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F2c954070-f0b7-4175-85c6-9df9ff93a1de%2FUntitled.png?width=418.0034484863281&amp;table=block&amp;id=3b3305d1-f9b3-419a-8036-7eb54443e4de"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F2c954070-f0b7-4175-85c6-9df9ff93a1de%2FUntitled.png?width=418.0034484863281&amp;table=block&amp;id=3b3305d1-f9b3-419a-8036-7eb54443e4de" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/e58843740796406d9c0c9ba32df13ee6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">一个简化的标准设备：</span></span></p></div><div id="https://www.notion.so/b519853532874b6abb9b475f2450914d" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F9529668f-b482-4c4d-a63c-bbf05a18e346%2FUntitled.png?width=418.0034484863281&amp;table=block&amp;id=b5198535-3287-4b6a-bb9b-475f2450914d"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F9529668f-b482-4c4d-a63c-bbf05a18e346%2FUntitled.png?width=418.0034484863281&amp;table=block&amp;id=b5198535-3287-4b6a-bb9b-475f2450914d" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/a034de940402443893f38f019b43ea72" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">一个（简化的）设备接口包含 3 个寄存器：一个状态（status）寄存器， 可以读取并查看设备的当前状态；一个命令（command）寄存器，用于通知设备执行某个具 体任务；一个数据（data）寄存器，将数据传给设备或从设备接收数据。通过读写这些寄存 器，操作系统可以控制设备的行为</span></span></p></div><div id="https://www.notion.so/0c1ecabb5d4546a1abb2fc97ea48a53b" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fbbfd551e-12c3-47a6-bc9b-469228200751%2FUntitled.png?width=418.0034484863281&amp;table=block&amp;id=0c1ecabb-5d45-46a1-abb2-fc97ea48a53b"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fbbfd551e-12c3-47a6-bc9b-469228200751%2FUntitled.png?width=418.0034484863281&amp;table=block&amp;id=0c1ecabb-5d45-46a1-abb2-fc97ea48a53b" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/b2153d4f8dea4041b7ae81b41c85e0f5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">第 1 步，操作系统通过反复读取状态寄存器，等待设备进入可以接收命令的就绪状态。我们称之为轮询（polling）设备（基本上，就是问它正在做什么）。
第 2 步，操作系统下发数据到数据寄存器。例如，你可以想象如果这是一个磁盘，需要多次写入操作，将一个磁盘块（比如 4KB）传递给设备。如果主 CPU 参与数据移动（就像这个示例协议一样），我们就称之为编程的 I/O(programmed I/O，PIO)。
第 3 步，操作系统将命令写入命令寄存器；这样设备就知道数据已经准备好了，它应该开始执行命令。最后一步， 操作系统再次通过不断轮询设备，等待并判断设备是否执行完成命令（有可能得到一个指示成功或失败的错误码）</span></span></p></div><div id="https://www.notion.so/aecffdd859a7450f95af004825615cb6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">轮询简单但是浪费了cpu
中断有效利用了CPU但浪费了时间和算力
如果设备的速度未 知，或者时快时慢，可以考虑混合（hybrid）策略，先尝试轮询一小段时间，如果设备没 有完成操作，此时再使用中断。
→</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">DMA(Direct Memory Access)</mark></span><span class="SemanticString">可以协调完成内存和设备间的数据传递，不需要 CPU 介入。
通过了解“数据在内存中的位置，要复制多少数据”在内存中复制数据。完成后，DMA引发中断，I/O开始在磁盘上进行。</span></span></p></div><div id="https://www.notion.so/4df2f5c79b3e4922b5fcdb431b35f660" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fad7095e2-ee7a-45b2-820c-989a887724fd%2FUntitled.png?width=418.0034484863281&amp;table=block&amp;id=4df2f5c7-9b3e-4922-b5fc-db431b35f660"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fad7095e2-ee7a-45b2-820c-989a887724fd%2FUntitled.png?width=418.0034484863281&amp;table=block&amp;id=4df2f5c7-9b3e-4922-b5fc-db431b35f660" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/66f4a5ce8dab40a692c04318486dac64" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">设备交互：直接IO指令与内存映射指令</span></span></p></div><div id="https://www.notion.so/a4e03b3f79904f95944e3dbbc320dd3f" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fa3aea631-28d0-4a7b-85ba-fe0bbfc13880%2FUntitled.png?width=418.0034484863281&amp;table=block&amp;id=a4e03b3f-7990-4f95-944e-3dbbc320dd3f"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fa3aea631-28d0-4a7b-85ba-fe0bbfc13880%2FUntitled.png?width=418.0034484863281&amp;table=block&amp;id=a4e03b3f-7990-4f95-944e-3dbbc320dd3f" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/e126bb0d808343d7af46494b22ab28dc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">文件系统（包括在其之上的应用程序）完全不清楚它使用的是什么类型的磁盘。它只需要简单地向通用块设备层发送读写请求即可，块设备层会将这些请求发送给对应的设备驱动，然后设备驱动来完成真正的底层操作。</span></span></p></div><div id="https://www.notion.so/45836451d76a4e0f8e762154adc3d70a" class="Divider"></div><h2 id="https://www.notion.so/c3e3970736fd40488a9f4268b2ff37b9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/c3e3970736fd40488a9f4268b2ff37b9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">硬盘设备</span></span></h2><div id="https://www.notion.so/5eb9650c7e6941ee9d31138e6e2ca0ee" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">驱动器由大量</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">扇区</strong></span><span class="SemanticString">（512 字节块）组成，每个扇区都可以读取或写入。在具有 n 个扇区的磁盘 上，</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">扇区从 0 到 n−1 编号</strong></span><span class="SemanticString">。因此，我们可以</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">将磁盘视为一组扇区，0 到 n−1 是驱动器的地址空间</strong></span><span class="SemanticString">（address space）。
许多文件系统一次读取或写入 4KB（或更多数据）。但是， 在更新磁盘时，驱动器制造商唯一保证的是单个 512 字节的写入是原子的（atomic，即它将完整地完成或者根本不会完成）。</span></span></p></div><div id="https://www.notion.so/47a2fecae1734bdbb680847da960b143" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F4f0121b6-b49b-471e-a25c-c3b5f7b3cf14%2FUntitled.png?width=418.0034484863281&amp;table=block&amp;id=47a2feca-e173-4bdb-b680-847da960b143"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F4f0121b6-b49b-471e-a25c-c3b5f7b3cf14%2FUntitled.png?width=418.0034484863281&amp;table=block&amp;id=47a2feca-e173-4bdb-b680-847da960b143" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/3ae46c4fa0634511aa0efdea3679740d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">磁道的编号是按从内向外的顺序进行的，通常从0开始。</span></span></p></div><div id="https://www.notion.so/cf412e6e7fd8415bbfad95c656071ee3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">寻道时间与转速无关</span></span></p></div><div id="https://www.notion.so/8b0824ea91604b74bb3e610b121a34b0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在写入时，驱动器面临选择：回写（write back，在数据更新时只写入缓存Cache。只在数据被替换出缓存时，被修改的缓存数据才会被写到后端存储）和透写（write through，在数据更新时，同时写入缓存Cache和后端存储）。</span></span></p></div><div id="https://www.notion.so/16ab4ae3705f41729f60c4c95234e52c" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fa059db8a-da39-40f7-8845-c9c9763ba067%2FUntitled.png?width=418.0034484863281&amp;table=block&amp;id=16ab4ae3-705f-4172-9f60-c4c95234e52c"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fa059db8a-da39-40f7-8845-c9c9763ba067%2FUntitled.png?width=418.0034484863281&amp;table=block&amp;id=16ab4ae3-705f-4172-9f60-c4c95234e52c" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/d264f26424724b2092d749dfa51e13ec" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">寻道延迟</strong></mark></span><span class="SemanticString">+旋转延迟+传输延迟</span></span></p></div><h3 id="https://www.notion.so/b5aa8f92b22c4353ac02a84bbb5bdacf" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/b5aa8f92b22c4353ac02a84bbb5bdacf"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">两种工作负载</span></span></h3><div id="https://www.notion.so/51e00ccb0bf84846b052a78fe40e618f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">随机（random）工作负载</strong></span><span class="SemanticString">，它向磁盘上的随机位置发出小的（例如 4KB） 读取请求。随机工作负载在许多重要的应用程序中很常见，包括数据库管理系统。
</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">顺序（sequential）工作负载</strong></span><span class="SemanticString">，只是从磁盘连续读取大量的扇区，不会跳过。</span></span></p></div><div id="https://www.notion.so/e52c1923fae9410190169ab7d79f4165" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">IO计算</strong></em></span><span class="SemanticString">
随机工作负载:向磁盘上的随机位置发出4KB的读取，</span></span></p></div><div id="https://www.notion.so/e8889716b83d4f4aade42926d318f4f9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">顺序工作负载:从磁盘连续读取100MB（这里的4KB和100MB即下文的传输大小size）</span></span></p></div><div id="https://www.notion.so/ff42b596f3f94c278066c63cf4aaff2e" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F25d17ed0-1ba8-436c-a1f3-aabf0ddd312e%2FUntitled.png?width=596.015625&amp;table=block&amp;id=ff42b596-f3f9-4c27-8066-c63cf4aaff2e"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F25d17ed0-1ba8-436c-a1f3-aabf0ddd312e%2FUntitled.png?width=596.015625&amp;table=block&amp;id=ff42b596-f3f9-4c27-8066-c63cf4aaff2e" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/612dbbe46f2d4f698d32e69107bcc1f4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">对于随机工作负载在 Cheetah 上：</span></span></p></div><div id="https://www.notion.so/01b4686d029949d48ee7f1ee4f8e4830" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">平均寻道时间（4ms）就采用制造商报告的平均时间。请注意，完全寻道（从表面的一端到另一端）可能需要两到三倍的时间。
</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">平均旋转延迟直接根据 RPM 计算。15000 RPM 等于 250 RPS（每秒转速）。因此，每次旋转需要 4ms。平均而言，磁盘将会遇到半圈旋转，因此平均时间为 2ms。</mark></span><span class="SemanticString">
传输时间就是传输大小size除以峰值传输速率。4KB/125MB=32μs</span></span></p></div><div id="https://www.notion.so/9e672988e44042a4987183c29babedaa" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fefcacc87-554d-401c-890f-a5ccf8fd6ab6%2FUntitled.png?width=596.015625&amp;table=block&amp;id=9e672988-e440-42a4-9871-83c29babedaa"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fefcacc87-554d-401c-890f-a5ccf8fd6ab6%2FUntitled.png?width=596.015625&amp;table=block&amp;id=9e672988-e440-42a4-9871-83c29babedaa" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/671a64818a554e83bb166fffbb72f908" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我感觉计算结果有点小问题，但是思路看懂了</span></span></p></div><div id="https://www.notion.so/0505d28812854a89bbb666a11347c5a8" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ffc7327f0-b7d8-4832-822d-7da1f728bd2e%2FUntitled.png?width=596.015625&amp;table=block&amp;id=0505d288-1285-4a89-bbb6-66a11347c5a8"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ffc7327f0-b7d8-4832-822d-7da1f728bd2e%2FUntitled.png?width=596.015625&amp;table=block&amp;id=0505d288-1285-4a89-bbb6-66a11347c5a8" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h3 id="https://www.notion.so/5a4d4c91444846d48e09cd17e5dd4c07" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/5a4d4c91444846d48e09cd17e5dd4c07"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">加速磁盘访问</span></span></h3><div id="https://www.notion.so/6d22d1b1f9de47958872284708236ff3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">按柱面组织数据：</strong></span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">寻道时间占平均块访问时间的一半</span></span><span class="SemanticString">，如果我们选择在一个柱面上连续的读取所有块，那么我们只需要考虑一次寻道时间，而忽略其它时间。这样，从磁盘上读写数据的速度就接近于理论上的传输速率。
</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">使用多个磁盘：</strong></span><span class="SemanticString">如果我们使用多个磁盘来替代一个磁盘，只要磁盘控制器、总线和内存能以 n 倍速率处理数据传输，则使用 n 个磁盘的效果近似于 1 个磁盘执行了 n 次操作。因此使用多个磁盘可以提高系统的性能。
</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">磁盘调度：</strong></span><span class="SemanticString">提高磁盘系统吞吐率的另一个有效方法是让磁盘控制器在若干个请求中选择一个来首先执行。
</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">预取数据：</strong></span><span class="SemanticString">在一些应用中，我们是可以预测从磁盘请求块的顺序的。因此我们就可以在需要这些块之前就将它们装入主存。</span></span></p></div><h2 id="https://www.notion.so/d9d68e9a8abf48a9acf1ab772efeac8b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/d9d68e9a8abf48a9acf1ab772efeac8b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">磁盘调度</span></span></h2><div id="https://www.notion.so/ed8b51a7f1144af59b7d104a01ecc3bb" class="ColumnList"><div id="https://www.notion.so/3314c9c4cd5b461292919fac19b49b2f" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/793972bed990448482fdc3d6678f6480" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">先来先服务FCFS</span></span></p></div><div id="https://www.notion.so/ac5ae6625a1e41ef8857715e808c707d" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fb3343fdf-7d52-482a-a825-2123fc8cb523%2FUntitled.png?width=431&amp;table=block&amp;id=ac5ae662-5a1e-41ef-8857-715e808c707d"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fb3343fdf-7d52-482a-a825-2123fc8cb523%2FUntitled.png?width=431&amp;table=block&amp;id=ac5ae662-5a1e-41ef-8857-715e808c707d" style="width:431px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div><div id="https://www.notion.so/aaa281cc77d54f45856a18a233799a12" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/77164140deb74a22b363d0e7d6bb125e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">最短寻道时间优先SSTF
优先选择距当前磁头最近的访问请求</span></span></p></div><div id="https://www.notion.so/4631b300ad2a407384decbffe6ce46f8" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3641d1d3-c911-499d-ad17-2571c481b5a2%2FUntitled.png?width=509&amp;table=block&amp;id=4631b300-ad2a-4073-84de-cbffe6ce46f8"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3641d1d3-c911-499d-ad17-2571c481b5a2%2FUntitled.png?width=509&amp;table=block&amp;id=4631b300-ad2a-4073-84de-cbffe6ce46f8" style="width:509px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/ec7c1787a83c423390a67a0afb4fc6b3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">SCAN电梯调度（双向的电梯）
当</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">到达另一端时，磁头改变移动方向</strong></span></span></p></div><div id="https://www.notion.so/1d20490e03e446e3bd67374957a858d0" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3bb08331-a591-4aa0-a87c-247006d5ad4e%2FUntitled.png?width=478&amp;table=block&amp;id=1d20490e-03e4-46e3-bd67-374957a858d0"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3bb08331-a591-4aa0-a87c-247006d5ad4e%2FUntitled.png?width=478&amp;table=block&amp;id=1d20490e-03e4-46e3-bd67-374957a858d0" style="width:478px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/79b60ec0a15447c3b532aba5e5c508d8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">LOOK：磁头只移动到一个方向上最远的请求为止。接着，它马上回头，而不是继续到磁盘的尽头。</span></span></p></div><div id="https://www.notion.so/87988ffa1ad043089a06d4b1df3e3daa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在这里就是scan但是不到0，14之后直接去65</span></span></p></div><div id="https://www.notion.so/21c09f37b842441a8270a762e203d5e7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">C-SCAN(单向/循环扫描算法）</span></span></p></div><div id="https://www.notion.so/f7512a5a05dc40e4a7cf4add7b37be25" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当磁头到达磁盘的一端，并反向运动时落在磁头之后的访问请求相对较少。这是由于这些磁道刚被处理，而磁盘另一端的请求密度相当高，且这些访问请求等待的时间较长。</span></span></p></div><div id="https://www.notion.so/5cb130fb9825487989768fe17ca871c5" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fac886c1b-1307-4b9b-beb8-289c0486520e%2FUntitled.png?width=472.96875&amp;table=block&amp;id=5cb130fb-9825-4879-8976-8fe17ca871c5"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fac886c1b-1307-4b9b-beb8-289c0486520e%2FUntitled.png?width=472.96875&amp;table=block&amp;id=5cb130fb-9825-4879-8976-8fe17ca871c5" style="width:472.96875px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/d0ae282446fe416889e5cedc04f3a718" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">C-LOOK：磁头只移动到一个方向上</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">最远的请求为止</strong></mark></span><span class="SemanticString">。接着，它马上回头，而不是继续到磁盘的尽头。</span></span></p></div><div id="https://www.notion.so/92a4b1f38e1e4ae186a575a9b8fa7dac" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F2da4bf22-44c6-4279-a894-ee020ce26d77%2FUntitled.png?width=478.99737548828125&amp;table=block&amp;id=92a4b1f3-8e1e-4ae1-86a5-75a9b8fa7dac"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F2da4bf22-44c6-4279-a894-ee020ce26d77%2FUntitled.png?width=478.99737548828125&amp;table=block&amp;id=92a4b1f3-8e1e-4ae1-86a5-75a9b8fa7dac" style="width:478.99737548828125px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/388054f4d7774d88bc1c0b3a77cde4f2" class="Divider"></div><h2 id="https://www.notion.so/cdc448590ade4cae86a083cf3a139646" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/cdc448590ade4cae86a083cf3a139646"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">大容量存储结构RAID（廉价磁盘冗余阵列）</span></span></h2><div id="https://www.notion.so/7f06a0e8728e4cb79381f97cb0806e9d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">同时使用多个磁盘来构建更快、更大、更可靠的磁盘系统。
对于主机系统来说，RAID就像一个大磁盘（RAID提供接口）</span></span></p></div><div id="https://www.notion.so/07932c53a5ee4c5eb3a8e67e458db778" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">性能和容量:并行使用多个磁盘
可靠性:RAID可以容忍一个磁盘的丢失。</span></span></p></div><div id="https://www.notion.so/90641438fb224095a72cab7eb5974d79" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">RAID内部包括：
一个微控制器，运行固件以指导 RAID 的操作。
包括 DRAM 这样的易失性存储器，在读取和写入时缓冲数据块。
在某些情况下，还包括非易失性存储器，安全地缓冲写入可能包含专用的逻辑电路，来执行奇偶校验计算。</span></span></p></div><div id="https://www.notion.so/123905391ad64c6eb7784286c0543392" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">RAID性能分析：</span></span></p></div><div id="https://www.notion.so/4969824d2b8d4f6d844c2ea23dcbd503" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">假设磁盘可以</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">在连续工作负载下以 S MB/s 传输数据，并且在随机工作负载下以 R MB/s 传输数据</strong></span><span class="SemanticString">。一般来说，S 比 R 大得多。
平均大小为 10MB 的连续传输，平均为 10KB 的随机传输
平均寻道时间 7ms ，平均旋转延迟 3ms ，磁盘传输速率 50MB/s</span></span></p></div><div id="https://www.notion.so/0a7fca66302e4094bae95f9e17e8145c" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fbcb24757-ca88-4985-899c-d8960f10f614%2FUntitled.png?width=650&amp;table=block&amp;id=0a7fca66-302e-4094-bae9-5f9e17e8145c"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fbcb24757-ca88-4985-899c-d8960f10f614%2FUntitled.png?width=650&amp;table=block&amp;id=0a7fca66-302e-4094-bae9-5f9e17e8145c" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h3 id="https://www.notion.so/7bc2fe5e2f8549bb9abffd0ba2b95bc6" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/7bc2fe5e2f8549bb9abffd0ba2b95bc6"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">RAID 0 级（条带化）</span></span></h3><div id="https://www.notion.so/132a72d57c5a45968dc96c499eb62aa0" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8334ab44-bd89-43d9-9a21-1200a1be8de3%2FUntitled.png?width=669&amp;table=block&amp;id=132a72d5-7c5a-4596-8dc9-6c499eb62aa0"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8334ab44-bd89-43d9-9a21-1200a1be8de3%2FUntitled.png?width=669&amp;table=block&amp;id=132a72d5-7c5a-4596-8dc9-6c499eb62aa0" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/d4e8f1ba46374118810d131b5e0d7a75" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">可以选择大块大小，在一个磁盘上方n个块，然后再移动到下一个磁盘</span></span></p></div><div id="https://www.notion.so/c2ec324ec89e426a9da5282bd561490d" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F34c24e25-49f8-48bb-8a8e-8cb06891356a%2FUntitled.png?width=475&amp;table=block&amp;id=c2ec324e-c89e-426a-9da5-282bd561490d"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F34c24e25-49f8-48bb-8a8e-8cb06891356a%2FUntitled.png?width=475&amp;table=block&amp;id=c2ec324e-c89e-426a-9da5-282bd561490d" style="width:475px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/c7b6214420c4414b9e63c3e71060b0b3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">较小的大块</strong></span><span class="SemanticString">意味着许多文件将跨多个磁盘进行条带化，增</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">加了对单个文件的读取和写入的并行性。但是，跨多个磁盘访问块的定位时间会增加</span></span><span class="SemanticString">，因为整个请求的定位时间由所有驱动器上请求的最大定位时间决定
</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">较大的大块</strong></span><span class="SemanticString">大小</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">减少了这种文件内的并行性</span></span><span class="SemanticString">，因此依靠多个并发请求来实现高吞吐量。但是，较大的大块大小</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">减少了定位时间</span></span><span class="SemanticString">
</span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">性能分析：</strong></em></span></span></p></div><div id="https://www.notion.so/a6bcf1c17b634b2490d29918f24eae4d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">容量：完美。
·分条可提供相当于</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">N</code></span><span class="SemanticString">个磁盘的可用容量。
条带化：性能优异。
·所有磁盘通常是并行使用的。
可靠性：差。
·任何硬盘故障都会导致数据丢失。</span></span></p></div><div id="https://www.notion.so/6d5a7f280ff44c5bb1f325931a4f86f6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">稳态吞吐量：吞吐量等于N乘以S(</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">N·SMB/S</code></span><span class="SemanticString">)。对于大量的随机l/ O，我们可以再次使用所有磁盘，从而获得</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">N·RMB/s</code></span></span></p></div><h3 id="https://www.notion.so/e2eb8abc1c7342b9b06fd71a1918dc58" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/e2eb8abc1c7342b9b06fd71a1918dc58"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">RAID 1 级（镜像）</span></span></h3><div id="https://www.notion.so/d863b7b50acd41889808d45606b2f258" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F4e6b2667-ba19-401e-9383-d5989620115b%2FUntitled.png?width=596.015625&amp;table=block&amp;id=d863b7b5-0acd-4188-9808-d45606b2f258"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F4e6b2667-ba19-401e-9383-d5989620115b%2FUntitled.png?width=596.015625&amp;table=block&amp;id=d863b7b5-0acd-4188-9808-d45606b2f258" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/756dfdc54b864b39bddcc582a18dda75" class="ColumnList"><div id="https://www.notion.so/401ca124d3e84ca58758b54c41cab402" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/ece62d41adb84befb858348f35311643" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3a5bebff-801f-4b73-9c80-144cc63290d4%2FUntitled.png?width=666&amp;table=block&amp;id=ece62d41-adb8-4bef-b858-348f35311643"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3a5bebff-801f-4b73-9c80-144cc63290d4%2FUntitled.png?width=666&amp;table=block&amp;id=ece62d41-adb8-4bef-b858-348f35311643" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div><div id="https://www.notion.so/71b84def8c1248fe8b780c689441fb7d" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/68797fe9b7f6425c8e45ea6330991503" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff2009c02-c6af-45e0-8cb6-e0864501a18b%2FUntitled.png?width=669&amp;table=block&amp;id=68797fe9-b7f6-425c-8e45-ea6330991503"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff2009c02-c6af-45e0-8cb6-e0864501a18b%2FUntitled.png?width=669&amp;table=block&amp;id=68797fe9-b7f6-425c-8e45-ea6330991503" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/b440a9428af64ff3b2b0fde9c5e92b35" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">对于 N 个磁盘，镜像的有用</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">容量为 N/2</code></span><span class="SemanticString">。</span></span></p></div><div id="https://www.notion.so/42c2609c79d64d9e8018cf925dc5c3ef" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">读取块时，RAID 有一个选择：它可以读取任一副本。
写入块时，RAID 必须更新两个副本的数据，以保持</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">可靠</code></span><span class="SemanticString">性。</span></span></p></div><div id="https://www.notion.so/70bea8fa95ed4d24a51aad246ccb65c2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">顺序读取</strong></span><span class="SemanticString">时：</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">(N/2) · S MB/s</code></span></span></p></div><div id="https://www.notion.so/b255daf4b4814014a90212aed31b8f36" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F5a991b52-4080-479b-b194-a15ba3801832%2FUntitled.png?width=724&amp;table=block&amp;id=b255daf4-b481-4014-a902-12aed31b8f36"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F5a991b52-4080-479b-b194-a15ba3801832%2FUntitled.png?width=724&amp;table=block&amp;id=b255daf4-b481-4014-a902-12aed31b8f36" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/061f2c516aa04d19b9b51f43d2d0385b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">顺序写入</strong></span><span class="SemanticString">时，每个逻辑写入必定导致两个物理写入，镜像阵列期间</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">读</strong></span><span class="SemanticString">获得的最大带宽是</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"> (N/2) · S MB/s</code></span><span class="SemanticString"> ，即峰值带宽的一半。也就是说连续写入时，无法并行。</span></span></p></div><div id="https://www.notion.so/7ac42013ed394f4b98e08b37390083c4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">随机读取</strong></span><span class="SemanticString">是镜像 RAID 的最佳案例。在这种情况下，我们</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">可以在所有磁盘上分配读取数据</span></span><span class="SemanticString">，从而获得完整的可用带宽。因此，对于随机读取，RAID-1 提供</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"> N·R MB/s</code></span><span class="SemanticString">。
</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">随机写入时，</strong></span><span class="SemanticString">每个逻辑写入必须变成两个物理写入，因此在所有磁盘都将被使用的情况下，客户只会看到可用带宽的一半，因此随机写入的性能: </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">(N/2) ·R MB/s</code></span><span class="SemanticString">.</span></span></p></div><h3 id="https://www.notion.so/4346ee2a1fcf422c963ae3acaa8733ec" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/4346ee2a1fcf422c963ae3acaa8733ec"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"> RAID 4级（基于奇偶校验的冗余）</span></span></h3><div id="https://www.notion.so/626878019a314a0c9fc6a09647ed0171" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">异或，奇数的1时，结果为1；在数据块的每一位上执行按位 XOR。</span></span></p></div><div id="https://www.notion.so/bfad35f8845e42078a00352745c84758" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fe802a563-42cb-4f19-a9c8-3c6cc8efe479%2FUntitled.png?width=442&amp;table=block&amp;id=bfad35f8-845e-4207-8a00-352745c84758"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fe802a563-42cb-4f19-a9c8-3c6cc8efe479%2FUntitled.png?width=442&amp;table=block&amp;id=bfad35f8-845e-4207-8a00-352745c84758" style="width:442px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/590ec48572e640fda108233800827a09" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fb84b844f-181e-40e5-91a6-919f9d2be915%2FUntitled.png?width=583.9973754882812&amp;table=block&amp;id=590ec485-72e6-40fd-a108-233800827a09"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fb84b844f-181e-40e5-91a6-919f9d2be915%2FUntitled.png?width=583.9973754882812&amp;table=block&amp;id=590ec485-72e6-40fd-a108-233800827a09" style="width:583.9973754882812px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/89412bd2ba1448a3872ba98d37faba48" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">容量：Disk n专门方校验码，所以容量为</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">N-1</code></span></span></p></div><div id="https://www.notion.so/a8fdfe00ce374eb2b48b5745877c3838" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">可靠性：RAID-4</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">只允许出现一个磁盘故障</span></span><span class="SemanticString">。如果不止一个磁盘丢失，没有办法重建丢失的数据。</span></span></p></div><div id="https://www.notion.so/7c4c0590d92d47b8a5e782e9f48cfbae" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">连续读取：</strong></span><span class="SemanticString">可以利用除奇偶校验磁盘以外的所有磁盘，因此可提供</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">（N−1）·S MB/s</code></span></span></p></div><div id="https://www.notion.so/bccae53fad0345589a4cbf21ac460abf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">顺序写入：</strong></span><span class="SemanticString">将</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">大块数据</mark></span><span class="SemanticString">写入磁盘时，RAID-4 可执行简单优化，称为</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">全条带写入（full-stripe write）：大块数据</mark></span><span class="SemanticString">写入磁盘时</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">（N−1）·S MB/s</code></span></span></p></div><div id="https://www.notion.so/63641686532844bd904f079de82d7f6a" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1df66156-3f32-42b2-b40b-cb7fd0f3092d%2FUntitled.png?width=635&amp;table=block&amp;id=63641686-5328-44bd-904f-079de82d7f6a"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1df66156-3f32-42b2-b40b-cb7fd0f3092d%2FUntitled.png?width=635&amp;table=block&amp;id=63641686-5328-44bd-904f-079de82d7f6a" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/62fb8c4d62664c10ad46e4069195b728" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">随机读取：</strong></span><span class="SemanticString">一组 1 块的随机读取将分布在系统的数据磁盘上，而不是奇偶校验磁盘上。因此，有效性能是：</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">（N−1）·R MB/s</code></span><span class="SemanticString">。</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">
随机写入，在写入数据的同时必须更新奇偶校验值
</strong></span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">第一种称为加法奇偶校验（additive parity）</strong></em></span></span></p></div><div id="https://www.notion.so/acfdfd3ba4694e06b85607ce24d13af3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">为了计算新奇偶校验块的值，并行读取条带中所有其他数据块并与新块（刚写入的）进行异或。结果是新的校验块。以将新数据和新奇偶校验写入其各自的磁盘，也是并行写入。
在较大的 RAID 中，需要大量的读取来计算奇偶校验。</span></span></p></div><div id="https://www.notion.so/666bb443bdb74dd8b9c73542ccbfc0dc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">第二种减法奇偶校验（subtractive parity）方法</strong></em></span></span></p></div><div id="https://www.notion.so/c6b14c864d454797a38d3ae97bff84f3" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fbfa9948f-8b93-464e-902d-9b699830c1c6%2FUntitled.png?width=596.015625&amp;table=block&amp;id=c6b14c86-4d45-4797-a38d-3ae97bff84f3"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fbfa9948f-8b93-464e-902d-9b699830c1c6%2FUntitled.png?width=596.015625&amp;table=block&amp;id=c6b14c86-4d45-4797-a38d-3ae97bff84f3" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/2de9907d08e34754a968133e060a57a8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">使用减法方法。对于每次写入，RAID 必须执行 4 次 物理 I/O（两次读取和两次写入）。
读旧值和旧校验值，写入新值与新校验值
在一个随机写的时候，数据盘和校验盘可以并行读和写，先读再写，所以是</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">R/2</code></span></span></p></div><div id="https://www.notion.so/66d21814b9464593839fe5e63b16b54b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">对与小写入时，奇偶校验成为瓶颈</span></span></p></div><div id="https://www.notion.so/a5740af896d84ec0bdd9105acab71094" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3b3dcf94-4e35-4193-bd75-975214e86c22%2FUntitled.png?width=440&amp;table=block&amp;id=a5740af8-96d8-4ec0-bdd9-105acab71094"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3b3dcf94-4e35-4193-bd75-975214e86c22%2FUntitled.png?width=440&amp;table=block&amp;id=a5740af8-96d8-4ec0-bdd9-105acab71094" style="width:440px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/fde245fb370f4b069ec2dca6cd461b09" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在这个图中要更新4和13，可以对disk0和disk1进行并行访问，但是不能对disk4进行并行访问
</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">问题在于：可以并行访问数据磁盘，奇偶校验磁盘也不会实现任何并行</mark></span></span></p></div><div id="https://www.notion.so/7e8f58e095444982acabb71449df3a55" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">RAID-4 中的 I/O 延迟</strong></span></span></p></div><div id="https://www.notion.so/7b090eeed0344922804f27033863efbc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">单次读取</strong></span><span class="SemanticString">（假设没有失败）只映射到单个磁盘，因此其</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">延迟等同于单个磁盘请求的延迟。</span></span><span class="SemanticString">
</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">单次写入：</strong></span><span class="SemanticString">需要两次读取， 然后两次写入,读操作可以并行进行，写操作也是如此→</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">总延迟大约是单个磁盘的两倍。</span></span><span class="SemanticString">（有一些差异，因为我们必须等待两个读取操作完成，所以会得到最差的定位时间，但是之后，更新不会导致寻道成本，因此可能是比平均水平更好的定位成本。）</span></span></p></div><h3 id="https://www.notion.so/b9847bf1aa78427fabe3ff01d0a87e25" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/b9847bf1aa78427fabe3ff01d0a87e25"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">RAID 5级（基于旋转奇偶校验的冗余）</span></span></h3><div id="https://www.notion.so/ddcfbf26a191406b872bc1156840ef06" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在4的基础上，块驱动器旋转奇偶校验块：消除了奇偶校验瓶颈</span></span></p></div><div id="https://www.notion.so/945e5fae743c4f2299fe1332959aaee4" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8daf16e8-8676-4fc2-9b4f-f1910b9771da%2FUntitled.png?width=392&amp;table=block&amp;id=945e5fae-743c-4f22-99fe-1332959aaee4"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8daf16e8-8676-4fc2-9b4f-f1910b9771da%2FUntitled.png?width=392&amp;table=block&amp;id=945e5fae-743c-4f22-99fe-1332959aaee4" style="width:392px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/1595abe85a4c49c9b7f9759b6455deda" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">容量依旧是</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">N-1</code></span><span class="SemanticString">，但是</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">只允许一个磁盘出错</code></span></span></p></div><div id="https://www.notion.so/f7b3c50d0876435da174b703a078ed95" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">对于</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">顺序读写</strong></span><span class="SemanticString">：</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">（N-1)*S</code></span><span class="SemanticString">  和Raid4一致
</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">随机读取</strong></span><span class="SemanticString">：比4要好一点，可以利用所有磁盘：</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">N*R</code></span></span></p></div><div id="https://www.notion.so/7d424ac954724651b8a531d58630ba3f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">随机写入：  </strong></span><span class="SemanticString">RAID-4 的随机写入性 能明显提高。想象一下写入块 1 和写入块 10，这将变成对磁盘 1 和磁盘 4（对于块 1 及其奇偶校验）的请求以及对磁盘 0 和磁盘 2（对于块 10 及 其奇偶校验）的请求。因此，它们可以并行进行。事实上，我们通常可以假设，</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">如果有大量的随机请求，我们将能够保持所有磁盘均匀忙碌。</span></span><span class="SemanticString">如果是这样的话，那么我们</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">用于小写入的总带宽</span></span><span class="SemanticString">将是 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">N/4 *R</code></span><span class="SemanticString"> MB/s。</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">4 倍损失是由于每个 RAID-5 写入仍然产生总计4个 I/O 操作</span></span></span></p></div><h3 id="https://www.notion.so/47f1bdb0f1f0472aa730d33e5ffff9e7" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/47f1bdb0f1f0472aa730d33e5ffff9e7"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">总结</span></span></h3><div id="https://www.notion.so/6bfb9f1925004bd291553ed422f11cd8" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F521681a8-bf41-4bed-8b38-374486c2e4e6%2FUntitled.png?width=702&amp;table=block&amp;id=6bfb9f19-2500-4bd2-9155-3ed422f11cd8"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F521681a8-bf41-4bed-8b38-374486c2e4e6%2FUntitled.png?width=702&amp;table=block&amp;id=6bfb9f19-2500-4bd2-9155-3ed422f11cd8" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/1065f29e91a7406ea93fea34475fa34c" class="Divider"></div><h2 id="https://www.notion.so/5f5438f30e2e435580b7735dfdbac5d0" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/5f5438f30e2e435580b7735dfdbac5d0"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">文件系统</span></span></h2><div id="https://www.notion.so/d49e531102834f63909fbbc29639810e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">存储虚拟化中的两个关键抽象</span></span></p></div><div id="https://www.notion.so/b5bd0b2603704d3784d1baa53ab1ac7a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">File:文件就是一个线性字节数组，每个字节都可以读取或写入
．每个文件都有低级名称作为inode号
．用户不知道这个名称。
Directory:目录通常是一个列表，列表中每个条目(用户可读名字，inode)，每个条目是一个文件或其他目录的入口，例如目录有一个条目(“foo”, “10”)</span></span></p></div><h3 id="https://www.notion.so/d4337d1710794a5bb72d9e963706656d" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/d4337d1710794a5bb72d9e963706656d"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">文件系统接口</span></span></h3><div id="https://www.notion.so/7e4d676c92074244885697cfc8d485c8" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fbffa5e00-a339-406f-b3bd-38559cc5f910%2FUntitled.png?width=660&amp;table=block&amp;id=7e4d676c-9207-4244-8856-97cfc8d485c8"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fbffa5e00-a339-406f-b3bd-38559cc5f910%2FUntitled.png?width=660&amp;table=block&amp;id=7e4d676c-9207-4244-8856-97cfc8d485c8" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/2862de42e7f9479987a7ea48c5ab46e7" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F16952f1f-fdf1-4e77-bbf3-929c53510a7c%2FUntitled.png?width=646&amp;table=block&amp;id=2862de42-e7f9-4799-87a7-ea48c5ab46e7"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F16952f1f-fdf1-4e77-bbf3-929c53510a7c%2FUntitled.png?width=646&amp;table=block&amp;id=2862de42-e7f9-4799-87a7-ea48c5ab46e7" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/d76dfc66ed174c3e944b076bf3bfba86" class="ColumnList"><div id="https://www.notion.so/f59b64be3caa4233bbd6fd8f3e0d5729" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/1f472accd75f4ba59930670b02023aad" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fe633f6a8-dfce-4364-b47c-084719d0eaef%2FUntitled.png?width=596.015625&amp;table=block&amp;id=1f472acc-d75f-4ba5-9930-670b02023aad"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fe633f6a8-dfce-4364-b47c-084719d0eaef%2FUntitled.png?width=596.015625&amp;table=block&amp;id=1f472acc-d75f-4ba5-9930-670b02023aad" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div><div id="https://www.notion.so/22cbf6447bf64468b7937d9f45e58274" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/44e7b38d946f4a7da48329f7027dce44" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F86d14f01-95c8-426d-a82c-fed371d360d0%2FUntitled.png?width=657&amp;table=block&amp;id=44e7b38d-946f-4a7d-a483-29f7027dce44"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F86d14f01-95c8-426d-a82c-fed371d360d0%2FUntitled.png?width=657&amp;table=block&amp;id=44e7b38d-946f-4a7d-a483-29f7027dce44" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/6cebf67d05e64cf8a2547c8bebe271ed" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">fsync()以确保立即强制写入磁盘</span></span></p></div><div id="https://www.notion.so/892ea6399b78455793464f89ec7aff4e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">重命名</span></span></p></div><div id="https://www.notion.so/820dc1c1fbaf4354af94b39d7c89e515" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fc2ec8ee4-9613-4249-acd8-f7cd5c3a6292%2FUntitled.png?width=665&amp;table=block&amp;id=820dc1c1-fbaf-4354-af94-b39d7c89e515"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fc2ec8ee4-9613-4249-acd8-f7cd5c3a6292%2FUntitled.png?width=665&amp;table=block&amp;id=820dc1c1-fbaf-4354-af94-b39d7c89e515" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/79c9d0fc95f545c4bd3ec0d33e3312fa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">stat fstat用于显示元数据</span></span></p></div><div id="https://www.notion.so/74bd1603e6b944a28b67c4d08f4c1f92" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">rm调用</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">unlink()</code></span><span class="SemanticString">进行文件删除</span></span></p></div><div id="https://www.notion.so/13c40c1600e248cb9b6cda1f0b33fb7f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">mkdir()：创建目录</strong></span></span></p></div><div id="https://www.notion.so/68b41f7d70e941989b2ac66d52ef4efd" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fbac9849b-9455-4a0b-98fa-0f99c58aebba%2FUntitled.png?width=596.015625&amp;table=block&amp;id=68b41f7d-70e9-4198-9b2a-c66d52ef4efd"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fbac9849b-9455-4a0b-98fa-0f99c58aebba%2FUntitled.png?width=596.015625&amp;table=block&amp;id=68b41f7d-70e9-4198-9b2a-c66d52ef4efd" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/1f781d52b08644a1a217429fa3c290f9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">rmdir()：删除目录，只允许用来删除空目录，安全</strong></span></span></p></div><h3 id="https://www.notion.so/68425079eb9b40d5ba531171ba71fc4e" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/68425079eb9b40d5ba531171ba71fc4e"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">硬链接</span></span></h3><div id="https://www.notion.so/67d4e54b33c9494490cd4c54deba87ca" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">link(old pathname, new one)</strong></span></span></p></div><div id="https://www.notion.so/80949a8d2c6d41ed94790f90575c36b0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">将新文件名链接到旧文件名
创建另一种方式来引用同一个文件。
命令行链接程序:ln</span></span></p></div><div id="https://www.notion.so/b3c7573f9f8c4f379641936f8647cd03" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在创建文件的硬链接之后，在文件系统中，原有文件名（file）和新创建的文件名（file2） 之间没有区别。实际上，它们都只是指向文件底层元数据的链接</span></span></p></div><div id="https://www.notion.so/5c055df60142478b8c4271f4d5271c3c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当文件系统取消链接文件时，它检查 inode 号中的引用计数（reference count）。该引用计数（有时称为链接计数，link count）允许文件系统跟踪有多少不同的文件 名已链接到这个 inode。</span></span></p></div><div id="https://www.notion.so/6303f8efbf204e15844637db287db8e1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">调用 unlink()时，会删除可读的名称（正在删除的文件）与给定 inode 号之间的“链接”，并减少引用计数。只有当引用计数达到零时，文件系统才会释放 inode 和相关数据块，从而真正“删除”该文件。</span></span></p></div><h3 id="https://www.notion.so/6b9f4fdcf61c41caa61ab9e5044a4c97" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/6b9f4fdcf61c41caa61ab9e5044a4c97"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">符号（软）链接</span></span></h3><div id="https://www.notion.so/7b24502a16554d28801a352ad24fc8fc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">·符号链接比硬链接更有用。
</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">·硬链接无法创建目录(为了防止出现环)
·硬链接不能创建文件到其他分区。
</span></span><span class="SemanticString">因为</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">inode号只在一个文件系统内是唯一</strong></span><span class="SemanticString">的。</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">ln -s filename</strong></code></span></span></p></div><div id="https://www.notion.so/091dce9898a64dd4b7a68be828f084e6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">符号链 接本身实际上是一个不同类型的文件。(软链接文件类似于Windows的快捷方式)</strong></span></span></p></div><div id="https://www.notion.so/fa42629068a3492998910ba6e2fdc260" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在软连接中，文件实际上是一个文本文件，其中</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">包含的有另一文件的位置信息</span></span></span></p></div><div id="https://www.notion.so/f92f6231084942d4ad3c1f86a51c9864" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">符号链接保存</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">被链接文件的路径名</mark></span><span class="SemanticString">作为链接文件的数据。</span></span></p></div><div id="https://www.notion.so/864ad1e5870e456194972e12464c0085" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">悬空引用（</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Dangling reference</strong></span><span class="SemanticString">）：删除原始文件后，符号链接指向不存在的路径名</span></span></p></div><h3 id="https://www.notion.so/03e428a9f844462897472eb1f9aad6c2" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/03e428a9f844462897472eb1f9aad6c2"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">创建和挂载文件系统</span></span></h3><div id="https://www.notion.so/35d97c010b744bb38ced0307dfbca76f" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fe8af7c0a-1e23-42f6-8803-8d849438ef08%2FUntitled.png?width=513&amp;table=block&amp;id=35d97c01-0b74-4bb3-8ced-0307dfbca76f"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fe8af7c0a-1e23-42f6-8803-8d849438ef08%2FUntitled.png?width=513&amp;table=block&amp;id=35d97c01-0b74-4bb3-8ced-0307dfbca76f" style="width:513px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/73cc5fd5ad9141c3bdbd76c9c3339c71" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">没看懂</span></span></p></div><div id="https://www.notion.so/66f11d5f2e414f8c9d9c3e470d884ff6" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F0d2c925a-6e2c-442c-9e51-5371ad8ab54b%2FUntitled.png?width=637&amp;table=block&amp;id=66f11d5f-2e41-4f8c-9d9c-3e470d884ff6"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F0d2c925a-6e2c-442c-9e51-5371ad8ab54b%2FUntitled.png?width=637&amp;table=block&amp;id=66f11d5f-2e41-4f8c-9d9c-3e470d884ff6" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/bcf6a4b6429f44e4a78174673339cbf5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">运行mount</span></span></p></div><div id="https://www.notion.so/b97899d689824e709bbe04b3786a73d6" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Feaa95c56-b5b9-41b9-b360-083e3ac398bd%2FUntitled.png?width=528&amp;table=block&amp;id=b97899d6-8982-4e70-9bbe-04b3786a73d6"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Feaa95c56-b5b9-41b9-b360-083e3ac398bd%2FUntitled.png?width=528&amp;table=block&amp;id=b97899d6-8982-4e70-9bbe-04b3786a73d6" style="width:528px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h2 id="https://www.notion.so/9f661d2c97374a0dbf66adc61cbca543" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/9f661d2c97374a0dbf66adc61cbca543"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">实现文件系统（</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">纯软件）</strong></span></span></h2><h3 id="https://www.notion.so/9abd6e82f1c7496097fbcfd3f810dcae" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/9abd6e82f1c7496097fbcfd3f810dcae"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">文件物理结构</strong></span></span></h3><div id="https://www.notion.so/bdb24c273bdd4a6d9ffb7f39bcd5a7d3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">连续分配</strong></em></span></span></p></div><div id="https://www.notion.so/b5962cf85b25428081972f9924ebf857" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F13b0b77a-380c-4828-9d29-e114bb56132d%2FUntitled.png?width=625&amp;table=block&amp;id=b5962cf8-5b25-4280-8197-2f9924ebf857"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F13b0b77a-380c-4828-9d29-e114bb56132d%2FUntitled.png?width=625&amp;table=block&amp;id=b5962cf8-5b25-4280-8197-2f9924ebf857" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/6b3f05d23e5143ce93be6b22d73153c5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">存在的问题</span></span></p></div><div id="https://www.notion.so/ea0312be7d06444c9f032b83ef2efec6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">为新文件找空间比较困难（类似于内存分配中的连续内存分配方式）；文件很难增长</span></span></span></p></div><div id="https://www.notion.so/bf45c8c2e4f2424fb8c2cf31b573bc5c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">基于扩展的连续分配</strong></span></span></p></div><div id="https://www.notion.so/171afdd45598413a8250358d703ce42f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">该方法开始分配一块连续空间，当空间不够时，另一块被称为扩展的连续空间会添加到原来的分配中。文件块的位置就成为</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">开始地址、块数、加上一个指向下一扩展的指针</mark></span><span class="SemanticString">。</span></span></p></div><div id="https://www.notion.so/e72d20744d354f2094c3994c1697d39c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">链接分配</strong></em></span></span></p></div><div id="https://www.notion.so/f0f3862307574abfa918d76cdb7b8066" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F0db07e79-a27f-404f-a1d7-315d29ed1ecf%2FUntitled.png?width=604&amp;table=block&amp;id=f0f38623-0757-4abf-a918-d76cdb7b8066"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F0db07e79-a27f-404f-a1d7-315d29ed1ecf%2FUntitled.png?width=604&amp;table=block&amp;id=f0f38623-0757-4abf-a918-d76cdb7b8066" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/0bb594dc4252429cad64056c4dc50315" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">优点：</span></span></p></div><div id="https://www.notion.so/88d83a84c5dc4ca8855f2eae4627fde7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">.简单 － 只需起始位置</span></span></p></div><div id="https://www.notion.so/1ecaadf516f34766b166e6bba159f296" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">.文件创建与增长容易</span></span></p></div><div id="https://www.notion.so/036cad076c5f4e4dacec27ac8d1c90a0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">缺点：</span></span></p></div><div id="https://www.notion.so/f46fdfbf0a814174988381b9d7b118ba" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">.不能随机访问</span></span></p></div><div id="https://www.notion.so/e4da5b9176eb4597992f1de0420da177" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">.块与块之间的链接指针需要占用空间(簇：将多个连续块组成簇，磁盘以簇为单位进行分配)</span></span></p></div><div id="https://www.notion.so/9f59b9a92ad04fb29aa97aa16d4e3a8c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">.存在可靠性问题</span></span></p></div><div id="https://www.notion.so/665c9b40d4f94c4e8c0ef5eaed9fa8b8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">把FAT提前放到内存里</span></span></span></p></div><div id="https://www.notion.so/eb42fc725d4d439eada0553f4e9d1054" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff4d9a4a7-840e-4ae3-9eb1-95846e9c14c1%2FUntitled.png?width=596.015625&amp;table=block&amp;id=eb42fc72-5d4d-439e-ada0-553f4e9d1054"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff4d9a4a7-840e-4ae3-9eb1-95846e9c14c1%2FUntitled.png?width=596.015625&amp;table=block&amp;id=eb42fc72-5d4d-439e-ada0-553f4e9d1054" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/77665367e385456d865480fc4d7d0431" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fb5db9e8a-1921-469e-9c48-caf0a16977fe%2FUntitled.png?width=596.015625&amp;table=block&amp;id=77665367-e385-456d-8654-80fc4d7d0431"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fb5db9e8a-1921-469e-9c48-caf0a16977fe%2FUntitled.png?width=596.015625&amp;table=block&amp;id=77665367-e385-456d-8654-80fc4d7d0431" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/d221d17f2aed409989c638ecda7429c5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"> </strong></span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">索引分配</strong></em></span></span></p></div><div id="https://www.notion.so/5d9ae5d26ff543e5904bbfb4d73058c4" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3cf6dd72-3e97-416a-a87b-115da13f86d0%2FUntitled.png?width=621&amp;table=block&amp;id=5d9ae5d2-6ff5-43e5-904b-bfb4d73058c4"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3cf6dd72-3e97-416a-a87b-115da13f86d0%2FUntitled.png?width=621&amp;table=block&amp;id=5d9ae5d2-6ff5-43e5-904b-bfb4d73058c4" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/3c0da905fd734a189cf506c3206e3598" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">优点:
·保持了链接结构的优点，又解决了其缺点:
.即能顺序存取，又能随机存取
·</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">满足了文件动态增长、插入删除</span></span><span class="SemanticString">的要求
·能充分利用外存空间,无外部碎片
缺点:
索引表本身带来了系统开销
·如:内外存空间，存取时间</span></span></p></div><div id="https://www.notion.so/db3cfcfb4ac24eaaadfc59a2e5b9f530" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F7766dac2-30d4-4230-ac1e-9019033b4b99%2FUntitled.png?width=573&amp;table=block&amp;id=db3cfcfb-4ac2-4eaa-adfc-59a2e5b9f530"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F7766dac2-30d4-4230-ac1e-9019033b4b99%2FUntitled.png?width=573&amp;table=block&amp;id=db3cfcfb-4ac2-4eaa-adfc-59a2e5b9f530" style="width:573px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/65dc789539584d539442a9cc941807e5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这里-3减去的是三个间接指针（一次。二次。三次）</span></span></p></div><div id="https://www.notion.so/d3ba92bf201d44e98615095704021852" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F4c96d5a6-4b4f-4481-bf0a-fab8ee4e1e9d%2FUntitled.png?width=666&amp;table=block&amp;id=d3ba92bf-201d-44e9-8615-095704021852"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F4c96d5a6-4b4f-4481-bf0a-fab8ee4e1e9d%2FUntitled.png?width=666&amp;table=block&amp;id=d3ba92bf-201d-44e9-8615-095704021852" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h3 id="https://www.notion.so/da282eafa1c143ccb334ea9f375035eb" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/da282eafa1c143ccb334ea9f375035eb"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">其他组织部分</span></span></h3><div id="https://www.notion.so/3e1c303768e443a6a3e62eef26f76387" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F2eeee960-b2b9-4288-92f1-3a6359482617%2FUntitled.png?width=596.015625&amp;table=block&amp;id=3e1c3037-68e4-43a6-a3e6-2eef26f76387"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F2eeee960-b2b9-4288-92f1-3a6359482617%2FUntitled.png?width=596.015625&amp;table=block&amp;id=3e1c3037-68e4-43a6-a3e6-2eef26f76387" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/615469ab1bf64b0ebd9573ced4db8dbe" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F6c7d23b3-4c3f-4319-a597-5e5abecd9408%2FUntitled.png?width=596.015625&amp;table=block&amp;id=615469ab-1bf6-4b0e-bd95-73ced4db8dbe"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F6c7d23b3-4c3f-4319-a597-5e5abecd9408%2FUntitled.png?width=596.015625&amp;table=block&amp;id=615469ab-1bf6-4b0e-bd95-73ced4db8dbe" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/bddc0535b001422ca75978c1680ed1eb" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3d80aae4-0e87-49e9-9d8c-bdf31d0019c6%2FUntitled.png?width=596.015625&amp;table=block&amp;id=bddc0535-b001-422c-a759-78c1680ed1eb"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3d80aae4-0e87-49e9-9d8c-bdf31d0019c6%2FUntitled.png?width=596.015625&amp;table=block&amp;id=bddc0535-b001-422c-a759-78c1680ed1eb" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/57feb8cd0a4b447b868f142b1755db97" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">后面好杂不想记了</span></span></p></div><div id="https://www.notion.so/366a7fd196584e618dbaad038fdedee8" class="Divider"></div><div id="https://www.notion.so/29a5247ab3c14336b8a28a72a5bbc81f" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F43d3fa01-b0dc-491f-ab5a-2ff4cb10dae3%2FUntitled.png?width=912&amp;table=block&amp;id=29a5247a-b3c1-4336-b8a2-8a72a5bbc81f"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F43d3fa01-b0dc-491f-ab5a-2ff4cb10dae3%2FUntitled.png?width=912&amp;table=block&amp;id=29a5247a-b3c1-4336-b8a2-8a72a5bbc81f" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/d202aae623674857a253ef4144744b61" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">最后还是得看ppt例题</span></span></p></div></article>
  <footer class="Footer">
  <div>&copy; 这儿是什么地方 2022</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>