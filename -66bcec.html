<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F10daba46-51b9-474a-9c22-1222e6e158b2%2FPMI74K6FO73MCR770JT.png?table=collection&amp;id=51a399fe-3ada-47de-a312-8e2ad5e56579">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>操作系统课程笔记&nbsp;|&nbsp;这儿是什么地方</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="操作系统课程笔记">
  
  
    <meta property="og:image" content="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🎃&lt;/text&gt;&lt;/svg&gt;">
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F10daba46-51b9-474a-9c22-1222e6e158b2%2FPMI74K6FO73MCR770JT.png?table=collection&amp;id=51a399fe-3ada-47de-a312-8e2ad5e56579"></span>&nbsp;
      
      <span>SixGoogle</span>
    </div>
  </a>
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about-me-1b4752.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;😀&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>About me?</span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
</nav>

  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
      <div class="Header__Icon">
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🎃&lt;/text&gt;&lt;/svg&gt;"></span>
      </div>
    
    <h1 class="Header__Title">操作系统课程笔记</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Sat, Apr 20, 2024</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--pink">
            <a href="tag/怎么这么绕.html">怎么这么绕</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/66bcece4921d4d66b4c5332235cf568b" class="PageRoot PageRoot--FullWidth"><ul id="https://www.notion.so/8f8086ccdd09408589077ab22c52c564" class="ColorfulBlock ColorfulBlock--ColorGray TableOfContents"><li class="TableOfContents__Item"><a href="#https://www.notion.so/4f8dd324a7bf4a369a282f153f2e39f5"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">虚拟化 virtualization</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/ba2c120fe17f4bb18fff34704500f351"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">进程管理（虚拟化CPU）</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/29f8b54853394135b6ec705d7c6ccb3c"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">抽象：进程</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/90e45b7546da4376a068004ec0d95352"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">进程API</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/f612fd0c4dd14f858fa20108b3be7c41"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">进程API续（一些常见应用）</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/d848bd6e29bb4af5bdcae37ba697c4e5"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">机制：受限直接执行</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/8d01e9cdc5c34074ad6a9f07a1eee7e0"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">进程调度（3+1）</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/d943c6f477954221ba404388e0c0d49f"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">内存管理（虚拟化内存）</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/ec8b5dab049a4692a6f7316d1c183bbe"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">地址空间</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/064a659e53764da59d5d18d58c1a1749"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">内存操作API</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/087ffd4b688a4284adf176428b18a4e1"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">空闲空间管理</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/b37523cb699841f382f9cd8848fc52db"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">地址转换机制</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/86cd0e25cedc4fb8b38e855b0532ce96"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">分段</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/44668db8b6384321847a144567e69b07"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">分页</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/424c97d4f4c7434ab4493fb76e1ec5a4"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">分页系统： 快速地址转换TLB</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/452d9fdc4e634a56843ac330ce26fe7c"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">更小的页表</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/9126fd84214f47cfa4600cc91c637e40"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">超越物理内存</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/71d8656ff5ea40019301ca79e0888f2e"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">页交换策略</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/cdb458d1cce04e77ba4ea0ab893d34dd"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">VAX/VMS虚拟内存系统 </span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/f008e73a3e3a4fbfa411193f14e4a2f2"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">并发</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/b2bd23fee9b74397a007426291e66a3a"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">锁</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/f6e50fc27ee94841847bcf194fa0b5ce"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">条件变量</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/285d0445013447839bc6f68b1b34b648"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">信号量</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/9d46ae1f92a543f28d6741e9e19af03b"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">持久性</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/303a7fe9c7154d048962668279fb913f"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">I/O设备</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/cdc448590ade4cae86a083cf3a139646"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">磁盘管理</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/5f5438f30e2e435580b7735dfdbac5d0"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">文件系统</span></span></div></a></li></ul><h1 id="https://www.notion.so/4f8dd324a7bf4a369a282f153f2e39f5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/4f8dd324a7bf4a369a282f153f2e39f5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">虚拟化 virtualization</span></span></h1><div id="https://www.notion.so/e7828ddf108546c784b6abef003c8b35" class="Divider"></div><h2 id="https://www.notion.so/ba2c120fe17f4bb18fff34704500f351" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/ba2c120fe17f4bb18fff34704500f351"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">进程管理（虚拟化CPU）</span></span></h2><h3 id="https://www.notion.so/29f8b54853394135b6ec705d7c6ccb3c" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/29f8b54853394135b6ec705d7c6ccb3c"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">抽象：进程</span></span></h3><div id="https://www.notion.so/f8a35bd7055f410f813446d9ec558d9c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">进程可简单理解为运行中的程序，程序是指令的有序集合，没有任何执行的含义，而进程则强调的是执行过程，它动态被创建、执行和消亡。不同的进程可以来自于同一程序，只要该程序所对应的数据集不同。</span></span></p></div><div id="https://www.notion.so/6e3e92d647cc4933b3de94fe23967b6c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">进程是</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">运行程序的主要操作系统抽象</mark></span><span class="SemanticString">。在任何时间点，进程都可以用它的状态来描述:地址空间中内存的内容，CPU寄存器的内容(包括程序计数器和堆栈指针等)，以及关于I/O的信息(如可读或可写的打开文件)。</span></span></p></div><div id="https://www.notion.so/b11e2f9d769a425aa1bed0e0f53e436f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">虚拟化cpu的实现，通过让一个进程只运行一个时间片，然后切换到其他进程，提供存在多个虚拟cpu的假象（时分共享CPU技术，对应的磁盘空间是空分共享资源）</span></span></p></div><div id="https://www.notion.so/d383149beaac449cbf54d8540d18dd52" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fc6672b7b-8bd7-4987-b463-70eb46f9778f%2FUntitled.png?width=689&amp;table=block&amp;id=d383149b-eaac-449c-bf54-d8540d18dd52"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fc6672b7b-8bd7-4987-b463-70eb46f9778f%2FUntitled.png?width=689&amp;table=block&amp;id=d383149b-eaac-449c-bf54-d8540d18dd52" style="width:689px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/2ef18b6c4fc9441a92b5a7949401eb54" class="Divider"></div><h3 id="https://www.notion.so/90e45b7546da4376a068004ec0d95352" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/90e45b7546da4376a068004ec0d95352"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">进程API</span></span></h3><ol class="NumberedListWrapper"><li id="https://www.notion.so/b0d21a841b8e4df0b801bb460ce07549" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">创建create</span></span><div id="https://www.notion.so/f0b44f5dcccd41a5bf4263e29b61e328" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff247edf6-c501-47c1-b346-6abb2f5e3a88%2FUntitled.png?width=392&amp;table=block&amp;id=f0b44f5d-cccd-41a5-bf42-63e29b61e328"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff247edf6-c501-47c1-b346-6abb2f5e3a88%2FUntitled.png?width=392&amp;table=block&amp;id=f0b44f5d-cccd-41a5-bf42-63e29b61e328" style="width:392px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/ee0120ceba3347c8bec2f8ab127e4fe4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">运行程序的第一步：将代码，动态数据从磁盘加载到内存，加载到进程的地址空间
一旦代码和静态数据加载到内存中。
必须为程序的运行时堆栈(或仅仅是堆栈)分配一些内存。c程序使用堆栈存储局部变量、函数参数和返回地址;
操作系统分配这些内存并将其分配给进程。
操作系统也可能会用参数初始化堆栈;
具体来说，它将填充main()函数的参数，即argc和argv数组。</span></span></p></div><div id="https://www.notion.so/15a15a5dbfe846509e6a76c0fbb690a2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">此外还有：销毁destroy，   等待wait，   其他控制miscellaneous  暂停，恢复等，   状态statu</span></span></p></div></li><li id="https://www.notion.so/bdb68bd4ba4f4b798251deac851a366b" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">进程状态</span></span></li></ol><div id="https://www.notion.so/132a60239df44373b2166344b72fdd14" class="ColumnList"><div id="https://www.notion.so/07cdd4e279a4430c8d4fd24fcb329f5e" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/f0d03ea1e7b5406fa2b79c8a61980ab7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">进程从执行到阻塞为主动的</span></span></p></div><div id="https://www.notion.so/82ca95d9631048858b99f4b2c858bcae" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">进程从阻塞到就绪是被动的</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/1219e7c28dba4098bc982928f66451c5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">运行running</span></span></li><li id="https://www.notion.so/64b2d69923c743ee83aff49b7ced1ef1" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">就绪ready</span></span></li><li id="https://www.notion.so/cc0d28bcd20241cb9af8f8f39ea1d10d" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">阻塞blocked</span></span><div id="https://www.notion.so/93970ae5cb9d4a34a5cdf2fde02b5e6c" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F5a230160-bfe6-452c-85b5-aa4444800f00%2FUntitled.png?width=240&amp;table=block&amp;id=93970ae5-cb9d-4a34-a5cd-f2fde02b5e6c"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F5a230160-bfe6-452c-85b5-aa4444800f00%2FUntitled.png?width=240&amp;table=block&amp;id=93970ae5-cb9d-4a34-a5cd-f2fde02b5e6c" style="width:240px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></li></ul></div><div id="https://www.notion.so/593475afe5be45358f058302ba43492d" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/685e6e5c9a164133981d12d41174b75a" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F50463ad4-c316-46cc-8f29-db5cecd3d6d0%2FUntitled.png?width=1051&amp;table=block&amp;id=685e6e5c-9a16-4133-981d-12d41174b75a"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F50463ad4-c316-46cc-8f29-db5cecd3d6d0%2FUntitled.png?width=1051&amp;table=block&amp;id=685e6e5c-9a16-4133-981d-12d41174b75a" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/bbe1333b7ab94a95adc7af4205939ff1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div></div><div id="https://www.notion.so/40a68a4cfe764099ac953175e672e0e3" class="ColumnList"><div id="https://www.notion.so/54c4f6602c904a9f8e99051c41716681" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 1)"><ol class="NumberedListWrapper"><li id="https://www.notion.so/e43484f4c4124a2cb7cd55e4b2ec7433" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">OS中有许多数据结构，如进程列表：包含系统中所有进程的信息，进程控制块process control block PCB：储存关于进程的信息的个体结构</span></span></li></ol><div id="https://www.notion.so/aca635466cd44e5487cde64e71888aa3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div><div id="https://www.notion.so/3a3633f7bb074dbd8ef8f5ba3f1ecd6e" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 1)"><div id="https://www.notion.so/f9ed612bfac84b97ac9ddb757c48c8c6" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F0d92b4de-80bb-4361-b83e-5594b1c85e78%2FUntitled.png?width=468&amp;table=block&amp;id=f9ed612b-fac8-4b97-ac9d-db757c48c8c6"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F0d92b4de-80bb-4361-b83e-5594b1c85e78%2FUntitled.png?width=468&amp;table=block&amp;id=f9ed612b-fac8-4b97-ac9d-db757c48c8c6" style="width:468px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/57c45566fa1a46de9c74d0c5644111ec" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/ceacaf382b8c4691baa840a2d7109060" class="Divider"></div><h3 id="https://www.notion.so/f612fd0c4dd14f858fa20108b3be7c41" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/f612fd0c4dd14f858fa20108b3be7c41"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">进程API续（一些常见应用）</span></span></h3><ol class="NumberedListWrapper"><li id="https://www.notion.so/85120c839db64ab990d72753e9b07f5f" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">fork()
创建新的进程
fork的实现分为以下两步
1. 复制进程资源（代码段继续共享父进程的物理空间（</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">两者的代码完全相同，子进程从fork()后继续执行</mark></span><span class="SemanticString">），内核会给子进程的数据段、堆栈段分配相应的物理空间）
2. 执行该进程（加入就绪队列）
</span></span></li><li id="https://www.notion.so/79c62ae9142a44ad80a90acdb065f988" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">wait()
延迟当前进程执行,调用其的进程将进入阻塞态
添加与父进程相关概念</span></span></li></ol><pre id="https://www.notion.so/62ce59cada3b43df950b27322a471c27" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token class-name">pid_t</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>wstatus<span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token comment">// 功能：等待任意一个子进程结束，如果任意一个子进程结束了，此函数会回收子进程   </span>
<span class="token comment">// 参数：int*  wstatus   进程退出时的状态信息，传入的是一个int类型的地址，是传出参数。</span>
<span class="token comment">//返回值：-成功：返回被回收的子进程的id    -失败：-1      </span></span></span></span></code></pre><ol class="NumberedListWrapper"><li id="https://www.notion.so/5e666acb30c24d47b892243bf2ce2fed" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">exec()</span></span></li></ol><div id="https://www.notion.so/2214680dcd7044c1873f215e5ba30a01" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">使用fork()创建子进程后常用exec系列的函数来将子进程替换为新的进程。
用指定的程序替换当前进程的映像。这意味着当前正在运行的程序被停止，而指定的新程序在相同的进程中启动执行，从而不会改变原有的进程ID。覆写当前进程。</span></span></p></div><div id="https://www.notion.so/221405622814474d8a093a91da107675" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">💡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">为何设计这些exec函数</span></span><div id="https://www.notion.so/f9beac93f8d34150b433ea7a3d4ae567" class="ColorfulBlock ColorfulBlock--BgGray Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这种分离 fork()及 exec()的做法在构建 UNIX shell 的时候非常有用，因为这给了 shell 在fork 之后 exec 之前运行代码的机会，这些代码可以在运行新程序前改变环境，从而让一系列有趣的功能很容易实现。</span></span></p></div></p></div><div id="https://www.notion.so/5b5a82f76a3844c686aed8391f1489ef" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">貌似要重点关注书上32,33,34页？也可能是31
</strong></em></span></span></p></div><div id="https://www.notion.so/5dbc187aec8b4af59ced7434f420331e" class="ColumnList"><div id="https://www.notion.so/769202ecc8734a5aa9c4a7d75a132fe0" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5000000000000001)"><div id="https://www.notion.so/a76d9ea45c5c4cc3814859472a4a7040" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">操作系统领域中，</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">孤儿进程</strong></span><span class="SemanticString">指的是在其父进程执行完成或被终止后仍继续运行的一类进程。 这些孤儿进程将被init进程 所收养，并由init进程对它们完成状态收集工作</span></span></p></div></div><div id="https://www.notion.so/b95c96a5ee504f62899a4b3bfd102bd0" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/ad0d1aeb0a624fbcacc8f4a6431ddb8a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">僵尸进程</strong></span><span class="SemanticString">是当子进程比父进程先结束，而父进程又没有回收子进程，释放子进程占用的资源，此时子进程将成为一个僵尸进程。
</span></span></p></div></div></div><div id="https://www.notion.so/7f8fe314826c4dc8b57dff112ab0fbaf" class="Divider"></div><h3 id="https://www.notion.so/d848bd6e29bb4af5bdcae37ba697c4e5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/d848bd6e29bb4af5bdcae37ba697c4e5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">机制：受限直接执行</span></span></h3><div id="https://www.notion.so/515020007fe644e2988d44b316747795" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">虚拟化带来了一些问题：</span></span></p></div><div id="https://www.notion.so/be6b9e7bb5d548ec823c6c3d8697b34b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed">性能</mark></span><span class="SemanticString">问题:如何在不给系统增加过多开销的情况下实现虚拟化?
第二个是</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed">控制权</mark></span><span class="SemanticString">:我们如何在保持对CPU控制的同时高效地运行进程?</span></span></p></div><div id="https://www.notion.so/00a6f68d1c354427ac65abe3cfa4f40a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">→</span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">受限直接执行</em></span></span></p></div><div id="https://www.notion.so/a9dc5ffe970244fd98ebfd4abc1acdce" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">为什么不直接执行？</strong></em></span></span></p></div><div id="https://www.notion.so/efdb5c78a0f841538a0154260fdbf8dc" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fc58368c1-0e0a-4058-a622-e728939f7af1%2FUntitled.png?width=727&amp;table=block&amp;id=efdb5c78-a0f8-4153-8a01-54260fdbf8dc"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fc58368c1-0e0a-4058-a622-e728939f7af1%2FUntitled.png?width=727&amp;table=block&amp;id=efdb5c78-a0f8-4153-8a01-54260fdbf8dc" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/eb5244523df64b108a1c856f89b2969f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">答：通过fork（），OS一旦把控制权交给用户进程可能就失去了控制（CPU和其他硬件），且若进程希望进行受限操作（如进行I/O操作或内存申请），如何进行？</span></span></p></div><blockquote id="https://www.notion.so/08f2ffe40d90457ea75b56e57a9b356d" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">一个进程必须能够执行 I/O 和其他一些受限制的操作，但又不能让进程完全控制系统。</span></span></blockquote><div id="https://www.notion.so/623a057e94b540aa81aae5c6fd639c8b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">使用一种”受保护的控制权转移“</strong></em></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/7b4c4ff545bc42109f1c7f0b1c05836c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">在</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">用户模式（user mode）</strong></span><span class="SemanticString">下，应用程序不能完全访问硬件资源。</span></span></li><li id="https://www.notion.so/bee597ed5b3e4532a9b61775a09c71cd" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">在</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">内核模式（kernel mode）</strong></span><span class="SemanticString">下，操作系统可以访问机器的全部资源。还提供了陷入（trap）内核和从陷阱返回（return-from-trap）到用户模式程序的特别说明，以及一些指令，让操作系统告诉硬件陷阱表（trap table）在内存中的位置。</span></span></li></ul><div id="https://www.notion.so/be3169c3dccd4018a5c3a73bab890ea3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">用户程序只能通过OS的系统调用进入到内核态，使用特权操作：</strong></em></span></span></p></div><div id="https://www.notion.so/177a69ed0f5c41cd95d0973eff74191e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">用户要想访问内核空间，必须</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">借助操作系统提供的 API 函数，执行内核提供的代码</span></span><span class="SemanticString">，让内核自己来访问，这样才能</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">保证内核空间的数据不会被随意修改</span></span><span class="SemanticString">，才能保证操作系统本身和其他程序的稳定性。
</span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">用户态→核心态的三种方式：</strong></em></span></span></p></div><div id="https://www.notion.so/97209897c9e84cf0980feeb06f529a52" class="ColumnList"><div id="https://www.notion.so/9212970af70f437594b5065881496e28" class="Column" style="width:calc((100% - var(--column-spacing) * 2) * 0.3333333333333333)"><div id="https://www.notion.so/32e23de50cb34897acd06a9b19e16421" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">系统调用*</mark></span><span class="SemanticString"> 这是用户态进程</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">主动要求切换</span></span><span class="SemanticString">到内核态的一种方式，用户态进程通过系统调用申请使用操作系统提供的服务程序完成工作。而系统调用的机制其核心还是使用了操作系统为用户特别开放的一个中断来实现，例如Linux的int 80h中断（int 0x80）。</span></span></p></div></div><div id="https://www.notion.so/9ed8d5cfad7447a485589584886d6526" class="Column" style="width:calc((100% - var(--column-spacing) * 2) * 0.3333333333333333)"><div id="https://www.notion.so/55a81b65cc9240ef973ec796ebbb9ae9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">异常 </mark></span><span class="SemanticString">当CPU在执行运行在用户态下的程序时，发生了某些事先不可知的异常，这时会</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">触发由当前运行进程切换到处理此异常的内核相关程序中</span></span><span class="SemanticString">，也就转到了内核态，比如缺页异常。
</span></span></p></div></div><div id="https://www.notion.so/39d408c0ee244c3fac27d426576289da" class="Column" style="width:calc((100% - var(--column-spacing) * 2) * 0.3333333333333333)"><div id="https://www.notion.so/735d593573724988bdd3da7a5efb80cf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">外围设备的中断 </mark></span><span class="SemanticString">当外围设备完成用户请求的操作后，会向CPU发出相应的中断信号，这时CPU会暂停执行下一条即将要执行的指令转而去执行与中断信号对应的处理程序。比如硬盘读写操作完成，系统会切换到硬盘读写的中断处理程序中执行后续操作等。</span></span></p></div></div></div><div id="https://www.notion.so/ea02c9aea4c1421caaebbf963e77abfe" class="Divider"></div><div id="https://www.notion.so/1347f9e441de432c842f648adcb5f529" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">重点介绍系统调用：</strong></em></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">
陷阱(trap):</strong></span></span></p></div><div id="https://www.notion.so/6890786ba558431384977ac28076fb23" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">程序执行特殊的陷阱（trap）指令。该指令跳入内核并将特权级别提升到内核模式。进入内核，系统就可以执行任何需要的特权操作（如果允许），从而为调用进程执行所需的工作。</span></span></p></div><div id="https://www.notion.so/8ff394b9114a4e19be43add15bd4b18c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">完成后，操作系统调用一个特殊的从陷阱返回（return-from-trap）指令，该指令实现从内核态到用户态。</span></span></p></div><div id="https://www.notion.so/d171e089efba4bdeba3ef50095e4d121" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">陷阱如何知道在 OS 内运行哪些代码？→</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">陷阱表（trap table）：</strong></span></span></p></div><div id="https://www.notion.so/3d0114d8a9854787b5e6986a0d0a00b9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">内核通过在启动时设置陷阱表（trap table）</strong></em></span><span class="SemanticString">来实现。当机器启动时，它在特权（内核）模式下执行，操作系统做的第一件事，就是告诉硬件在发生某些异常事件时要运行哪些代码。操作系统通常通过某种特殊的指令，通知硬件这些陷阱处理程序的位置。一旦硬件被通知，它就会记住这些处理程序的位置，直到下一次重新启动机器。</span></span></p></div><div id="https://www.notion.so/b67982de379a411e8d068c3e193e5c17" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">设置陷阱表是一项特权操作。</mark></span></span></p></div><div id="https://www.notion.so/e317d71c4e144efcaf72c08ee20510b6" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fffc3cbd0-7fe9-44a7-9288-99477a1cb32a%2FUntitled.png?width=762&amp;table=block&amp;id=e317d71c-4e14-4efc-af72-c08ee20510b6"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fffc3cbd0-7fe9-44a7-9288-99477a1cb32a%2FUntitled.png?width=762&amp;table=block&amp;id=e317d71c-4e14-4efc-af72-c08ee20510b6" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/e2b8cf26672443cbada72e3e218af0ee" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">进程执行时，进程在CPU上运行，操作系统如何重获控制权?</span></span></p></div><div id="https://www.notion.so/7ad9e564b9bc46c7bcbc54702af7dd03" class="Divider"></div><div id="https://www.notion.so/d093804b84374fd4a12d4367fc039d58" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">实现在进程中的切换：</strong></em></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/eaa8fcd545584010bad7a05dfe19a4fd" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">协作方式：等待系统调用
远古时期：操作系统相信系统的进程会合理运行。运行时间过长的进程被假定会定期放弃 CPU，以便操作系统可以决定运行其他任务。
大多进程：通过进行系统调用（yield），将 CPU 的控制权转给操作系统
应用程序执行了某些非法操作：将控制转移给操作系统</span></span></li></ul><div id="https://www.notion.so/645b527015894de8bc630f5506ba39d6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">如果某个进程进入无限循环，并且从不进行系统调用，怎么办？</em></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/8e08146fe9f44a7cae67dca329ccbaa5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">非协作方式：操作系统进行控制
时间中断（定时器中断）：时钟设备可以编程为每隔几毫秒产生一次中断</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">。产生中断时，当前正在运行的进程停止，操作系统中预先配置的中断处理程序（interrupt handler）会运行</span></span><span class="SemanticString">。此时，操作系统重新获得 CPU 的控制权。（获取控制权如何进行下一步分配，将由</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed">CPU调度功能</mark></span><span class="SemanticString">决定）</span></span></li></ul><div id="https://www.notion.so/665a88edb9ef4cfc9b0ecab9a4ac0521" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当确定要切换进程时需要→</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">上下文切换（context switch）：</strong></span></span></p></div><div id="https://www.notion.so/3cad45550d7f4c7bb1cdff6f058a398e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">操作系统要做的就是</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">为当前正在执行的进程保存一些寄存器的值</span></span><span class="SemanticString">（例如，到它的内核栈），并</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">为即将执行的进程恢复一些寄存器的值</span></span><span class="SemanticString">（从它的内核栈）。这样一来，操作系统就可以</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">确保最后执行从陷阱返回指令后</span></span><span class="SemanticString">，不是返回到之前运行的进程，而是</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">继续执行另一个进程</span></span><span class="SemanticString">。</span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">（P43)</mark></em></span></span></p></div><div id="https://www.notion.so/e2b0e8fb431a4adbbccbdb19f33a74d1" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff69c792b-aa59-494e-81aa-cd354870b966%2FUntitled.png?width=713&amp;table=block&amp;id=e2b0e8fb-431a-4adb-bccb-db19f33a74d1"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff69c792b-aa59-494e-81aa-cd354870b966%2FUntitled.png?width=713&amp;table=block&amp;id=e2b0e8fb-431a-4adb-bccb-db19f33a74d1" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/3302046165504468a8049d3a844959f1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">如果在系统调用期间发生中断或处理中断时发生中断怎么办？→第二部分</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed">并发</mark></span></span></p></div><h3 id="https://www.notion.so/8d01e9cdc5c34074ad6a9f07a1eee7e0" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/8d01e9cdc5c34074ad6a9f07a1eee7e0"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">进程调度（3+1）</span></span></h3><div id="https://www.notion.so/78c8d0acda214eb6827d8b8abcb2fd33" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">基本思想：</strong></em></span></span></p></div><div id="https://www.notion.so/97e6f49596844327aa3ea49569cd2b94" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">调度指标：</span></span></p></div><blockquote id="https://www.notion.so/c68e449e51eb44e2a35207e44f3cf863" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">周转时间=完成-到达</span></span></blockquote><div id="https://www.notion.so/746159b3732c46afb51965ddabb2e9f5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">先进先出FIFO</strong></span><span class="SemanticString">  先来的可能要执行很久</span></span></p></div><div id="https://www.notion.so/1161a9e812584865adb2091282d736e5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">👇</span></span></p></div><div id="https://www.notion.so/b00c4b50e26948a3a450fd942c19ab39" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">最短任务优先（Shortest Job First, SJF）</strong></span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"> </strong></span></span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">后到的短任务还是得等长任务</span></span></span></p></div><div id="https://www.notion.so/1977be7613024577b36c75520b96cdc0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">👇</span></span></p></div><div id="https://www.notion.so/7159842448a34f70b5d652c315b827ca" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">最短完成时间优先（Shortest Time-to-Completion Firsts, STCF）</strong></span><span class="SemanticString">  </span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">在响应时间指标上表现不理想</span></span></span></p></div><blockquote id="https://www.notion.so/ee5ef100ac654748bb2dcf0002edbd11" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">响应时间=首次运行-到达</span></span></blockquote><div id="https://www.notion.so/11cb3ad324a84f7b95665f713825be79" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">轮转（Round-Robin，RR）  </strong></span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">并未改善周转时间</span></span></span></p></div><div id="https://www.notion.so/b3a693d2662a442082e24c3a4e2acd95" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">RR 在一个时间片（time slice，有时称为调度量子，scheduling quantum）内运行一个工作，然后切换到运行队列中的下一个任务，而不是运行一个任务直到结束。它反复执行，直到所有任务完成。</span></span></p></div><div id="https://www.notion.so/705919b487b4475dba012a2ef6c6eb7f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当继续考虑I/O时</span></span></p></div><div id="https://www.notion.so/1abab213a211409dab8434a9bff7a63f" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8f8825c7-9393-499f-9e38-a44e5e85c660%2FUntitled.png?width=536&amp;table=block&amp;id=1abab213-a211-409d-ab84-34a9bff7a63f"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8f8825c7-9393-499f-9e38-a44e5e85c660%2FUntitled.png?width=536&amp;table=block&amp;id=1abab213-a211-409d-ab84-34a9bff7a63f" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/a818febfe18a492f8ce70d11967d34de" class="Divider"></div><div id="https://www.notion.so/9e4ba3a1765f4ee99f232092fd7c045d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">多级反馈队列（Multi-level Feedback Queue, MLFQ）
</strong></em></span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">在没有工作长度的先验知识的情况下，尝试同时减少响应时间和周转时间</em></span></span></span></p></div><div id="https://www.notion.so/f8239c2cc5ec414080020e175c0a1097" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">MLFQ拥有多级队列，优先级不同</em></span></span><span class="SemanticString">
</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">规则：</strong></span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/f224b33ce87e4a14929aedca62ce5da1" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">如果 A 的优先级 &gt; B 的优先级，运行 A（不运行 B）。 → 确保高优先级工作优先运行</span></span></li><li id="https://www.notion.so/5ccfc069bb8746139786a5ebd775b6fc" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString"> 如果 A 的优先级 = B 的优先级，轮转运行 A 和 B。  → 同优先级时减少响应时间 </span></span></li><li id="https://www.notion.so/914acd3398874f85b1cb8eba51b539d6" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">工作进入系统时，放在最高优先级（最上层队列） → 防止后来的进程饿死</span></span></li><li id="https://www.notion.so/654c74bcdcfd435e9f4787235b5d9f5d" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">一旦工作用完了其在某一层中的时间配额（无论中间主动放弃了多少次CPU），就降低其优先级（移入低一级队列）。 →防止进程垄断CPU，保证公平的CPU分配</span></span></li><li id="https://www.notion.so/7554a36ccd9d4eb1a93457b7881a496e" class="NumberedList" value="5"><span class="SemanticStringArray"><span class="SemanticString">经过</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">一段时间 </span></span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">S</em></span></span><span class="SemanticString">，就将系统中所有工作重新加入最高优先级队列。 → 确保进程不被饿死；确保调度的正确性（如果一个CPU密集型工作变成了交互型）</span></span></li></ol><div id="https://www.notion.so/b75300dca63f42cbb847624ee8b40724" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">存在一些配置问题：</span></span></p></div><div id="https://www.notion.so/4aa7d4579d9b4d8a8e355d0e053e84ac" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">💡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">配置多少队列？每一层队列的时间片配置多大？为了避免饥饿问题以及进程行为改变，应该多久提升一次进程的优先级（巫毒常量：一段时间S)？这些问题都没有显而易见的答案，因此只有利用对工作负载的经验，以及后续对调度程序的调优，才会导致令人满意的平衡。</span></span></p></div><div id="https://www.notion.so/84d1f7c12857437b95317307b1185197" class="Divider"></div><div id="https://www.notion.so/8575a809468240abac4d717f94dbf707" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">比例份额（彩票或步长）：</strong></em></span></span></p></div><div id="https://www.notion.so/46e277da80cf4b17badeffc9c9c6887f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">比例份额算法基于一个简单的想法：调度程序的最终目标，是确保每个工作获得一定比例的 CPU 时间，而不是优化周转时间和响应时间。</span></em></span></span></p></div><div id="https://www.notion.so/38cc2dac6e0f4c38baea3219de7c9999" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">彩票调度： 利用随机性</strong></span></span></p></div><div id="https://www.notion.so/2275a1febcd34224a0620e178f60455f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">利用彩票占用的百分比来表示一个进程占用的cpu的份额，当举行抽奖时，彩票中奖，该进程执行。</span></span></p></div><div id="https://www.notion.so/bab06a40620a4b2cb9359c55493814ab" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">彩票机制：彩票调度还提供了一些机制，以不同且有效的方式来调度彩票。</span></span></p></div><div id="https://www.notion.so/b492e8ddf4ca43b2b4744bb081479c51" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">💡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">彩票货币（ticket currency）：加入一个抽象层，可以让</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">任务组自由修改组内的份额</mark></span><span class="SemanticString">。
假设用户 A 和用户 B 每人拥有 100 张彩票。用户 A 有两个工作 A1 和 A2，他以自己的货币，给每个工作 500 张彩票（共 1000 张）。用户 B 只运行一个工作，给它 10 张彩 票（总共 10 张）。操作系统将进行兑换，将 A1 和 A2 拥有的 A 的货币 500 张，兑换成全局 货币 50 张。类似地，兑换给 B1 的 10 张彩票兑换成 100 张。然后会对全局彩票货币（共 200 张）举行抽奖，决定哪个工作运行。</span></span></p></div><div id="https://www.notion.so/d26de5834f6d4535aeacf5ebc038c85a" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">💡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">彩票转让（ticket transfer）：通过转让，一个</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">进程可以临时将自己的彩票交给另一个进程</mark></span><span class="SemanticString">。
这种机制在客户端/服务端交互的场景中尤其有用，在这种场景中，客户端进程向服务端发送消息，请求其按自己的需求执行工作，为了加速服务端的执行，客户端可以将自己的彩票转让给服务端，从而尽可能加速服务端执行自己请求的速度。服务端执行结束后会将这部分彩票归还给客户端。</span></span></p></div><div id="https://www.notion.so/7f048e0d8b384e899109c32994511622" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">💡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">彩票通胀（ticket inflation）：利用通胀，一个</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">进程可以临时提升或降低自己拥有的彩票数量</mark></span><span class="SemanticString">。
当然在竞争环境中，进程之间互相不信任，这种机制就没什么意义。一个贪婪的进程可能给自己非常多的彩票，从而接管机器。但是，通胀可以</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">用于进程之间相互信任的环境</mark></span><span class="SemanticString">。在这种情况下，如果一个进程知道它需要更多 CPU 时间，就可以增加自己的彩票，从而将自己的需求告知操作系统，这一切不需要与任何其他进程通信。</span></span></p></div><div id="https://www.notion.so/89b313bd86c8497dae847496af7a846c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">公平性：</span></span></p></div><div id="https://www.notion.so/8e66ad7eb7544944b171b11bc5875d10" class="ColumnList"><div id="https://www.notion.so/bc193270f3aa418c9fd9ffeb41d9391a" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/91d186b3553d4eb6b5d4a4c7a5275aa0" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F9696460e-0481-47d3-a66b-bda3b38fd29f%2FUntitled.png?width=301&amp;table=block&amp;id=91d186b3-553d-4eb6-b5d4-a4c7a5275aa0"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F9696460e-0481-47d3-a66b-bda3b38fd29f%2FUntitled.png?width=301&amp;table=block&amp;id=91d186b3-553d-4eb6-b5d4-a4c7a5275aa0" style="width:301px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div><div id="https://www.notion.so/b0e491d35ad4457998978a3110539174" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/540280d8b87f412680dc75188be8b3a2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">可以看出，当工作执行时间很短时，平均不公平度非常糟糕。只有当工作执行非常多的时间片时，彩票调度算法才能得到期望的结果。</span></span></p></div><div id="https://www.notion.so/5b84ae01a47448eeaf3f5493e840b15b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">如何分配彩票呢：</mark></span></span></p></div><div id="https://www.notion.so/b4f91f2e3de342fe863a178b1b4f7bc2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">棘手的问题，系统的运行严重依赖于彩票的分配。假设用户自己知道如何分配，因此可以给每个用户一定量的彩票，由用户按照需要自主分配。</span></span></p></div><div id="https://www.notion.so/425b89b8130847e3a0f9def4088c2735" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div></div><div id="https://www.notion.so/df29c281f53244f79d21d63a99c2e250" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">分配给自己的工作。然而这种方案似乎什么也没有解决——还是没有给出具体的分配策略。因此对于给定的一组工作，</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">彩票分配的问题依然没有最佳答案。</span></span></span></p></div><div id="https://www.notion.so/29f2cd728a394549a62159f9fef6888c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">================================================</span></span></p></div><div id="https://www.notion.so/fb42a3356c324ad0a2851699f1fcdc37" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">步长调度：确定性的公平分配算法</strong></span></span></p></div><div id="https://www.notion.so/edf90a344bbd497594b372b079ae0287" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">系统中的每个工作都有自己的步长，这个值与彩票数值成反比。</span></span></p></div><div id="https://www.notion.so/c0b86747015243bbb4e909a694221125" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">💡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">例子中，A、B、C 这 3 个工作的票数分别是 100、50 和 250，我们通过用一个大数分别除以他们的票数来获得每个进程的步长。比如用 10000 除以这些票数值，得到了 3 个进程的步长分别为 100、200 和 40。我们称这个值为每个进程的步长（stride）。每次进程运行后，我们会让它的计数器 [称为行程（pass）值] 增加它的步长，记录它的总体进展。</span></span></p></div><div id="https://www.notion.so/0ea75d652a37489abdb0b069a60573f5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">调度时，选择目前拥有最小行程值的进程，并且在运行之后将该进程的行程值增加一个步长。</span></span></p></div><div id="https://www.notion.so/fdecdac8d66c488488353fa76b023888" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">总结：</strong></span></span></p></div><div id="https://www.notion.so/d3eee42a0c0c493d8b558e8237d982a3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">彩票调度</mark></span><span class="SemanticString">有一个步长调度没有的优势——</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">不需要全局状态</mark></span></span></p></div><div id="https://www.notion.so/cf756a5bfb5b40eb98937b2e3ce6bc25" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">这两种比例份额调度没有作为 CPU 调度程序被广泛使用。一个原因是这两种方式都</em></span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">不能很好地适合 I/O  </mark></em></span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">，且比例份额不好确定</em></span></span></p></div><div id="https://www.notion.so/0b5c4d20f8aa49e6b87b2b73c1293032" class="Divider"></div><div id="https://www.notion.so/29ca65969b2645bd8a3c6844503f0846" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">多处理器调度（貌似需要并发基础？）</span></span></p></div><div id="https://www.notion.so/a1e0802504284b6cbde1b96426c2a3c4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/d943c6f477954221ba404388e0c0d49f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/d943c6f477954221ba404388e0c0d49f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">内存管理（虚拟化内存）</span></span></h2><div id="https://www.notion.so/f79a53bf3f6746c9bbe3eab1502d3bf6" class="Divider"></div><h3 id="https://www.notion.so/ec8b5dab049a4692a6f7316d1c183bbe" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/ec8b5dab049a4692a6f7316d1c183bbe"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">地址空间</span></span></h3><div id="https://www.notion.so/4ba87934dac94ef89f015dfbe563ebf8" class="ColumnList"><div id="https://www.notion.so/0351179f2b7143a1a36a826ef6b4080d" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/c45a3e7b0afd4f588dc76584347e1986" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F66dfd4db-a497-49d8-ad7e-b58d192e7630%2FUntitled.png?width=243.9375&amp;table=block&amp;id=c45a3e7b-0afd-4f58-8dc7-6584347e1986"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F66dfd4db-a497-49d8-ad7e-b58d192e7630%2FUntitled.png?width=243.9375&amp;table=block&amp;id=c45a3e7b-0afd-4f58-8dc7-6584347e1986" style="width:243.9375px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div><div id="https://www.notion.so/6b61fb4e9b6a4517ab167afc14be7700" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/1f62b02466e44423beb04381cac68244" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">地址空间（address space），是</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">运行的程序看到的系统中的内存。</mark></span></span></p></div><div id="https://www.notion.so/cc404e437e244445a6c9dfb1027029ec" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当我们描述地址空间时，所描述的是操作系统提供给运行程序的抽象（abstract）。程序不在物理地址 0～16KB 的内存中，而是加载在任意的物理地址。</span></span></p></div><div id="https://www.notion.so/88b363df9c7f4f8d930b995d251d3c0d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div></div><blockquote id="https://www.notion.so/d741c0dc0e2748c0a410cd7118d551f0" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">操作系统的一个重要子系统：虚拟内存。
虚拟内存系统负责为程序提供一个巨大的、稀疏的、私有的地址空间的假象，其中保存了程序的所有指令和数据。操作系统在专门硬件的帮助下，通过每一个虚拟内存的索引，将其转换为物理地址，物理内存根据获得的物理地址但获取所需的信息。
操作系统会同时对许多进程执行此操作，并且确保程序之间互相不会受到影响，也不会影响操作系统。整个方法需要大量的机制（很多底层机制）和一些关键的策略。</span></span></blockquote><div id="https://www.notion.so/1464daeaf45d4e5db6729f6daa279379" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">虚拟内存（VM）系统的一个主要目标:</strong></span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/563afa712a6f4c96bdb0f50e00a13b85" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">透明：操作系统实现虚拟内存的方式，应该让运行的程序看不见。</span></span></li><li id="https://www.notion.so/89c4c27ca9a841cb9d91e58153150b4a" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">效率：</span></span></li><li id="https://www.notion.so/777e5b9851cc403bbf15baadc4a440e4" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">保护：当一个进程执行加载、存储或指令提取时，它不应该以任何方式访问或影响任何其他进程或操作系统本身的内存内容（即在它的地址空间之外的任何内容）。</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">在进程间提供隔离，每个进程都应该在自己的独立环境中运行</mark></span></span></li></ol><h3 id="https://www.notion.so/064a659e53764da59d5d18d58c1a1749" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/064a659e53764da59d5d18d58c1a1749"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">内存操作API</span></span></h3><div id="https://www.notion.so/b01337e46a934b0eafd5aabfcc708544" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">malloc()调用</strong></span></span></p></div><div id="https://www.notion.so/35eb9d32984a4d79867256ae46b7178a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">传入要申请的堆空间的大小，它成功就返回一个指向新申请空间的指针，失败就返回 NULL</span></span></p></div><div id="https://www.notion.so/182f1bee899b47c3894bced7ff077074" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">free()调用</strong></span></span></p></div><div id="https://www.notion.so/76efd78f13c34df5911f56ff03bd410b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">要释放不再使用的堆内存，程序员只需调用 free()
两者使用时容易出错，注意判断</span></span></p></div><h3 id="https://www.notion.so/087ffd4b688a4284adf176428b18a4e1" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/087ffd4b688a4284adf176428b18a4e1"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">空闲空间管理</span></span></h3><div id="https://www.notion.so/d65b99719f2c454381ba29109c02c648" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorOrange">内部碎片/内零头</mark></strong></span><span class="SemanticString">（internal fragmentation）</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">已经分配的内存单元内部的未被利用的空间/分配给作业的存储空间（内存）中未被利用的部分</strong></span></span></p></div><div id="https://www.notion.so/5fb45dbf31f042b3a286a9d9b9bd3eda" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorOrange"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">外部碎片/外零头</strong></mark></span><span class="SemanticString">（external fragmentation）</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">系统中无法利用的小存储块</strong></span></span></p></div><div id="https://www.notion.so/f9506b313bd3462ebd069747d8882092" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">如何管理？</strong></span></span></p></div><div id="https://www.notion.so/529c6b2f4ee44bb69dd7fd106fc19c6d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">void free(void *ptr)函数接受一个指针，释放对应的内存块。在释放空间时，用户不需告知库这块空间的大小。因此，在只传入一个指针的情况下，库（库管理的空间称为堆）必须能够弄清楚这块内存的大小。
</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">空闲列表（free list）</strong></span></span></p></div><div id="https://www.notion.so/2f0c2e3060c245ab94773ed31e5cf0bf" class="ColumnList"><div id="https://www.notion.so/3621c7f3c80944f4a77102384f6279ee" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/cfe5dca54d3e43f08fc49ae943cc1ecf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在堆上管理空闲空间的数据结构通常称为空闲列表（free list）</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">空闲列表包含一组元素，记录了堆中的哪些空间还没有分配。</span></span></span></p></div></div><div id="https://www.notion.so/a1f537b1630a4df396c70b0418f6f3d6" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/22c71076a8bb4e3ea10dce20f951aab9" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ffa21d13c-8dc2-457b-9cd2-136e5f324f19%2FUntitled.png?width=291&amp;table=block&amp;id=22c71076-a8bb-4e3e-a10d-ce20f951aab9"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ffa21d13c-8dc2-457b-9cd2-136e5f324f19%2FUntitled.png?width=291&amp;table=block&amp;id=22c71076-a8bb-4e3e-a10d-ce20f951aab9" style="width:291px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/00fda9bb5d8140ff816a8c56c27b24d9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">其需要具备分割与合并的功能：</span></span></p></div><blockquote id="https://www.notion.so/2b0e45798f3c4838a53c58cae5c9e0b0" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">分割（splitting）：它找到一块可以满足请求的空闲空间，将其分割，第一块返回给用户，第二块留在空闲列表中。
合并（coalescing)：在归还一块空闲内存时，仔细查看要归还的内存块的地址以及邻近的空闲空间块。如果新归还的空间与一个原有空闲块相邻，就将它们合并为一个较大的空闲块。</span></span></blockquote><div id="https://www.notion.so/747f37ba359040ff9a301deb04fbffc5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">已分配空间追踪</strong></span></span></p></div><div id="https://www.notion.so/cf17e9bdcbf64257a68e3004155c7169" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">大多数分配程序考虑在分配的空闲块之前加一个信息头（header），用于保存分配空间的大小</span></span></p></div><div id="https://www.notion.so/bd909a86da68466b8b431d9b31c4078a" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8fd7d7c4-39aa-4eb3-be67-3cdea96e61e7%2FUntitled.png?width=654&amp;table=block&amp;id=bd909a86-da68-466b-8b43-1d9b31c4078a"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8fd7d7c4-39aa-4eb3-be67-3cdea96e61e7%2FUntitled.png?width=654&amp;table=block&amp;id=bd909a86-da68-466b-8b43-1d9b31c4078a" style="width:654px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/8aa0977c04994b52820852d0bca854c8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">magic提供完整性检查以及一些信息。</span></span></p></div><div id="https://www.notion.so/608b5df0d1934f9d9535aa0521d8a508" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">free时</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">实际释放的空间是头块大小加上分配的空间大小</span></span></span></p></div><div id="https://www.notion.so/8a952ac2e3d74252a58ed48f06e81c13" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">嵌入空闲列表</strong></span></span></p></div><div id="https://www.notion.so/64acc4e9142c41ac91f293c85404ad05" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在内存分配库中，需要</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">在空闲空间本身建立空闲空间列表</span></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">P123</span></em></strong></span></span></p></div><div id="https://www.notion.so/b7e1408f00d64dd687da248a7abbdc10" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">一些空闲空间管理的妙妙方式：</strong></span></span></p></div><div id="https://www.notion.so/d24882c387c44524a11c8eb75a142311" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">最优匹配：</em></strong></span></span></p></div><div id="https://www.notion.so/20e96ea596324cc4bf5b9e44859ac76f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">遍历，找和请求的大小相近的  </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">较高性能代价</code></span></span></p></div><div id="https://www.notion.so/e666a418b1ac4525be3326efd8564609" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">最差匹配：</strong></em></span></span></p></div><div id="https://www.notion.so/e40b60e4ab1d492985a1ba9b4a99d846" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">遍历，找最大的空闲块  </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">会导致过量的外部碎片，高开销</code></span></span></p></div><div id="https://www.notion.so/0333c33e0c61438a97dad582bb906e19" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">首次匹配：</strong></em></span></span></p></div><div id="https://www.notion.so/d1c15530d399431e8a07ab02f04af281" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">找第一个足够大的块  </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">速度快，但容易让空闲列表头部有很多小块 需要合理管理列表顺序</code></span></span></p></div><div id="https://www.notion.so/72bd8b3f5595433da7c766b56a5b5ea6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">下次匹配：</em></strong></span></span></p></div><div id="https://www.notion.so/4941490d0ec64643b4340aee50cb7d43" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">多维护一个指针，指向上一次查找的位置，将对空闲列表的查找扩散到整个列表  </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">优化的首次匹配</code></span></span></p></div><div id="https://www.notion.so/8f6118e9066446ee9c59a87e32da02ce" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">分离空闲列表：</strong></em></span></span></p></div><div id="https://www.notion.so/14c7714fd6d54c1082bd5eac30c83441" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">如果某个应用程序</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">经常申请一种（或几种）大小的内存空间，那就用一个独立的列表，只管理这样大小的对象</span></span><span class="SemanticString">。通过拿出一部分内存专门满足某种大小的请求，碎片就不再是问题了。而且，由于没有复杂的列表查找过程，这种特定大小的内存分配和释放都很快。</span></span></p></div><div id="https://www.notion.so/18c0202195104a83aa96bdc1a7dbc121" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">提高了复杂度</code></span></span></p></div><div id="https://www.notion.so/e5009cb601f24a04bb1815c36f3fa012" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">伙伴系统：</strong></em></span></span></p></div><div id="https://www.notion.so/f244c8d3c4ad4ed781e508006b422d65" class="ColumnList"><div id="https://www.notion.so/f1d9a8482440484cba335a58eab65ec2" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/60ce8b1b1ad0407981d2cd8acea9ac5b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">空闲空间首先从概念上被看成大小为 </span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Math" data-latex="2^N "><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>N</mi></msup></mrow><annotation encoding="application/x-tex">2^N </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="SemanticString">的大空间。当有一个内存分配请求时，空闲空间被递归地一分为二，直到刚好可以满足请求的大小（再一分为二就无法满足）。这时，请求的块被返回给用户。</span></span></p></div><div id="https://www.notion.so/5cc89bffc74f4ff4bc2521e413a87e83" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">只允许分配 2 的整数次幂大小的空闲块，因此会有内部碎片（internal fragment）的麻烦。</code></span></span></p></div><div id="https://www.notion.so/a67419d969e4456fb0798a582c147ad3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div><div id="https://www.notion.so/2b21b104c45b426f88ed61684bfb4d50" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/071f438bf3de497a8d7b47a24e4e67d4" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F141cfa35-8847-4825-8706-1685fb8382b5%2FUntitled.png?width=391&amp;table=block&amp;id=071f438b-f3de-497a-8d7b-47a24e4e67d4"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F141cfa35-8847-4825-8706-1685fb8382b5%2FUntitled.png?width=391&amp;table=block&amp;id=071f438b-f3de-497a-8d7b-47a24e4e67d4" style="width:391px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/4294fee8909b4ae6ab88cafe56c0c087" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">释放时：查找伙伴（邻居节点）是否空闲，空闲时合并并向上递归查询，</span></span></p></div><div id="https://www.notion.so/62423efd1a8a47aeae066765759ac50e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h3 id="https://www.notion.so/b37523cb699841f382f9cd8848fc52db" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/b37523cb699841f382f9cd8848fc52db"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">地址转换机制</span></span></h3><div id="https://www.notion.so/7a9d9d719d584b3a9773e82e1b4077c5" class="ColumnList"><div id="https://www.notion.so/cc30df2dcd514c9494fa3f5b081b7861" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/355c4d10c94f4d9f845ad8ea8363f624" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">虚拟转物理，每次内存引用都会地址转化</span></span></p></div><div id="https://www.notion.so/3bbe144243744c02b409dbaae82f191b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">动态重定位（基于硬件,在运行时进行）：
</strong></span><span class="SemanticString">引入两个寄存器，基址寄存器和界限寄存器，确保能将地址空间映射到物理内存，同时保证其只能访问自己的空间，</span></span></p></div><div id="https://www.notion.so/660c84206abf44a3ab06aca65d171161" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div><div id="https://www.notion.so/8af09c205be64d7093cd7c53b59bda6b" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/bc186024e8ee4450b4f90dbb403b656a" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fd2aadb44-7300-4a49-8254-389c830a2ef2%2FUntitled.png?width=240&amp;table=block&amp;id=bc186024-e8ee-4450-b4f9-0dbb403b656a"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fd2aadb44-7300-4a49-8254-389c830a2ef2%2FUntitled.png?width=240&amp;table=block&amp;id=bc186024-e8ee-4450-b4f9-0dbb403b656a" style="width:240px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><blockquote id="https://www.notion.so/7ec9612e772149c7941f39067dedab51" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">进程中使用的内存引用都是虚拟地址（virtual address），硬件接下来将虚拟地址加上基址寄存器中的内容，得到物理地址（physical address），再发给内存系统。</span></span><div id="https://www.notion.so/8f2ec9c0d9ad4f15a330953f13599f05" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F55616cda-9b4e-42b1-a650-5aa73821b2bc%2FUntitled.png?width=621&amp;table=block&amp;id=8f2ec9c0-d9ad-4f15-a330-953f13599f05"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F55616cda-9b4e-42b1-a650-5aa73821b2bc%2FUntitled.png?width=621&amp;table=block&amp;id=8f2ec9c0-d9ad-4f15-a330-953f13599f05" style="width:621px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></blockquote><div id="https://www.notion.so/5961463206544e74a33e1ba4b3a425bc" class="ColumnList"><div id="https://www.notion.so/22f5c0dcd0e2469f92605dc36576a915" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/2af882b849604c5988cabec7b592d147" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1a8383db-7597-4f85-816d-53456dcb0fe0%2FUntitled.png?width=677&amp;table=block&amp;id=2af882b8-4960-4c59-88ca-bec7b592d147"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1a8383db-7597-4f85-816d-53456dcb0fe0%2FUntitled.png?width=677&amp;table=block&amp;id=2af882b8-4960-4c59-88ca-bec7b592d147" style="width:677px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div><div id="https://www.notion.so/a435e808f5bc444ca36bcf5be1ce932a" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/dc53e9e5192843e08fd4f3c4d72d7150" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F59e04f59-1eec-4932-9ab4-486dcf372b3e%2FUntitled.png?width=672&amp;table=block&amp;id=dc53e9e5-1928-43e0-8fd4-f3c4d72d7150"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F59e04f59-1eec-4932-9ab4-486dcf372b3e%2FUntitled.png?width=672&amp;table=block&amp;id=dc53e9e5-1928-43e0-8fd4-f3c4d72d7150" style="width:672px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/ea71644dd25042d9bcd45d9dd2f54a6f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">重定位的进程使用了相同大小的物理内存，但由于该进程的栈区和堆区并不很大，导致这块内存区域中大量的空间被浪费。这种浪费通常称为</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorOrange">内部碎片/内零头</mark></strong></span><span class="SemanticString">（internal fragmentation）</span></span></p></div><h3 id="https://www.notion.so/86cd0e25cedc4fb8b38e855b0532ce96" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/86cd0e25cedc4fb8b38e855b0532ce96"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">分段</span></span></h3><div id="https://www.notion.so/02f7496092f64f94a67c7cf6dd564060" class="ColumnList"><div id="https://www.notion.so/66cc94d3e49244bdb54b6be78dbd3069" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 1)"><div id="https://www.notion.so/e48a37712f4c4f17a5cd860334f18ad7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">为解决内部碎片的问题，</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">分段：在MMU中引入不止一个基址和界限寄存器对，给地址空间内每个逻辑段一对，一个段只是地址空间里的一个连续定长的区域。</span></span><span class="SemanticString"> 代码段、栈、堆。不同段放在不同内存区域。</span></span></p></div><div id="https://www.notion.so/7d754c6ac5274ecfb6c5f52de87f5caf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">段错误：在支持分段的机器上发生的非法的内存访问。</span></span></p></div><div id="https://www.notion.so/7c7baa0c465844fab2920bda1af80bcc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div><div id="https://www.notion.so/097c75a985584b4d84e15412ee96a229" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 1)"><div id="https://www.notion.so/70860ae54b95487f877694a794ea96f9" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fdc318913-7215-4b06-8323-c42e8c4b3e95%2FUntitled.png?width=213&amp;table=block&amp;id=70860ae5-4b95-487f-8776-94a794ea96f9"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fdc318913-7215-4b06-8323-c42e8c4b3e95%2FUntitled.png?width=213&amp;table=block&amp;id=70860ae5-4b95-487f-8776-94a794ea96f9" style="width:213px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/c83e9c133fdd407ba4106d80ce635e43" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">如何确定段的引用：
</strong></span><span class="SemanticString">显式方式中：用虚拟地址的开头标识段，后面标识偏移量</span></span></p></div><div id="https://www.notion.so/6acbe7ed647b47b9b2baa8419a720919" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F7ece152c-b261-470e-ae36-78d691ae48aa%2FUntitled.png?width=238&amp;table=block&amp;id=6acbe7ed-647b-47b9-b2ba-a8419a720919"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F7ece152c-b261-470e-ae36-78d691ae48aa%2FUntitled.png?width=238&amp;table=block&amp;id=6acbe7ed-647b-47b9-b2ba-a8419a720919" style="width:238px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/051ed4ac9a3941979d10a2e70ae1bd10" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">隐式方式中：硬件通过地址产生的方式来确定段。例如，如果地址由程序计数器产生（即它是指令获取），那么地址在代码段。如果基于栈或基址指针，它一定在栈段。其他地址则在堆段。</span></span></p></div><div id="https://www.notion.so/a88851c50b884acab20bf469aa871065" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">由于段是先低地址方向生长，对其的引用有所不同：</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">偏移量当成有符号数</span></span><span class="SemanticString"> 偏移量的最高位表示是否反向增长。</span></span></p></div><div id="https://www.notion.so/e83a920572a34fd882cf95b067d1f18a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">操作系统做什么：</strong></span></span></p></div><div id="https://www.notion.so/118bc2d3dec449fba0d3690ced66f319" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">💡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">操作系统在上下文切换时应该做什么？</strong></span><span class="SemanticString">
各个段寄存器中的内容必须保存和恢复。显然，每个进程都有自己独立的虚拟地址空间，操作系统必须在进程运行前，确保这些寄存器被正确地赋值。</span></span></p></div><div id="https://www.notion.so/ef794e0490b84e3297c6f710b3d1ba2e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">新问题，段模式会使得内存中出现很多未分配的小块，这些小块无法分配给新的段也影响了已有段的扩大，成为了</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorOrange"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">外部碎片/外零头</strong></mark></span><span class="SemanticString">（external fragmentation）</span></span></p></div><h3 id="https://www.notion.so/44668db8b6384321847a144567e69b07" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/44668db8b6384321847a144567e69b07"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">分页</span></span></h3><div id="https://www.notion.so/b1f440ff8acc4771a53d2908391c6465" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">将一个进程的地址空间分割成</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">固定大小的单元</span></span><span class="SemanticString">（页）</span></span></p></div><div id="https://www.notion.so/9ab3fd3ff1fe470b9a06751eab330a23" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">把物理内存看成定长槽块的阵列，称为页帧 ，每个页帧包含一个虚拟内存页</span></span></p></div><div id="https://www.notion.so/5562920f5f984394999b028e1eacbcac" class="ColumnList"><div id="https://www.notion.so/0121be61615248a5b10f949e379f68b9" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/9166a6d4a9264059819811d3f3e78fb4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">非连续</span></span><span class="SemanticString">分配，</span></span></p></div><div id="https://www.notion.so/8f44a70a53c14f6db32c99466c2925a7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">内存一块可以装入程序一页</span></span></p></div><div id="https://www.notion.so/6abe943a6560494291347f15c8984d59" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">连续的多个页不一定装入连续的多个块中</span></span></p></div><div id="https://www.notion.so/5b20e18855d442fdb5670e495460c3c1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">没有外零头
仅有小于一个页面的内零头</strong></span></span></p></div><div id="https://www.notion.so/74800f74746a49968bb968eebb23d1d3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">为了</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">记录地址空间的每个虚拟页放在物理内存中的位置</span></span><span class="SemanticString">，操作系统通常为每个进程保
存一个数据结构，称为</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">页表（page table）：</span></span></span></p></div><div id="https://www.notion.so/4a5466f7a99c43c49d40ed3837c1e14d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">为地址空间的每个虚拟页面保存地址转换（address translation），从而让我们知道每个页在物理内存中的位置。</span></span></p></div><div id="https://www.notion.so/9883e19ef0c5471a9f67097204315b0e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorOrange"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">每个进程都有一张自己的页表</strong></mark></span></span></p></div></div><div id="https://www.notion.so/718140858e164cba86d964ddecd913e0" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/2b385bbe7fb245a6947979a5aa1cc0a1" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F47ede853-9fab-43b7-81f5-7ebb712683a0%2FUntitled.png?width=304&amp;table=block&amp;id=2b385bbe-7fb2-45a6-9479-79a5aa1cc0a1"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F47ede853-9fab-43b7-81f5-7ebb712683a0%2FUntitled.png?width=304&amp;table=block&amp;id=2b385bbe-7fb2-45a6-9479-79a5aa1cc0a1" style="width:304px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/6059838dd4c1485b8b0dce3392a22e38" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">地址转化举例：</strong></em></span></span></p></div><div id="https://www.notion.so/dc75c619b55a42ecbf8f80efeb39e0d9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">虚拟地址的两大部分：虚拟页面号（virtual page number，VPN）和页内的偏移量（offset）</span></span></p></div><div id="https://www.notion.so/24c0bde38b4342ca8f66eb9c5079ba1e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">通过虚拟页号VPN，可以检索页表，找到虚拟页所在的物理页面。</span></span></p></div><div id="https://www.notion.so/e361aa33dc944e198cbe8b51c60f8d7d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">物理帧号（PFN）（有时也称为物理页号，physical page number 或 PPN）</span></span></p></div><div id="https://www.notion.so/6b9359fd5ac04a92aedefc6800b3db99" class="ColumnList"><div id="https://www.notion.so/46f07c2dc07d459b95521e122bb4d79b" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/318f5a67b54d429e9f21831ae83ece5e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">VPN的位数由页面总数决定（共5页就3位）</span></span></p></div><div id="https://www.notion.so/8551688e3eef440c86a4ead21397b078" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">偏移量的位数由一页的大小决定（要能表示所有的偏移量）</span></span></p></div><div id="https://www.notion.so/050cc03667e54630a1a8ca19674d50bc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">页表应该存在哪？</strong></em></span></span></p></div><blockquote id="https://www.notion.so/cd22f3f09f4d4809ab73c0988af9596c" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">由于页表如此之大，我们没有在 MMU 中利用任何特殊的片上硬件，来存储当前正在运行的进程的页表，而是</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">将每个进程的页表存储在内存中。</span></span></span><div id="https://www.notion.so/0bd089d272e441408e7b14f4912795d9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">现在让我们假设页表存在于操作系统管理的物理内存中，稍后我们会看到，很多
操作系统内存本身都可以虚拟化，因此</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">页表可以存储在操作系统的虚拟内存中（甚至可以交换到磁盘上）</span></span></span></p></div></blockquote></div><div id="https://www.notion.so/4911df8ef4c944f690142d2db60b9e54" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/806b61d74c9c4b64ab448e54ccd9908f" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F43784bf9-78db-4f20-9c5f-6c3279dbb6f6%2FUntitled.png?width=277&amp;table=block&amp;id=806b61d7-4c9c-4b64-ab44-8e54ccd9908f"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F43784bf9-78db-4f20-9c5f-6c3279dbb6f6%2FUntitled.png?width=277&amp;table=block&amp;id=806b61d7-4c9c-4b64-ab44-8e54ccd9908f" style="width:277px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/e168ea4aa86746829e72c141c2db3b08" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1e686dd9-6c95-405b-8f1a-4c981dfdf538%2FUntitled.png?width=282&amp;table=block&amp;id=e168ea4a-a867-4682-9e72-c141c2db3b08"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1e686dd9-6c95-405b-8f1a-4c981dfdf538%2FUntitled.png?width=282&amp;table=block&amp;id=e168ea4a-a867-4682-9e72-c141c2db3b08" style="width:282px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/081fbfde0f144b2f9fb1ecaa6635b2d7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">页表中的页表项（page table entry)存什么？</strong></em></span></span></p></div><div id="https://www.notion.so/9b3fcddd1e4a41e7a0b2160b35e6c44e" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F586f94ca-1f97-4a50-8439-cd0af9d64fff%2FUntitled.png?width=604&amp;table=block&amp;id=9b3fcddd-1e4a-41e7-a0b2-160b35e6c44e"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F586f94ca-1f97-4a50-8439-cd0af9d64fff%2FUntitled.png?width=604&amp;table=block&amp;id=9b3fcddd-1e4a-41e7-a0b2-160b35e6c44e" style="width:604px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/575efb77ef0f4ca085928c42ab7f726b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">以线性页表为例，需要存储期望的物理帧号PFN。还有一些位：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/fb5fc7d976ff42fe9c35f409f8267457" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">有效位（valid bit）</span></span><span class="SemanticString">通常用于指示特定地址转换是否有效。
当一个程序开始运行时，它的代码和堆在其地址空间的一端，栈在另一端。所有未使用的中间空间都将被标记为无效（invalid），如果进程尝试访问这种内存，就会陷入操作系统，可能会导致该进程终止。将地址空间中所有未使用的页面标记为无效，我们不再需要为这些页面分配物理帧，从而节省大量内存。</span></span></li><li id="https://www.notion.so/eb9b686a3f5f41ebbe045f40956e49d4" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">保护位（protection bit）</span></span><span class="SemanticString">表明页是否可以读取、写入或执行。</span></span></li><li id="https://www.notion.so/168a95bf0f2642ba95ea85baac7c7694" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">存在位（present bit）表示该页是在物理存储器还是在磁盘上（即它已被换出，swapped out）。</span></span></li><li id="https://www.notion.so/8bc1191049544ff68b078dcc04d1ca28" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">脏位（dirty bit）也很常见，表明页面被带入内存后是否被修改过。</span></span></li><li id="https://www.notion.so/9f929f4a2e69404e8632a6c2094c85a6" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">参考位（reference bit，也被称为访问位，accessed bit）有时用于追踪页是否被访问，</span></span></li></ul><div id="https://www.notion.so/9b3b1cdc3e2c4facb5e8870a5ec8fd83" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">目前的分页模式太慢了，会导致机器变慢（有许多</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">额外的内存访问来访问页表</span></span><span class="SemanticString">）和内存浪费（</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">内存被页表塞满</span></span><span class="SemanticString">而不是有用的应用程序数据）。</span></span></p></div><h3 id="https://www.notion.so/424c97d4f4c7434ab4493fb76e1ec5a4" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/424c97d4f4c7434ab4493fb76e1ec5a4"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">分页系统： 快速地址转换TLB</span></span></h3><div id="https://www.notion.so/df96b307bbdf424aab69b6c8422ac3a2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">地址转换旁路缓冲存储器（translation-lookasidebuffer，TLB）：是频繁发生的虚拟到物理地址转换的硬件缓存（cache）。因此，更好的名称应该是地址转换缓存（address-translation cache）。</span></span></p></div><div id="https://www.notion.so/1e8cee73ac044e10ab8fa21539f9b3c2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">TLB是MMU的一部分，TLB 处理器核心附近，设计的访问速度很快。</span></span></p></div><div id="https://www.notion.so/0535f39efc8a47daaf67575e455ea1f8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">硬件缓存，无论是指令、数据还是地址转换（如 TLB），都利用了局部性（时间与空间），在小而快的芯片内存储器中保存一份内存副本。</span></span></p></div><div id="https://www.notion.so/6e27c4aeaae140dea7e2d494b200cd4e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">TLB 这样的缓存这么好，为什么不做更大的缓存，装下所有的数据？</strong></em></span></span></p></div><blockquote id="https://www.notion.so/a8ff3b2f510442e7b4b1e766e66aadbe" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">这里我们遇到了更基本的定律，就像物理定律那样。如果想要快速地缓存，它就必须小，因为光速和其他物 限制会起作用。大的缓存注定慢，因此无法实现目的。所以，我们只能用小而快的缓存。剩下的问题就是如何利用好缓存来提升性能。</span></span></blockquote><div id="https://www.notion.so/e49d7142ce7441da9cb3f50503078bc2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">如何处理TLB未命中？</strong></em></span><span class="SemanticString">
</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">硬件处理（复杂指令集计算机，CISC)</strong></span><span class="SemanticString">：</span></span></p></div><div id="https://www.notion.so/a4663c997c0e4d9091fd28b151c438d9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">硬件必须知道页表在内存中的确切位置（通过页表基址寄存器，page-table base register），以及页表的确切格式。发生未命中时，硬件会“遍历”页表，找到正确的页表项，取出想要的转换映射，用它更新 TLB，并重试该指令。</span></span></p></div><div id="https://www.notion.so/e5ad358ac9c74795977942f9d2091a2a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">软件处理（精简指令集计算机，RISC):</strong></span></span></p></div><div id="https://www.notion.so/6b172b12ca8b4c6f8093a6c44bb84c4e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">TLB 未命中时，硬件系统会抛出一个异常,暂停当前的指令流，将特权级提升至内核模式，跳转至陷阱处理程序（trap handler），这个陷阱处理程序是操作系统的一段代码，用于处理 TLB 未命中。</span></span></p></div><div id="https://www.notion.so/d273d5350d154314990a059118bd25c6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这段代码在运行时，会查找页表中的转换映射，然后用特别的“特权”指令更新 TLB，并从陷阱返回。此时，硬件会重试该指令（导致 TLB 命中）。</span></span></p></div><div id="https://www.notion.so/4014d71dd73a454d86d44b48790a5bd4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">TLB 的内容：</strong></em></span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">VPN ｜ PFN ｜ 其他位</em></span></span></span></p></div><div id="https://www.notion.so/daa14d71094d45bb9f10ece5848524dc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">TLB </strong></span><span class="SemanticString">的有效位!=页表的有效位 →一个页表项（PTE）被标记为无效，就意味着该页并没有被进程申请使用，正常运行的程序不应该访问该地址；</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">TLB 的有效位，只是指出 TLB 项是不是有效的地址映射。</span></span></span></p></div><div id="https://www.notion.so/6dff4a598ac745ffaa7a26a777c169d1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">地址空间标识符（Address Space Identifier，ASID）：可以把ASID 看作是进程标识符（Process Identifier，PID），但通常比 PID 位数少（PID 一般 32 位，ASID 一般是 8 位）。</span></span></p></div><div id="https://www.notion.so/2d39168496ad4530911c3627beb9b06f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">全局位G,一致性位C,脏位D,有效位V</span></span></p></div><div id="https://www.notion.so/e83c90f28103499281b4cac1259f55f2" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F4bd3d436-42b4-42fe-ae76-4472118e01a3%2FUntitled.png?width=503&amp;table=block&amp;id=e83c90f2-8103-4992-81b4-cac1259f55f2"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F4bd3d436-42b4-42fe-ae76-4472118e01a3%2FUntitled.png?width=503&amp;table=block&amp;id=e83c90f2-8103-4992-81b4-cac1259f55f2" style="width:503px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/8ae2951f0a75484fad3d40cea4b5058c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">只有19位VPN? →事实上，用户地址只占地址空间的一半（剩下的留给内核）</span></span></p></div><div id="https://www.notion.so/d52240fae57c43b7971fb17f84b661e1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">TLB满了需要替换时：采用最少使用替换（least-recently-used，LRU）或随机替换</span></span></p></div><h3 id="https://www.notion.so/452d9fdc4e634a56843ac330ce26fe7c" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/452d9fdc4e634a56843ac330ce26fe7c"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">更小的页表</span></span></h3><div id="https://www.notion.so/c37399e3bc624739acc3cc39f16c3e36" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">方案一：使用更大的页 →大内存页会导致每页内的浪费，内部碎片</span></span></p></div><div id="https://www.notion.so/205c32a588de47bfa2b30faefe2e58d8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">方案二：分页与分段混用</strong></em></span></span></p></div><div id="https://www.notion.so/924fbc2fc035487399c11340a54ebe5c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">为每个逻辑分段提供一个页表（段内页表）。</span></span></p></div><div id="https://www.notion.so/e0d924db231b4c19b6f1a245a1bbb90c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">基址寄存器保存该段的页表的物理地址，界限寄存器用于指示页表的结尾（即它有多少有效页）。</span></span></p></div><div id="https://www.notion.so/32356543f28347ff9c76b004bf937234" class="ColumnList"><div id="https://www.notion.so/e89d1fde1e25426397c8d38fd12aec04" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.4375)"><div id="https://www.notion.so/2142f3ce4f454bba9ff55ee933c9b8e6" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fd721ebe0-481d-4e52-be92-9f3df95298a6%2FUntitled.png?width=600&amp;table=block&amp;id=2142f3ce-4f45-4bba-9ff5-5ee933c9b8e6"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fd721ebe0-481d-4e52-be92-9f3df95298a6%2FUntitled.png?width=600&amp;table=block&amp;id=2142f3ce-4f45-4bba-9ff5-5ee933c9b8e6" style="width:600px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div><div id="https://www.notion.so/74eaf4e2de2f4434a6bf6d7bde8f2c41" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5625)"><div id="https://www.notion.so/022b1e3879f146b79238fc7140e4f072" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3a94a434-95db-43a1-aafe-5df89971b51b%2FUntitled.png?width=666&amp;table=block&amp;id=022b1e38-79f1-46b7-9238-fc7140e4f072"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3a94a434-95db-43a1-aafe-5df89971b51b%2FUntitled.png?width=666&amp;table=block&amp;id=022b1e38-79f1-46b7-9238-fc7140e4f072" style="width:666px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/09d57f3d3a9b46e3aa45d32af28c4d91" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">→它仍然要求使用分段(它假定地址空间有一定的使用模式),如果有一个大而稀疏的堆，仍然可能导致大量的页表浪费；</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">外部碎片再次出现</mark></span></span></p></div><div id="https://www.notion.so/9d235ce952204adb97d0c79efee6b827" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgYellow"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">方案三：多级页表 时空的折中</strong></em></mark></span></span></p></div><div id="https://www.notion.so/38d107b90e28498ca54bc0bd7cdc216c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">留出页目录，页目录中有多个页目录项（Page Directory Entries，PDE）组成。PDE（至少）拥有有效位（valid bit）和页帧号（page frame number，PFN），类似于页表项PTE。</span></span></p></div><div id="https://www.notion.so/2967cfa11c6c477ba21207f4e5f2b664" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">PDE的有效位如果为1，则意味着该项指向的页表（通过 PFN）中至少有一页是有效的，即在该 PDE 所指向的页中，至少一个 PTE，其有效位被设置为 1。（</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">如果整页的页表项（PTE）无效，就完全不分配该页的页表</span></span><span class="SemanticString">）
如果 PDE 项无效（即等于零），则 PDE的其余部分没有定义</span></span></p></div><div id="https://www.notion.so/6e8ce79f48554ef1a5d5f72f4a779e46" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F53bf9031-657a-4d60-b322-506e9b5f27f1%2FUntitled.png?width=803&amp;table=block&amp;id=6e8ce79f-4855-4ef1-a5d5-f72f4a779e46"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F53bf9031-657a-4d60-b322-506e9b5f27f1%2FUntitled.png?width=803&amp;table=block&amp;id=6e8ce79f-4855-4ef1-a5d5-f72f4a779e46" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/7a1bcdf911ef4d2dbc82abf6e1ea9ce6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">页目录应该占一个页的大小（</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">页表的每个部分都可以整齐地放入一页中</span></span><span class="SemanticString">），指向的低级页表也是；</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorOrange">页目录大小（log2（占用的VPN中的位数））=页的大小/PDE的大小</mark></span><span class="SemanticString"> </span></span></p></div><div id="https://www.notion.so/7b8d1e2ddc474342b3e29dbd3549fd95" class="ColumnList"><div id="https://www.notion.so/dd5a72ae260d4919b9e17eb5e11f571e" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/5b74a23632da45928c1df93fa9e6b2a4" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F33139b7a-a4d5-4c60-87eb-5546ed1dea55%2FUntitled.png?width=793&amp;table=block&amp;id=5b74a236-32da-4592-8c1d-f93fa9e6b2a4"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F33139b7a-a4d5-4c60-87eb-5546ed1dea55%2FUntitled.png?width=793&amp;table=block&amp;id=5b74a236-32da-4592-8c1d-f93fa9e6b2a4" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/4232bfa8a0754245a6a444a0b2793eb5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">将线性页表变成了类似树的东西。非常有效</span></span></p></div></div><div id="https://www.notion.so/fc4e2f8ae08e41d1931672abdf6aebaf" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/f33d0dc945b04faa888fea191b27053f" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F52792cfe-490d-46fc-a47c-bf4ab2c747a1%2FUntitled.png?width=810&amp;table=block&amp;id=f33d0dc9-45b0-4faa-888f-ea191b27053f"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F52792cfe-490d-46fc-a47c-bf4ab2c747a1%2FUntitled.png?width=810&amp;table=block&amp;id=f33d0dc9-45b0-4faa-888f-ea191b27053f" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/a69e37c3c63f42d7a6f2ac887987ad15" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">→多级页表是有成本的。在 TLB 未命中时，需要从内存加载多次，才能从页表中获取正确的地址转换信息；另一个明显的缺点是复杂性。</span></span></p></div><div id="https://www.notion.so/4f8af06d7305488cadaeef027f66d52b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">方案四：反向页表 极端的空间节省</strong></em></span></span></p></div><div id="https://www.notion.so/e3adbed97d6c4de1936c3cd8e1e16177" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">只保留一个页表，每一项代表一个物理页</span></span></p></div><div id="https://www.notion.so/e76d7ba563c94397ba71d8361872fbf2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">页表项内容为：PID+页号</span></span><span class="SemanticString">（哪个进程在使用该页与哪个虚拟页映射到此页）</span></span></p></div><div id="https://www.notion.so/1d994dc8932a4041a6cd4824e8f7782b" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fe23c89e1-b0af-436f-85b8-619f80dec245%2FUntitled.png?width=600&amp;table=block&amp;id=1d994dc8-932a-4041-a6cd-4824e8f7782b"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fe23c89e1-b0af-436f-85b8-619f80dec245%2FUntitled.png?width=600&amp;table=block&amp;id=1d994dc8-932a-4041-a6cd-4824e8f7782b" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/87e2a8c71b1143b490a510221e2ab23b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">方案五：将页表交换到磁盘</strong></em></span></span></p></div><h3 id="https://www.notion.so/9126fd84214f47cfa4600cc91c637e40" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/9126fd84214f47cfa4600cc91c637e40"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">超越物理内存</span></span></h3><div id="https://www.notion.so/739fbb7f375d4b428af2b157bf2b0c5b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我们需要支持更大的地址空间 → 硬盘</span></span></p></div><div id="https://www.notion.so/89705edc9c8b4e0a9b4764c1b21acc2b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在硬盘上开辟一部分空间（交换空间）用于物理页的移入与移出</span></span></p></div><div id="https://www.notion.so/107108b1ad414495a473aca75f74c713" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">虚拟存储器：</strong></span><span class="SemanticString">虚拟存储指仅把作业的一部分装入内存便可运行的存储管理系统，通过作业各部分的动态调入和置换，用户所感觉的存储空间比实际空间大，称之为虚空间。</span></span></p></div><div id="https://www.notion.so/644cba25a99243eaaae3121ebcddc5ff" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">页表PTE的</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">存在位</strong></span><span class="SemanticString">用来指示该页</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">是否在物理内存</strong></span><span class="SemanticString">中</span></span></p></div><div id="https://www.notion.so/c94a85ede0684c079d7590264e8ec519" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">页错误：访问不在物理内存中的页</strong></em></span></span></p></div><div id="https://www.notion.so/c8276675f13a49e8ab3d272019b55bea" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">页错误发生后，操作系统接过控制权，操作系统通过PTE得到硬盘地址，将页读取到内存中
PTE的PFN位用来存储硬盘地址（当该页不在物理内存而是在磁盘中时）</span></span></p></div><blockquote id="https://www.notion.so/0287ecdc3a03493c8b5d84dcf1b23d43" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">为什么硬件不能处理页错误？
页错误导致的硬盘操作很慢，相较于硬盘操作，操作系统的指令带来的额外开销小，硬件不能了解（或很难）交换空间的具体细节，总结：性能与简单性的原因</span></span></blockquote><div id="https://www.notion.so/e03b5b7580c94492badd8ec5f39b7746" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">到目前，TLB未命中的情况如下：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/cc481bc9b94743cca339948152a2aba3" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">该页存在（present）且有效（valid）：以简单地从 PTE 中获取 PFN，然后重试指令（这次 TLB 会命中）</span></span></li><li id="https://www.notion.so/e3924dbef67542d391f99ef395484b90" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">该页不存在（present）且有效（valid）：页错误处理，从交换空间获取页</span></span></li><li id="https://www.notion.so/aba40aae5f224761b8590a07d3727643" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">无效页：非法访问，进程可能会被kill</span></span></li></ol><div id="https://www.notion.so/ba6e3d663774424abb90dcf2cc3d1560" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">什么时候发生交换？</strong></em></span></span></p></div><div id="https://www.notion.so/302a4c2aad0b428bb5df7deb8ca70e24" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">操作系统倾向主动留一小部分空闲空间，高水位线（HW）与低水位线（LW），当少于LW个页可用时，后台专门的程序（交换守护进程）开始释放内存，直到有HW个可用物理页</span></span></p></div><h3 id="https://www.notion.so/71d8656ff5ea40019301ca79e0888f2e" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/71d8656ff5ea40019301ca79e0888f2e"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">页交换策略</span></span></h3><div id="https://www.notion.so/7c3db24a748647869be4c77aaf742f06" class="ColumnList"><div id="https://www.notion.so/45e21ea3081b4667aad93a0a5d1f5671" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/82729bc7a744423fb1d07260cdea9ec2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当内存要满了，需要决定将哪些页交换出去，衡量指标如下：</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">average memory access time (AMAT，</strong></span><span class="SemanticString">平均内存访问时间</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">)：</strong></span></span></p></div><div id="https://www.notion.so/5e08e76b9cf544e4baf5e2c80f79f0a4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">会有三种缓存未命中的情况：1.强制性的，发生在</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">第一次载入时</strong></span><span class="SemanticString">，2.缓存过但被踢出缓存了，</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">容量未命中</strong></span><span class="SemanticString">，3.</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">冲突未命中</strong></span><span class="SemanticString">，硬件对缓存中的项的存放有位置限制
</span></span></p></div></div><div id="https://www.notion.so/0fe06ce771a949baa21e7d2c1a2d9c7e" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/31cf99065a9a4e83ad831295581e8093" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F5e6db969-9786-483f-ac42-a3e6ae565588%2FUntitled.png?width=439&amp;table=block&amp;id=31cf9906-5a9a-4e83-ad83-1295581e8093"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F5e6db969-9786-483f-ac42-a3e6ae565588%2FUntitled.png?width=439&amp;table=block&amp;id=31cf9906-5a9a-4e83-ad83-1295581e8093" style="width:439px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/caeac8ff907b49129931df90ecb21acc" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3c55d195-a03a-4c04-a2d4-903cfb1beb8a%2FUntitled.png?width=213.99620056152344&amp;table=block&amp;id=caeac8ff-907b-4912-9931-df90ecb21acc"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F3c55d195-a03a-4c04-a2d4-903cfb1beb8a%2FUntitled.png?width=213.99620056152344&amp;table=block&amp;id=caeac8ff-907b-4912-9931-df90ecb21acc" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/e2ee9a2f17564fd39fc41e9bb9a3d2ef" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">方案一：最优替换策略</strong></em></span></span></p></div><div id="https://www.notion.so/5dcd8d08cfc04a78b61ad033b9833168" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">剔除在未来最远才将访问的页，这是面向未来的算法，无法实现，可作为对照</span></span></p></div><div id="https://www.notion.so/ba16d6e4a7034ab6becca0327a156267" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">方案二：FIFO</strong></em></span></span></p></div><div id="https://www.notion.so/5fcbfc843220447f9bb5dcf51840c275" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">先入先出，简单，但无法确定页的重要性</span></span></p></div><div id="https://www.notion.so/6f4c6f9044e2480e9f50cdf609e77507" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">方案三：随机</strong></em></span></span></p></div><div id="https://www.notion.so/2a8a26c3c73a439d890bde1add64d5b0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">基本同方案二，命中率看运气</span></span></p></div><div id="https://www.notion.so/b1c83552fd20413e900ffebccfde3d2a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">方案四：利用历史数据 “最不经常使用”（Least-Frequently-Used，LFU）“最少最近使用”（Least-Recently-Used，LRU）</em></strong></span></span></p></div><div id="https://www.notion.so/3a58c54ee27d425db238443820a8c1f2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">优先保留最近加入的和最近使用的，利用局部性原理（频率（frequency）：如果一个页被访问了很多次，也许它不应该被替换，因为它显然更有价值；页更常用的属性是访问的近期性（recency），越近被访问过的页，也许再次访问的可能性也就越大。）</span></span></p></div><div id="https://www.notion.so/be0ebba20b474b1a8694ce0acfabd026" class="ColumnList"><div id="https://www.notion.so/21d98d62cd0044868ffaae5e02458e47" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/c45859df65c640deb7f735618fb5d60f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">近似实现LRU（时钟算法）</strong></span></span></p></div><div id="https://www.notion.so/2b3558479b214d02a9b436c764d32576" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在硬件中引入使用位（use bit/reference bit） 当页被引用时设置为1，将页放在循环列表中。
页交换时，时钟指针顺序检查页，若当前页使用位为1则清零找下一个，直到找到使用位为0的页（在最 坏的情况下，所有的页都已经被使用了，那么就将所有页的使用位都设置为 0）</span></span></p></div><div id="https://www.notion.so/b4db914e1c284952bc222005a31080ac" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">进一步的</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">考虑脏页（是否被修改过）</strong></span></span></p></div></div><div id="https://www.notion.so/4d55aa504e82441e9857c1372b33288a" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/5dea62fb735346a2ad8c99a9174b0d72" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fb8e80aa5-957a-4c71-8257-b09c75fb34ec%2FUntitled.png?width=585&amp;table=block&amp;id=5dea62fb-7353-46a2-ad8c-99a9174b0d72"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fb8e80aa5-957a-4c71-8257-b09c75fb34ec%2FUntitled.png?width=585&amp;table=block&amp;id=5dea62fb-7353-46a2-ad8c-99a9174b0d72" style="width:585px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/b079451d218341298cd890523a136e6f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">抖动（Thrashing）</strong></span><span class="SemanticString">是操作系统中的一种现象，发生在计算机的物理内存（RAM）被过度使用时，导致系统花费大部分时间在交换页面（从内存到硬盘和从硬盘到内存的过程）上，而非执行实际的应用程序或进程。</span></span></p></div><h3 id="https://www.notion.so/cdb458d1cce04e77ba4ea0ab893d34dd" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/cdb458d1cce04e77ba4ea0ab893d34dd"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">VAX/VMS虚拟内存系统 </span></span></h3><div id="https://www.notion.so/7b301a9612914923ad8bde2b07f21b9d" class="Divider"></div><h1 id="https://www.notion.so/f008e73a3e3a4fbfa411193f14e4a2f2" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/f008e73a3e3a4fbfa411193f14e4a2f2"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">并发</span></span></h1><div id="https://www.notion.so/8519c55c2d9d45edb6d44e2196311a7d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/b2bd23fee9b74397a007426291e66a3a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/b2bd23fee9b74397a007426291e66a3a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">锁</span></span></h2><div id="https://www.notion.so/9a2150b3f8ce42bf8cb701b7c10534af" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/f6e50fc27ee94841847bcf194fa0b5ce" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/f6e50fc27ee94841847bcf194fa0b5ce"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">条件变量</span></span></h2><div id="https://www.notion.so/17f99f395b944e87b8c313f53f60f9a9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/285d0445013447839bc6f68b1b34b648" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/285d0445013447839bc6f68b1b34b648"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">信号量</span></span></h2><div id="https://www.notion.so/e1f725881cd04ba19a8387a8148f53ef" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h1 id="https://www.notion.so/9d46ae1f92a543f28d6741e9e19af03b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/9d46ae1f92a543f28d6741e9e19af03b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">持久性</span></span></h1><h2 id="https://www.notion.so/303a7fe9c7154d048962668279fb913f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/303a7fe9c7154d048962668279fb913f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">I/O设备</span></span></h2><div id="https://www.notion.so/388054f4d7774d88bc1c0b3a77cde4f2" class="Divider"></div><div id="https://www.notion.so/402e5ed56c6440e1b215238153fa3737" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/cdc448590ade4cae86a083cf3a139646" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/cdc448590ade4cae86a083cf3a139646"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">磁盘管理</span></span></h2><div id="https://www.notion.so/1065f29e91a7406ea93fea34475fa34c" class="Divider"></div><div id="https://www.notion.so/5130988c20c54eabb2940e8cedc555d7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/5f5438f30e2e435580b7735dfdbac5d0" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/5f5438f30e2e435580b7735dfdbac5d0"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">文件系统</span></span></h2><div id="https://www.notion.so/366a7fd196584e618dbaad038fdedee8" class="Divider"></div><div id="https://www.notion.so/7fe920ecf525448ebed1635c872c3257" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/29a5247ab3c14336b8a28a72a5bbc81f" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F43d3fa01-b0dc-491f-ab5a-2ff4cb10dae3%2FUntitled.png?width=793&amp;table=block&amp;id=29a5247a-b3c1-4336-b8a2-8a72a5bbc81f"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F43d3fa01-b0dc-491f-ab5a-2ff4cb10dae3%2FUntitled.png?width=793&amp;table=block&amp;id=29a5247a-b3c1-4336-b8a2-8a72a5bbc81f" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></article>
  <footer class="Footer">
  <div>&copy; 这儿是什么地方 2022</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>